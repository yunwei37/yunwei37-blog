<!DOCTYPE html><!--MYXrWUjg0HELsl6zLYF_6--><html lang="en-us" class="__variable_dd5b2f scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/36966cca54120369-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4ac7c0f872b74ee7.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/a06d7e24bf9a7d93.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7246298b30c42979.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-91cf1b3b084c6ba2.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-dd2321b4b492b566.js" async=""></script><script src="/_next/static/chunks/main-app-01d32ba99375ba1b.js" async=""></script><script src="/_next/static/chunks/874-8edb22cc7428423c.js" async=""></script><script src="/_next/static/chunks/650-5bb235cd9bfca45d.js" async=""></script><script src="/_next/static/chunks/app/layout-66df3ac28fcfbced.js" async=""></script><script src="/_next/static/chunks/63-d245e42a784ca56d.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js" async=""></script><link rel="preload" href="https://analytics.umami.is/script.js" as="script"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/svg+xml" href="/static/favicons/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="next-size-adjust" content=""/><title>Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling | 云微的胡思乱想</title><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://www.yunwei37.com/blog/iaprof-analysis"/><link rel="alternate" type="application/rss+xml" href="https://www.yunwei37.com/feed.xml"/><meta property="og:title" content="Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling"/><meta property="og:url" content="https://www.yunwei37.com/blog/iaprof-analysis"/><meta property="og:site_name" content="云微的胡思乱想"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-10-11T16:00:00.000Z"/><meta property="article:modified_time" content="2025-10-11T16:00:00.000Z"/><meta property="article:author" content="Yusheng Zheng (云微)"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling"/><meta name="twitter:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="min-h-screen flex flex-col justify-center py-8"><div class="content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8"><header class="flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30"><a class="break-words" aria-label="yunwei37" href="/"><div class="flex items-center"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none"><defs><linearGradient id="logo_svg__a" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1"></stop></linearGradient><linearGradient id="logo_svg__b" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1"></stop></linearGradient></defs><circle cx="20" cy="20" r="18" fill="url(#logo_svg__a)" opacity="0.1"></circle><path fill="url(#logo_svg__a)" d="m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z"></path><path fill="url(#logo_svg__b)" d="m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z" opacity="0.8"></path><circle cx="32" cy="12" r="2" fill="url(#logo_svg__b)"></circle><circle cx="8" cy="12" r="1.5" fill="url(#logo_svg__a)" opacity="0.6"></circle></svg></div><div class="hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors">yunwei37</div></div></a><div class="flex items-center space-x-4"><div class="no-scrollbar hidden items-center space-x-2 sm:flex"><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/blog">Blog</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/docs">Docs</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/tags">Tags</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/about">About</a></div><div class="flex items-center space-x-2"><button aria-label="Search" class="p-2 rounded-lg transition-all duration-200"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden p-2 rounded-lg hover:glass transition-all duration-200 hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></div></div></header><main class="py-6"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling","datePublished":"2025-10-11T16:00:00.000Z","dateModified":"2025-10-11T16:00:00.000Z","image":"/static/images/twitter-card.png","url":"https://www.yunwei37.com/blog/iaprof-analysis","author":[{"@type":"Person","name":"Yusheng Zheng (云微)"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article class="content-glass p-8"><div class="xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30"><header class="pt-6 xl:pb-6"><div class="space-y-4 text-center"><dl class="space-y-4"><div><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-600 dark:text-gray-300"><time dateTime="2025-10-11T16:00:00.000Z">Saturday, October 11, 2025</time></dd></div></dl><div><h1 class="text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0"><li class="flex items-center space-x-3 glass p-4 rounded-xl"><img alt="avatar" loading="lazy" width="38" height="38" decoding="async" data-nimg="1" class="h-10 w-10 rounded-full" style="color:transparent" src="/static/images/avatar.png"/><dl class="text-sm leading-5 font-medium whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Yusheng Zheng (云微)</dd><dt class="sr-only">Twitter</dt><dd><a class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors" target="_blank" rel="noopener noreferrer" href="https://twitter.com/yunwei37">@yunwei37</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30"><div class="prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200"><h1 class="content-header" id="understanding-iaprof-a-deep-dive-into-aigpu-flame-graph-profiling"><a class="break-words" href="#understanding-iaprof-a-deep-dive-into-aigpu-flame-graph-profiling" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling</h1><p><em>An exploration of Intel&#x27;s innovative profiling tool that bridges the gap between CPU and GPU execution</em></p><blockquote><p><strong>Project Link</strong>: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/intel/iaprof">github.com/intel/iaprof</a> - Intel&#x27;s AI/GPU flame graph profiler</p></blockquote><p>If you&#x27;ve ever tried to optimize a GPU-accelerated machine learning workload, you&#x27;ve likely encountered a frustrating problem: your code runs on the CPU, but the performance bottlenecks live on the GPU. Traditional profiling tools show you one world or the other, but never both together. This disconnect makes it nearly impossible to understand which lines of your Python or C++ code are responsible for expensive GPU operations.</p><p>Enter <strong>iaprof</strong>, Intel&#x27;s solution to this observability challenge. At its core, iaprof is a profiling tool that generates what Intel calls &quot;AI Flame Graphs&quot; - interactive visualizations that seamlessly connect your application code to the GPU instructions it triggers, all while showing where performance is actually being lost. This blog post will take you on a deep dive into how iaprof works, the technologies it leverages, and the architecture that makes it possible.</p><h2 class="content-header" id="the-visibility-gap-in-gpu-computing"><a class="break-words" href="#the-visibility-gap-in-gpu-computing" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>The Visibility Gap in GPU Computing</h2><p>To appreciate what iaprof accomplishes, we need to understand the fundamental challenge of profiling GPU workloads. When you write code that uses GPUs for computation, there&#x27;s an inherent disconnect between where you write code and where that code actually executes. Your application runs on the CPU, making calls to high-level frameworks like PyTorch or TensorFlow, which in turn call runtime libraries like Level Zero or CUDA, which eventually communicate with kernel drivers that manage the GPU hardware.</p><p>This deep software stack creates multiple layers of abstraction. By the time your matrix multiplication reaches the GPU, it&#x27;s been transformed from Python through multiple runtime layers into GPU machine code - shader instructions executing on Execution Units (EUs) deep inside the silicon. When that operation runs slowly, traditional tools struggle to tell you why.</p><p>General-purpose profilers like <code>perf</code> or Intel VTune excel at showing CPU execution patterns. They can tell you exactly which CPU functions are consuming time, but they treat the GPU as an opaque black box. When your profile shows that most time is spent in <code>cudaLaunchKernel</code> or <code>zeCommandListAppendLaunchKernel</code>, you know you&#x27;re waiting on the GPU, but not which specific GPU operations are slow or what those operations are actually doing.</p><p>GPU-specific profilers take the opposite approach. Tools like Intel GPA or <code>nvidia-smi</code> provide detailed GPU metrics - memory bandwidth utilization, compute unit occupancy, instruction throughput. These metrics are invaluable for understanding GPU performance, but they lack the crucial connection back to your source code. You might see that a particular shader has memory access stalls, but determining which line of your training loop launched that shader requires manual detective work, correlating timestamps across separate CPU and GPU timelines.</p><h2 class="content-header" id="how-iaprof-bridges-the-gap"><a class="break-words" href="#how-iaprof-bridges-the-gap" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>How iaprof Bridges the Gap</h2><p>iaprof&#x27;s innovation is creating a single, unified view that connects application code to GPU hardware performance. The tool combines three sophisticated techniques to achieve this visibility.</p><p>First, it uses eBPF (extended Berkeley Packet Filter) to trace GPU driver operations at the kernel level. eBPF is a Linux kernel technology that allows safe, verified programs to run inside the kernel with minimal overhead. iaprof&#x27;s eBPF programs hook into the GPU driver&#x27;s execution paths, intercepting every GPU kernel launch and capturing the complete CPU call stack at the moment of launch. This happens transparently, without requiring any modifications to your application code or even recompilation.</p><p>Second, iaprof leverages Intel&#x27;s Observability Architecture (OA) for hardware sampling. The OA is a hardware feature built into modern Intel GPUs that can collect performance counter samples directly from the Execution Units with minimal overhead - typically under 5%. These samples capture detailed information about what&#x27;s happening at the hardware level: which instructions are executing, what types of stalls are occurring (memory access, control flow, synchronization), and how frequently each pattern appears.</p><p>Third, the tool uses the GPU debug API to retrieve shader binaries and execution metadata. This allows iaprof to disassemble GPU machine code and map hardware samples to specific instructions, complete with human-readable assembly syntax.</p><p>The magic happens when iaprof combines these three data streams. For every GPU instruction that shows up in hardware sampling, the tool can trace back through the debug information to identify the shader, through the driver trace to find the kernel launch, and through the CPU stack capture to determine which application functions triggered that launch. The result is a complete execution path from your Python script or C++ application all the way down to the specific multiply-add instruction stalling on memory access inside the GPU.</p><h2 class="content-header" id="intel-gpu-architecture-background"><a class="break-words" href="#intel-gpu-architecture-background" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Intel GPU Architecture Background</h2><p>To understand how iaprof works, it&#x27;s helpful to know the basics of Intel GPU architecture. Modern Intel GPUs are built around a hierarchy of parallel execution units designed for massive throughput.</p><p>At the lowest level are <strong>Execution Units (EUs)</strong>, the fundamental compute cores of the GPU. Each EU contains a SIMD (Single Instruction Multiple Data) processor that can execute the same instruction across multiple data elements simultaneously - typically 8 or 16 elements wide depending on the architecture. Think of an EU as analogous to a CPU core, but optimized for data-parallel workloads rather than sequential code.</p><p>Intel&#x27;s use of SIMD differs from NVIDIA&#x27;s SIMT (Single Instruction Multiple Thread) approach, though the distinction has blurred in modern architectures. In pure SIMD, all data lanes execute exactly the same instruction in lockstep with no per-lane control flow - if one lane needs to branch differently, all lanes must execute both paths with masking. NVIDIA&#x27;s SIMT model, by contrast, treats each lane as an independent thread with its own instruction pointer and register file, allowing for more flexible divergence handling through hardware thread scheduling. Each NVIDIA &quot;warp&quot; contains 32 threads that preferentially execute together but can diverge when needed. However, Intel GPUs have evolved to include masked execution capabilities similar to SIMT, allowing individual SIMD lanes to be selectively enabled or disabled based on predicate masks. This hybrid approach gives Intel GPUs some SIMT-like flexibility while maintaining the efficiency of SIMD execution for uniform workloads. For profiling purposes, this means that control flow divergence can create performance artifacts where some EU lanes are active while others are masked off, wasting potential throughput.</p><p>EUs are organized into <strong>subslices</strong> (or <strong>Xe-cores</strong> in newer architectures), which group multiple EUs together with shared resources like a local L1 cache, texture sampling units, and load/store units. A subslice might contain 8-16 EUs working together. These subslices are further grouped into <strong>slices</strong>, which share larger caches and memory controllers.</p><p>When you launch a GPU kernel - whether it&#x27;s a compute shader in SYCL, a CUDA kernel compiled for Intel, or a graphics shader in Vulkan - the GPU&#x27;s thread dispatcher breaks your work into many parallel threads. These threads are grouped into <strong>SIMD lanes</strong> that execute together on an EU. The hardware automatically manages scheduling these threads across available EUs to maximize utilization.</p><p>The <strong>Observability Architecture (OA)</strong> is Intel&#x27;s hardware performance monitoring system built into the GPU. It can sample the execution state of EUs at regular intervals, capturing which instruction each EU is executing and critically, what&#x27;s preventing it from making progress. These &quot;stall types&quot; reveal whether an EU is actively computing, waiting for memory, blocked on control flow dependencies, or stalled on synchronization primitives.</p><p>This is where iaprof&#x27;s power comes from: by sampling EU stall states and correlating them with specific shader instructions and CPU call stacks, it reveals exactly where your code is losing performance - not just that a kernel is slow, but which specific instructions within that kernel are causing the bottleneck and what hardware resource they&#x27;re waiting on.</p><h2 class="content-header" id="the-architecture-inside-iaprof"><a class="break-words" href="#the-architecture-inside-iaprof" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>The Architecture: Inside iaprof</h2><p>Understanding how iaprof works requires looking at its multi-threaded architecture. The tool runs as a privileged user-space application (requiring root or <code>CAP_PERFMON</code> capabilities) that coordinates several concurrent collection threads, each gathering different pieces of the profiling puzzle.</p><p>At the heart of iaprof&#x27;s approach is the combination of four key technologies working in concert. eBPF kernel tracing intercepts GPU driver calls to track kernel launches and memory mappings without requiring any code changes to the target application. Hardware sampling collects Execution Unit (EU) stall samples via Intel&#x27;s Observability Architecture with less than 5% overhead, ensuring the profiler doesn&#x27;t significantly perturb the workload being measured. The debug API retrieves shader binaries and detailed execution information enabling instruction-level analysis of what the GPU is actually doing. Finally, sophisticated symbol resolution translates raw memory addresses in both CPU and kernel stacks into human-readable symbols complete with file and line number information.</p><p>The end result is an interactive flame graph showing the complete execution path from application code - whether that&#x27;s Python, C++, or another language - through runtime libraries like PyTorch, Level Zero, or Vulkan, down through the kernel driver, all the way to specific GPU shader instructions. Each frame in this visualization is annotated with hardware stall metrics broken down by type: memory access stalls, control flow stalls, synchronization stalls, and more.</p><p>This comprehensive visibility enables several critical use cases in modern GPU computing. Teams can optimize AI training and inference workloads by identifying exactly which parts of their neural network architecture are causing GPU performance bottlenecks. Graphics engineers can pinpoint bottlenecks in rendering pipelines and trace them back to the specific draw calls or shader code responsible. Machine learning engineers can understand and quantify the overhead introduced by framework layers, distinguishing between actual computation time and framework coordination overhead. Compiler teams can validate whether their GPU compiler optimizations are having the intended effect at the hardware level. And development teams can run performance regression testing to catch when code changes inadvertently introduce GPU performance issues.</p><p>Currently, iaprof supports Intel Data Center GPU Max (Ponte Vecchio), Intel Arc B-series (Battlemage), and other Xe2-based GPUs, with ongoing work to expand hardware compatibility.</p><h2 class="content-header" id="system-overview"><a class="break-words" href="#system-overview" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>System Overview</h2><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line">┌─────────────────────────────────────────────────────────────────────┐
</span><span class="code-line">│                           <span class="token maybe-class-name">User</span> <span class="token maybe-class-name">Application</span>                          │
</span><span class="code-line"><span class="token function">│</span>         <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">g</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token maybe-class-name">PyTorch</span><span class="token punctuation">,</span> <span class="token maybe-class-name">TensorFlow</span><span class="token punctuation">,</span> <span class="token constant">SYCL</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Vulkan</span><span class="token punctuation">,</span> etc<span class="token punctuation">.</span><span class="token punctuation">)</span>             │
</span><span class="code-line">└────────────────────────────┬────────────────────────────────────────┘
</span><span class="code-line">                             │ <span class="token constant">API</span> calls
</span><span class="code-line">┌────────────────────────────▼────────────────────────────────────────┐
</span><span class="code-line">│                     <span class="token maybe-class-name">Runtime</span> <span class="token maybe-class-name">Libraries</span>                                │
</span><span class="code-line"><span class="token function">│</span>       <span class="token punctuation">(</span><span class="token maybe-class-name">Level</span> <span class="token maybe-class-name">Zero</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Vulkan</span><span class="token punctuation">,</span> <span class="token maybe-class-name">OpenCL</span><span class="token punctuation">,</span> oneDNN<span class="token punctuation">,</span> cuDNN<span class="token punctuation">,</span> etc<span class="token punctuation">.</span><span class="token punctuation">)</span>             │
</span><span class="code-line">└────────────────────────────┬────────────────────────────────────────┘
</span><span class="code-line">                             │ <span class="token function">ioctl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">┌────────────────────────────▼────────────────────────────────────────┐
</span><span class="code-line">│                      <span class="token maybe-class-name">Linux</span> <span class="token maybe-class-name">Kernel</span>                                    │
</span><span class="code-line">│  ┌──────────────────┐  ┌─────────────────┐  ┌────────────────────┐ │
</span><span class="code-line">│  │  <span class="token constant">DRM</span> <span class="token maybe-class-name">Subsystem</span>   │  │  i915<span class="token operator">/</span><span class="token maybe-class-name">Xe</span> <span class="token maybe-class-name">Driver</span> │  │  eBPF <span class="token maybe-class-name">Subsystem</span>    │ │
</span><span class="code-line">│  │                  <span class="token function">│◄─┤</span>  <span class="token punctuation">(</span><span class="token constant">GPU</span> <span class="token maybe-class-name">Driver</span><span class="token punctuation">)</span>   │  │                    │ │
</span><span class="code-line">│  │  <span class="token operator">-</span> <span class="token maybe-class-name">Device</span> mgmt   │  │  <span class="token operator">-</span> <span class="token maybe-class-name">Memory</span> mgmt  │◄─┤  <span class="token operator">-</span> iaprof <span class="token constant">BPF</span>      │ │
</span><span class="code-line">│  │  <span class="token operator">-</span> <span class="token constant">IOCTL</span> routing │  │  <span class="token operator">-</span> <span class="token maybe-class-name">Execution</span>    │  │    programs        │ │
</span><span class="code-line">│  │                  │  │  <span class="token operator">-</span> <span class="token maybe-class-name">Batch</span> buffers│  │  <span class="token operator">-</span> <span class="token maybe-class-name">Ringbuffer</span>      │ │
</span><span class="code-line">│  └──────────────────┘  └────────┬────────┘  └─────────┬──────────┘ │
</span><span class="code-line">│                                 │                      │             │
</span><span class="code-line">│                                 │ <span class="token maybe-class-name">Commands</span>             │ <span class="token maybe-class-name">Events</span>      │
</span><span class="code-line">│                                 ▼                      │             │
</span><span class="code-line">│  ┌────────────────────────────────────────────────────┼──────────┐ │
</span><span class="code-line">│  │                 <span class="token maybe-class-name">Intel</span> <span class="token constant">GPU</span> <span class="token maybe-class-name">Hardware</span>                  │          │ │
</span><span class="code-line">│  │  ┌──────────┐  ┌──────────┐  ┌─────────────────┐  │          │ │
</span><span class="code-line">│  │  │ <span class="token constant">EU</span> <span class="token class-name known-class-name">Array</span> │  │ <span class="token constant">L1</span><span class="token operator">/</span><span class="token constant">L3</span><span class="token operator">/</span><span class="token constant">RAM</span>│  │ <span class="token constant">OA</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Observ</span><span class="token punctuation">.</span>    <span class="token property-access">│</span>  │          │ │
</span><span class="code-line">│  │  <span class="token function">│</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Compute</span><span class="token punctuation">)</span>│  <span class="token function">│</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Memory</span><span class="token punctuation">)</span> │  │  <span class="token maybe-class-name">Architecture</span><span class="token punctuation">)</span> │◄─┘          │ │
</span><span class="code-line">│  │  │          │  │          │  │ <span class="token operator">-</span> <span class="token maybe-class-name">Sampling</span> <span class="token constant">HW</span>  │             │ │
</span><span class="code-line">│  │  │ <span class="token maybe-class-name">Execution│</span>  │ <span class="token maybe-class-name">Data</span>     │  │ <span class="token operator">-</span> <span class="token maybe-class-name">Perf</span> counters│             │ │
</span><span class="code-line">│  │  └──────────┘  └──────────┘  └─────────────────┘             │ │
</span><span class="code-line">│  └────────────────────────────────────────────────────────────────┘ │
</span><span class="code-line">└──────────────────────────────────────┬──────────────────────────────┘
</span><span class="code-line">                                       │
</span><span class="code-line">                                       │ <span class="token number">1.</span> eBPF <span class="token function">events</span> <span class="token punctuation">(</span>ringbuffer<span class="token punctuation">)</span>
</span><span class="code-line">                                       │ <span class="token number">2.</span> <span class="token constant">EU</span> stall <span class="token function">samples</span> <span class="token punctuation">(</span>debug <span class="token constant">API</span><span class="token punctuation">)</span>
</span><span class="code-line">                                       │ <span class="token number">3.</span> <span class="token maybe-class-name">Shader</span> <span class="token function">uploads</span> <span class="token punctuation">(</span>debug <span class="token constant">API</span><span class="token punctuation">)</span>
</span><span class="code-line">                                       ▼
</span><span class="code-line">┌─────────────────────────────────────────────────────────────────────┐
</span><span class="code-line">│                            iaprof                                    │
</span><span class="code-line">│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
</span><span class="code-line">│  │ <span class="token constant">BPF</span> <span class="token maybe-class-name">Collector│</span>  │Debug <span class="token maybe-class-name">Collect</span><span class="token punctuation">.</span><span class="token property-access">│</span>  │EUStall <span class="token maybe-class-name">Coll</span><span class="token punctuation">.</span> <span class="token property-access">│</span>             │
</span><span class="code-line">│  │              │  │              │  │              │             │
</span><span class="code-line">│  │ <span class="token operator">-</span> <span class="token maybe-class-name">Load</span> <span class="token constant">BPF</span>   │  │ <span class="token operator">-</span> <span class="token maybe-class-name">Shader</span> bin │  │ <span class="token operator">-</span> <span class="token constant">HW</span> samples │             │
</span><span class="code-line">│  │ <span class="token operator">-</span> <span class="token maybe-class-name">Parse</span> <span class="token constant">BB</span>   │  │ <span class="token operator">-</span> <span class="token maybe-class-name">Context</span>    │  │ <span class="token operator">-</span> <span class="token maybe-class-name">Stall</span> attr<span class="token punctuation">.</span><span class="token property-access">│</span>             │
</span><span class="code-line">│  │ <span class="token operator">-</span> <span class="token maybe-class-name">Stacks</span>     │  │   tracking   │  │   <span class="token operator">-</span>ibution   │             │
</span><span class="code-line">│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘             │
</span><span class="code-line">│         │                 │                 │                       │
</span><span class="code-line">│         └────────┬────────┴────────┬────────┘                       │
</span><span class="code-line">│                  ▼                 ▼                                 │
</span><span class="code-line">│         ┌────────────────────────────────┐                          │
</span><span class="code-line">│         │    <span class="token constant">GPU</span> <span class="token maybe-class-name">Kernel</span> <span class="token function"><span class="token maybe-class-name">Store</span></span> <span class="token punctuation">(</span><span class="token maybe-class-name">Tree</span><span class="token punctuation">)</span>     │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token maybe-class-name">Shader</span> metadata <span class="token operator">&amp;</span> binaries  │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token constant">CPU</span><span class="token operator">/</span>kernel stacks           │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token maybe-class-name">Per</span><span class="token operator">-</span>offset stall counts     │                          │
</span><span class="code-line">│         └───────────────┬────────────────┘                          │
</span><span class="code-line">│                         │                                            │
</span><span class="code-line">│                         ▼                                            │
</span><span class="code-line">│         ┌────────────────────────────────┐                          │
</span><span class="code-line">│         │       <span class="token maybe-class-name">Stack</span> <span class="token maybe-class-name">Printer</span>            │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token class-name known-class-name">Symbol</span> resolution           │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token maybe-class-name">Stack</span> deduplication         │                          │
</span><span class="code-line">│         │  <span class="token operator">-</span> <span class="token maybe-class-name">Folded</span> stack output         │                          │
</span><span class="code-line">│         └───────────────┬────────────────┘                          │
</span><span class="code-line">│                         │                                            │
</span><span class="code-line">└─────────────────────────┼────────────────────────────────────────────┘
</span><span class="code-line">                          │
</span><span class="code-line">                          ▼
</span><span class="code-line">                   <span class="token maybe-class-name">Folded</span> <span class="token function"><span class="token maybe-class-name">Stacks</span></span>
</span><span class="code-line">  <span class="token punctuation">(</span><span class="token maybe-class-name">CPU_stack</span><span class="token punctuation">;</span><span class="token maybe-class-name">GPU_kernel</span><span class="token punctuation">;</span><span class="token maybe-class-name">GPU_instruction</span> stall_counts<span class="token punctuation">)</span>
</span><span class="code-line">                          │
</span><span class="code-line">                          ▼
</span><span class="code-line">                   <span class="token maybe-class-name">FlameGraph</span><span class="token punctuation">.</span><span class="token property-access">pl</span>
</span><span class="code-line">                          │
</span><span class="code-line">                          ▼
</span><span class="code-line">                  <span class="token maybe-class-name">Interactive</span> <span class="token constant">SVG</span>
</span><span class="code-line">               <span class="token punctuation">(</span><span class="token constant">AI</span><span class="token operator">/</span><span class="token constant">GPU</span> <span class="token maybe-class-name">Flame</span> <span class="token maybe-class-name">Graph</span><span class="token punctuation">)</span>
</span></code></pre></div><h2 class="content-header" id="core-components"><a class="break-words" href="#core-components" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Core Components</h2><h3 class="content-header" id="1-ebpf-subsystem-kernel-space"><a class="break-words" href="#1-ebpf-subsystem-kernel-space" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>1. eBPF Subsystem (Kernel Space)</h3><p><strong>Location</strong>: <code>src/collectors/bpf/bpf/*.bpf.c</code></p><p><strong>Purpose</strong>: Trace GPU driver operations in real-time without modifying kernel source</p><h4 class="content-header" id="key-ebpf-programs"><a class="break-words" href="#key-ebpf-programs" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Key eBPF Programs</h4><p>iaprof uses several specialized eBPF programs, each targeting different aspects of GPU driver behavior. These programs work together to build a complete picture of what happens when your application submits work to the GPU.</p><p><strong>a) Execution Buffer Tracing</strong> (<code>i915/execbuffer.bpf.c</code>, <code>xe/exec.bpf.c</code>)</p><p>The execution buffer tracer is the cornerstone of iaprof&#x27;s CPU-to-GPU correlation. It hooks into the critical moment when the GPU driver receives a submission request from userspace. This hook uses fexit (function exit) probes on <code>i915_gem_do_execbuffer</code> for i915 driver or <code>xe_exec_ioctl</code> for Xe driver, ensuring it captures the complete context after the driver has processed the submission.</p><p>At this point, the tracer captures:</p><ul><li>Execution buffer ID</li><li>VM and context IDs</li><li>CPU user-space stack (via <code>bpf_get_stack</code> with <code>BPF_F_USER_STACK</code>)</li><li>Kernel stack (via <code>bpf_get_stack</code>)</li><li>Process metadata (PID, TID, CPU, timestamp, command name)</li><li>Batch buffer location (GPU address, CPU mapping)</li></ul><p>Sends: <code>struct execbuf_info</code> to ringbuffer</p><p><strong>b) Batch Buffer Parser</strong> (<code>batchbuffer.bpf.c</code>)</p><p>The batch buffer parser represents one of iaprof&#x27;s most sophisticated eBPF components. Batch buffers are the command streams that tell the GPU what to execute - they contain encoded instructions for loading shaders, configuring registers, and dispatching compute or graphics work. To correlate GPU execution with specific shaders, iaprof must parse these buffers to extract the addresses where shader code resides.</p><p>This parser runs in the same hook context as the execbuffer tracer, giving it access to the freshly submitted batch buffer. The parsing process:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token number">1.</span> <span class="token maybe-class-name">Translates</span> <span class="token constant">GPU</span> batch buffer address to <span class="token constant">CPU</span> address using gpu_cpu_map
</span><span class="code-line"><span class="token number">2.</span> <span class="token maybe-class-name">Reads</span> batch buffer <span class="token keyword module">from</span> userspace <span class="token function">memory</span> <span class="token punctuation">(</span>bpf_probe_read_user<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token number">3.</span> <span class="token maybe-class-name">Parses</span> <span class="token constant">GPU</span> commands <span class="token constant">DWORD</span><span class="token operator">-</span>by<span class="token operator">-</span><span class="token constant">DWORD</span><span class="token operator">:</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Identifies</span> command type <span class="token keyword module">from</span> bits <span class="token number">31</span><span class="token operator">:</span><span class="token number">29</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Calculates</span> command <span class="token function">length</span> <span class="token punctuation">(</span><span class="token keyword">static</span> or dynamic based on command<span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Follows</span> <span class="token constant">BATCH_BUFFER_START</span> to chained <span class="token function">buffers</span> <span class="token punctuation">(</span>up to <span class="token number">3</span> levels deep<span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Extracts</span> <span class="token maybe-class-name">Kernel</span> <span class="token maybe-class-name">State</span> <span class="token function"><span class="token maybe-class-name">Pointers</span></span> <span class="token punctuation">(</span><span class="token maybe-class-name">KSPs</span><span class="token punctuation">)</span> <span class="token keyword module">from</span> <span class="token constant">COMPUTE_WALKER</span> and 3DSTATE commands
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Extracts</span> <span class="token maybe-class-name">System</span> <span class="token maybe-class-name">Instruction</span> <span class="token function"><span class="token maybe-class-name">Pointer</span></span> <span class="token punctuation">(</span><span class="token constant">SIP</span><span class="token punctuation">)</span> <span class="token keyword module">from</span> <span class="token constant">STATE_SIP</span>
</span><span class="code-line"><span class="token number">4.</span> <span class="token maybe-class-name">If</span> buffer <span class="token function">incomplete</span> <span class="token punctuation">(</span><span class="token maybe-class-name">NOOPs</span> encountered<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Defers</span> parsing <span class="token keyword">with</span> <span class="token constant">BPF</span> timer
</span><span class="code-line"><span class="token number">5.</span> <span class="token maybe-class-name">Emits</span> <span class="token maybe-class-name">KSPs</span> and <span class="token constant">SIP</span> to ringbuffer
</span></code></pre></div><p>Challenges:</p><p>Implementing this parser within eBPF presents several significant challenges. The eBPF verifier imposes strict constraints including maximum instruction counts and requirements that all loops must be provably bounded, making complex parsing logic difficult to express. The parser must also handle race conditions where the batch buffer may not yet be fully written by userspace when the execbuffer ioctl is called, requiring deferred parsing with timers. Additionally, nested batch buffers that chain to other buffers require careful state tracking to avoid infinite loops while ensuring all shader pointers are discovered.</p><p><strong>c) Memory Mapping Tracing</strong> (<code>i915/mmap.bpf.c</code>, <code>xe/mmap.bpf.c</code>)</p><p>GPU buffers live in a complex memory space with multiple address translations. A single buffer might have a GPU virtual address (what the GPU sees), a handle (what userspace uses to reference it), and a CPU virtual address (what the application can read/write). The memory mapping tracer maintains these translation tables, which are essential for the batch buffer parser to read GPU command streams from userspace memory.</p><p>This tracer hooks:</p><ul><li><code>i915_gem_mmap_offset_ioctl</code> (fexit) - Records fake offset</li><li><code>i915_gem_mmap</code> (fexit) - Captures CPU address, associates with handle</li><li><code>unmap_region</code> (fentry) - Cleans up mappings on munmap</li></ul><p>Maintains: <code>gpu_cpu_map</code> (GPU addr → CPU addr) and <code>cpu_gpu_map</code> (reverse)</p><p><strong>d) VM Bind Tracing</strong> (<code>i915/vm_bind.bpf.c</code>, <code>xe/vm_bind.bpf.c</code>)</p><p>Discrete GPUs (those with their own dedicated memory, separate from system RAM) use an additional layer of virtual memory management. Before the GPU can access a buffer, the buffer must be &quot;bound&quot; to a GPU virtual address within a specific virtual memory (VM) context. The VM bind tracer tracks these bindings, allowing iaprof to resolve GPU addresses back to the actual buffer contents.</p><p>This tracer hooks:</p><ul><li><code>i915_gem_vm_bind_ioctl</code> / <code>xe_vm_bind</code> (fexit)</li><li><code>i915_gem_vm_unbind_ioctl</code> / <code>xe_vm_unbind</code> (fentry)</li></ul><p>Purpose: For discrete GPUs, maps GPU virtual addresses to buffer handles and CPU addresses</p><p><strong>e) Context Tracking</strong> (<code>i915/context.bpf.c</code>, <code>xe/context.bpf.c</code>)</p><p>GPU contexts are execution environments that encapsulate state like which VM is being used, what shaders are loaded, and various configuration settings. When an execution buffer is submitted, it&#x27;s associated with a specific context. The context tracker maintains the mapping from context IDs to VM IDs, which is crucial for tying everything together - when we see a GPU address in a batch buffer, we need to know which VM context it belongs to in order to translate it correctly.</p><p>Tracks: Context ID → VM ID mapping</p><p>Needed: To resolve which VM an execbuffer belongs to</p><h4 class="content-header" id="ebpf-maps"><a class="break-words" href="#ebpf-maps" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>eBPF Maps</h4><p>eBPF maps are shared data structures that act as the communication and storage layer for the eBPF programs. They allow programs to share data with each other and with userspace, and persist state across multiple invocations. iaprof uses several key maps:</p><ul><li><strong><code>rb</code> (ringbuffer)</strong>: Main output channel, 512 MB</li><li><strong><code>gpu_cpu_map</code></strong>: Hash table, GPU address → CPU address/size</li><li><strong><code>cpu_gpu_map</code></strong>: Reverse lookup</li><li><strong><code>deferred_parse</code></strong>: Batch buffers awaiting retry</li><li><strong><code>deferred_timers</code></strong>: BPF timer wrappers for deferred parsing</li><li><strong><code>bb_ksps</code></strong>: Per-CPU hash table of discovered KSPs</li><li><strong><code>context_create_wait_for_exec</code></strong>: Context → VM ID mappings</li></ul><h3 class="content-header" id="2-userspace-bpf-collector"><a class="break-words" href="#2-userspace-bpf-collector" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>2. Userspace BPF Collector</h3><p><strong>Location</strong>: <code>src/collectors/bpf/bpf_collector.c</code></p><p><strong>Responsibilities</strong>:</p><p><strong>Initialization</strong>:</p><ul><li>Loads compiled eBPF object file (<code>.bpf.o</code>)</li><li>Resolves BTF relocations</li><li>Attaches programs to kernel tracepoints</li><li>Creates ringbuffer and maps file descriptors</li></ul><p><strong>Event Loop</strong> (runs in dedicated thread):</p><ul><li><code>epoll_wait()</code> on ringbuffer file descriptor</li><li><code>ring_buffer__poll()</code> to consume events</li><li>Dispatches to event handlers based on event type</li></ul><p><strong>Event Handlers</strong>:</p><ul><li><strong>EXECBUF</strong>: Creates or updates shader in GPU kernel store</li><li><strong>EXECBUF_END</strong>: Marks batch buffer parsing complete</li><li><strong>KSP</strong>: Adds kernel pointer to shader</li><li><strong>SIP</strong>: Adds system routine pointer</li><li><strong>UPROBE_</strong>* (if enabled): User-space probe events</li></ul><h3 class="content-header" id="3-eu-stall-collector"><a class="break-words" href="#3-eu-stall-collector" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>3. EU Stall Collector</h3><p><strong>Location</strong>: <code>src/collectors/eustall/eustall_collector.c</code></p><p><strong>Purpose</strong>: Collect and attribute hardware EU stall samples</p><p>The EU stall collector is where iaprof connects hardware performance data to the execution context captured by eBPF. Intel&#x27;s Observability Architecture continuously samples the GPU&#x27;s Execution Units, recording which instruction is executing and what type of stall (if any) is occurring at each sample point. The EU stall collector receives these samples and attributes them to specific shaders and instruction offsets, building up a statistical profile of where the GPU is spending its time and what&#x27;s causing performance bottlenecks.</p><h4 class="content-header" id="data-flow"><a class="break-words" href="#data-flow" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Data Flow</h4><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token constant">GPU</span> <span class="token maybe-class-name">Hardware</span> <span class="token maybe-class-name">Sampling</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token constant">OA</span> <span class="token operator">/</span> <span class="token maybe-class-name">Debug</span> <span class="token maybe-class-name">Interface</span>
</span><span class="code-line">    ↓
</span><span class="code-line">struct eustall_sample <span class="token punctuation">{</span>
</span><span class="code-line">    uint32_t ip<span class="token punctuation">;</span>      <span class="token comment">// GPU instruction pointer (shifted by 3)</span>
</span><span class="code-line">    uint64_t active<span class="token punctuation">;</span>  <span class="token comment">// Active execution count</span>
</span><span class="code-line">    uint64_t control<span class="token punctuation">;</span> <span class="token comment">// Control flow stall count</span>
</span><span class="code-line">    uint64_t send<span class="token punctuation">;</span>    <span class="token comment">// Memory access stall count</span>
</span><span class="code-line">    <span class="token comment">// ... more stall types</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token function">handle_eustall_sample</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    ├─→ addr <span class="token operator">=</span> ip <span class="token operator">&lt;&lt;</span> <span class="token number">3</span>
</span><span class="code-line">    ├─→ shader <span class="token operator">=</span> <span class="token function">acquire_containing_shader</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
</span><span class="code-line">    ├─→ <span class="token keyword control-flow">if</span> shader found<span class="token operator">:</span>
</span><span class="code-line">    │   ├─→ offset <span class="token operator">=</span> addr <span class="token operator">-</span> shader<span class="token operator">-</span><span class="token operator">&gt;</span>gpu_addr
</span><span class="code-line">    │   └─→ shader<span class="token operator">-</span><span class="token operator">&gt;</span>stall_counts<span class="token punctuation">[</span>offset<span class="token punctuation">]</span> <span class="token operator">+=</span> sample counts
</span><span class="code-line">    └─→ <span class="token keyword control-flow">else</span><span class="token operator">:</span>
</span><span class="code-line">        └─→ add to deferred_eustall_waitlist
</span></code></pre></div><h4 class="content-header" id="stall-types"><a class="break-words" href="#stall-types" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Stall Types</h4><p>Understanding stall types is key to interpreting iaprof&#x27;s output. Not all time on the GPU represents productive computation. The hardware distinguishes between several categories of execution state, from hardware sampling:</p><ul><li><strong>Active</strong>: EU actively executing (not stalled)</li><li><strong>Control</strong>: Control flow dependencies (branches, predication)</li><li><strong>Pipestall</strong>: Pipeline resource stalls</li><li><strong>Send</strong>: Memory/sampler/URB send stalls</li><li><strong>Dist_acc</strong>: Distributed accumulator stalls</li><li><strong>SBID</strong>: Scoreboard ID stalls (dependency chains)</li><li><strong>Sync</strong>: Synchronization (barriers, fences)</li><li><strong>Inst_fetch</strong>: Instruction fetch stalls</li><li><strong>TDR</strong> (Xe only): Thread dispatch/retire stalls</li></ul><h4 class="content-header" id="deferred-attribution"><a class="break-words" href="#deferred-attribution" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Deferred Attribution</h4><p>One challenge in correlating hardware samples with shaders is timing - hardware samples can arrive before iaprof has received the shader metadata from the debug collector. This happens because the GPU might start executing a shader while the debug information is still being processed by the kernel and transmitted to userspace. Rather than discarding these samples, iaprof uses a deferred attribution mechanism.</p><p>When EU stall arrives before corresponding shader metadata:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">deferred_eustall</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">eustall_sample</span> sample<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">int</span> satisfied<span class="token punctuation">;</span>  <span class="token comment">// 0 = still waiting, 1 = attributed</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>These deferred samples are placed on a waitlist. A separate thread periodically retries attribution when new shaders arrive from the debug collector, eventually matching samples to their corresponding shaders. This ensures no performance data is lost, even when events arrive out of order.</p><h3 class="content-header" id="4-debug-collector"><a class="break-words" href="#4-debug-collector" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>4. Debug Collector</h3><p><strong>Location</strong>: <code>src/collectors/debug/debug_collector.c</code></p><p><strong>Purpose</strong>: Interface with GPU debug API for detailed execution information</p><p>The debug collector interfaces with Intel&#x27;s GPU debug API to access information that&#x27;s not available through standard driver interfaces. This includes the actual compiled shader binaries, detailed context information, and fine-grained execution control. Without the debug API, iaprof would only have GPU addresses - the debug API provides the actual machine code at those addresses, enabling instruction-level disassembly and analysis.</p><h4 class="content-header" id="capabilities"><a class="break-words" href="#capabilities" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Capabilities</h4><p>The debug collector provides several critical capabilities that enable deep GPU inspection. For shader binary collection, it receives shader upload events directly from the driver, copies the shader binary to the shader store, and enables instruction-level disassembly. This is essential for translating GPU instruction pointers into human-readable assembly code.</p><p>Context tracking is another key responsibility - the collector monitors context create and destroy events and tracks VM (virtual memory) associations. This information helps iaprof understand which memory space each shader operates in, crucial for correct address resolution.</p><p>For deterministic sampling scenarios, the debug collector can exercise execution control by sending SIGSTOP signals to GPU processes for synchronized sampling and triggering EU attention events. This allows for more precise profiling in controlled environments.</p><p>The implementation varies by platform: on i915 systems, it uses <code>PRELIM_DRM_I915_DEBUG_*</code> ioctls which require a patched kernel, while on Xe systems it uses <code>DRM_XE_EUDEBUG_*</code> ioctls that have mainline support starting from Linux 6.2.</p><h3 class="content-header" id="5-oa-collector"><a class="break-words" href="#5-oa-collector" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>5. OA Collector</h3><p><strong>Location</strong>: <code>src/collectors/oa/oa_collector.c</code></p><p><strong>Purpose</strong>: Initialize Observability Architecture hardware</p><p>The OA (Observability Architecture) collector is responsible for configuring Intel&#x27;s hardware performance monitoring infrastructure. The OA is a dedicated hardware unit within Intel GPUs that can sample execution state with minimal performance impact. This collector sets up the OA hardware to specifically capture EU stall information, configuring sampling rates and which performance counters to monitor.</p><h4 class="content-header" id="initialization-sequence"><a class="break-words" href="#initialization-sequence" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Initialization Sequence</h4><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token number">1.</span> <span class="token maybe-class-name">Open</span> <span class="token constant">DRM</span> device
</span><span class="code-line"><span class="token number">2.</span> <span class="token maybe-class-name">Write</span> to <span class="token constant">OA</span> control registers<span class="token operator">:</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Enable</span> <span class="token constant">OA</span> unit
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Configure</span> sampling period
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Select</span> counter <span class="token function">set</span> <span class="token punctuation">(</span><span class="token constant">EU</span> stalls<span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token maybe-class-name">Enable</span> triggers
</span><span class="code-line"><span class="token number">3.</span> <span class="token maybe-class-name">Start</span> sampling
</span></code></pre></div><p>Interfaces with EU stall collector to provide sample stream.</p><h3 class="content-header" id="6-gpu-kernel-store"><a class="break-words" href="#6-gpu-kernel-store" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>6. GPU Kernel Store</h3><p><strong>Location</strong>: <code>src/stores/gpu_kernel.c</code></p><p>The GPU kernel store is iaprof&#x27;s central data repository - a thread-safe tree structure that maintains information about all discovered GPU shaders. Each shader entry contains not just the shader binary and GPU address, but also the CPU call stack that launched it and accumulated performance samples. This store acts as the meeting point where data from all the collectors comes together, enabling the correlation between CPU code, GPU shaders, and hardware performance metrics.</p><p><strong>Data Structure</strong>:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token function">tree</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token punctuation">,</span> shader_struct<span class="token punctuation">)</span> shaders<span class="token punctuation">;</span>  <span class="token comment">// Global, sorted by GPU address</span>
</span><span class="code-line"><span class="token class-name">pthread_rwlock_t</span> shaders_lock<span class="token punctuation">;</span>          <span class="token comment">// Protects tree operations</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">shader</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">pthread_mutex_t</span> lock<span class="token punctuation">;</span>                <span class="token comment">// Per-shader lock</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Identity</span>
</span><span class="code-line">    <span class="token class-name">uint64_t</span> gpu_addr<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">uint64_t</span> size<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">enum</span> <span class="token class-name">shader_type</span> type<span class="token punctuation">;</span>               <span class="token comment">// SHADER, SYSTEM_ROUTINE, DEBUG_AREA</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Attribution</span>
</span><span class="code-line">    <span class="token class-name">uint32_t</span> pid<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">uint64_t</span> proc_name_id<span class="token punctuation">,</span> ustack_id<span class="token punctuation">,</span> kstack_id<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">uint64_t</span> symbol_id<span class="token punctuation">,</span> filename_id<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">int</span> linenum<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Binary</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>binary<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Profiling data</span>
</span><span class="code-line">    <span class="token function">hash_table</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span><span class="token punctuation">,</span> offset_profile_struct<span class="token punctuation">)</span> stall_counts<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p><strong>Thread Safety</strong>:</p><p>The GPU kernel store uses a sophisticated two-level locking strategy to maximize concurrency while maintaining data consistency. At the first level, a reader-writer lock protects the tree structure itself, allowing multiple threads to search for shaders concurrently while ensuring exclusive access for structural modifications. At the second level, each individual shader has its own mutex that protects its fields, enabling different threads to update different shaders simultaneously without contention. This design ensures that the high-frequency operations like stall attribution don&#x27;t block other collectors from accessing the store.</p><p><strong>Operations</strong>:</p><ul><li><code>acquire_containing_shader(addr)</code>: Range query, finds shader where <code>addr ∈ [gpu_addr, gpu_addr+size)</code></li><li><code>acquire_or_create_shader(addr)</code>: Gets existing or allocates new</li><li><code>release_shader(shader)</code>: Unlocks shader mutex</li></ul><h3 class="content-header" id="7-stack-printer"><a class="break-words" href="#7-stack-printer" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>7. Stack Printer</h3><p><strong>Location</strong>: <code>src/printers/stack/stack_printer.c</code></p><p><strong>Purpose</strong>: Transform collected data into folded stacks for flame graphs</p><p>The stack printer is the final transformation stage that converts iaprof&#x27;s internal data structures into the &quot;folded stack&quot; text format that FlameGraph tools understand. This involves translating raw memory addresses from CPU call stacks into human-readable function names, file paths, and line numbers, then combining them with GPU shader names and instruction disassembly to create complete execution traces.</p><h4 class="content-header" id="symbol-resolution"><a class="break-words" href="#symbol-resolution" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Symbol Resolution</h4><p>Symbol resolution is the process of converting raw instruction pointer addresses into meaningful names. The stack printer handles both kernel and user-space symbols differently, using appropriate symbol sources for each.</p><p><strong>Kernel Symbols</strong>:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">ksyms</span> <span class="token operator">*</span>ksyms <span class="token operator">=</span> <span class="token function">ksyms_load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Loads /proc/kallsyms</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">ksym</span> <span class="token operator">*</span>sym <span class="token operator">=</span> <span class="token function">ksyms_search</span><span class="token punctuation">(</span>ksyms<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p><strong>User-Space Symbols</strong>:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">syms_cache</span> <span class="token operator">*</span>cache <span class="token operator">=</span> <span class="token function">syms_cache_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Per-PID cache</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sym</span> <span class="token operator">*</span>sym <span class="token operator">=</span> <span class="token function">syms_cache_get</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> pid<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// Parses ELF + DWARF to get function, file, line</span>
</span></code></pre></div><h4 class="content-header" id="output-generation"><a class="break-words" href="#output-generation" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Output Generation</h4><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token maybe-class-name">For</span> each shader<span class="token operator">:</span>
</span><span class="code-line">  <span class="token maybe-class-name">For</span> each offset <span class="token keyword">with</span> stall counts<span class="token operator">:</span>
</span><span class="code-line">    <span class="token number">1.</span> <span class="token maybe-class-name">Resolve</span> <span class="token constant">CPU</span> user stack to symbols<span class="token operator">:</span> main<span class="token punctuation">;</span>worker<span class="token punctuation">;</span>submit_kernel
</span><span class="code-line">    <span class="token number">2.</span> <span class="token maybe-class-name">Append</span> <span class="token constant">GPU</span> kernel name<span class="token operator">:</span> main<span class="token punctuation">;</span>worker<span class="token punctuation">;</span>submit_kernel<span class="token punctuation">;</span>my_compute_kernel
</span><span class="code-line">    <span class="token number">3.</span> <span class="token maybe-class-name">Disassemble</span> <span class="token constant">GPU</span> instruction at offset<span class="token operator">:</span> <span class="token function">mad</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> r10<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token operator">:</span>f <span class="token operator spread">...</span>
</span><span class="code-line">    <span class="token number">4.</span> <span class="token maybe-class-name">Format</span> stall counts<span class="token operator">:</span> active<span class="token operator">=</span><span class="token number">1234</span><span class="token punctuation">,</span>send<span class="token operator">=</span><span class="token number">567</span><span class="token punctuation">,</span>control<span class="token operator">=</span><span class="token number">89</span>
</span><span class="code-line">    <span class="token number">5.</span> <span class="token literal-property property">Output</span><span class="token operator">:</span> main<span class="token punctuation">;</span>worker<span class="token punctuation">;</span>submit_kernel<span class="token punctuation">;</span>my_compute_kernel<span class="token punctuation">;</span><span class="token function">mad</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> active<span class="token operator">=</span><span class="token number">1234</span><span class="token punctuation">,</span>send<span class="token operator">=</span><span class="token number">567</span>
</span></code></pre></div><p><strong>Optimizations</strong>:</p><p>Symbol resolution can be expensive when performed repeatedly for thousands of samples. The stack printer employs several optimization strategies to minimize this overhead. Stack string caching uses a hash table to map complete stacks to their folded string representations, ensuring that identical call stacks are only processed once regardless of how many samples they appear in. Symbol caching maintains per-PID symbol tables, so function addresses are resolved just once per process rather than for every sample. Additionally, batch symbol lookups group address resolution operations together, amortizing the cost of parsing debug information across multiple addresses.</p><h2 class="content-header" id="execution-flow"><a class="break-words" href="#execution-flow" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Execution Flow</h2><p>Now that we understand the individual components, let&#x27;s see how they work together during a typical profiling session. The execution flow shows how iaprof initializes, collects data, and produces output.</p><h3 class="content-header" id="startup-sequence"><a class="break-words" href="#startup-sequence" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Startup Sequence</h3><p>When you run <code>iaprof record</code>, a carefully orchestrated initialization sequence sets up all the collectors and prepares the system for profiling. Each step must complete successfully before moving to the next, ensuring that all components are ready to capture data.</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token number">1.</span> <span class="token function property-access method">main</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">2.</span> <span class="token maybe-class-name">Parse</span> <span class="token function">command</span> <span class="token punctuation">(</span>record <span class="token operator">/</span> flame <span class="token operator">/</span> flamescope<span class="token punctuation">)</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">3.</span> <span class="token function property-access method">record</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">4.</span> <span class="token function property-access method">check_permissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token maybe-class-name">Verify</span> root or <span class="token constant">CAP_PERFMON</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">5.</span> <span class="token function property-access method">drm_open_device</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token maybe-class-name">Open</span> <span class="token operator">/</span>dev<span class="token operator">/</span>dri<span class="token operator">/</span>card0
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">6.</span> <span class="token function property-access method">drm_get_driver_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token maybe-class-name">Detect</span> i915 vs <span class="token maybe-class-name">Xe</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">7.</span> <span class="token maybe-class-name">Initialize</span> collectors<span class="token operator">:</span>
</span><span class="code-line">   a<span class="token punctuation">.</span> <span class="token function property-access method">init_bpf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ <span class="token function">bpf_object__open_file</span><span class="token punctuation">(</span><span class="token string">&quot;main.bpf.o&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ <span class="token function">bpf_object__load</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment">// Loads into kernel</span>
</span><span class="code-line">        └─→ attach tracepoints
</span><span class="code-line">   b<span class="token punctuation">.</span> <span class="token function property-access method">init_oa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        └─→ <span class="token maybe-class-name">Configure</span> <span class="token constant">OA</span> hardware registers
</span><span class="code-line">   c<span class="token punctuation">.</span> <span class="token function property-access method">init_debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        └─→ <span class="token function">debug_attach</span><span class="token punctuation">(</span>pid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// Attach to all processes</span>
</span><span class="code-line">   d<span class="token punctuation">.</span> <span class="token function property-access method">init_eustall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        └─→ <span class="token maybe-class-name">Initialize</span> waitlists<span class="token punctuation">,</span> start deferred thread
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">8.</span> <span class="token maybe-class-name">Spawn</span> collector threads<span class="token operator">:</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token function">bpf_collect_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token function">eustall_collect_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token function">debug_collect_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">-</span> <span class="token function">eustall_deferred_attrib_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">     ↓
</span><span class="code-line"><span class="token number">9.</span> <span class="token maybe-class-name">If</span> command specified<span class="token operator">:</span>
</span><span class="code-line">     <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> child process
</span><span class="code-line">   <span class="token literal-property property">Else</span><span class="token operator">:</span>
</span><span class="code-line">     <span class="token maybe-class-name">Wait</span> <span class="token keyword control-flow">for</span> <span class="token constant">SIGINT</span> <span class="token punctuation">(</span><span class="token maybe-class-name">Ctrl</span><span class="token operator">-</span><span class="token constant">C</span><span class="token punctuation">)</span>
</span></code></pre></div><h3 class="content-header" id="data-collection-multi-threaded"><a class="break-words" href="#data-collection-multi-threaded" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Data Collection (Multi-threaded)</h3><p>Once initialization completes, iaprof runs several threads concurrently, each collecting different types of data. These threads operate independently but coordinate through the shared GPU kernel store. This multi-threaded design allows iaprof to handle high event rates without dropping data.</p><p><strong>BPF Thread</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>should_stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">epoll_wait</span><span class="token punctuation">(</span>rb_fd<span class="token punctuation">)</span>  <span class="token comment">// Block until events</span>
</span><span class="code-line">    <span class="token function">ring_buffer__poll</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>
</span><span class="code-line">        ↓ callback <span class="token keyword control-flow">for</span> each event
</span><span class="code-line">    <span class="token function">handle_execbuf_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ shader <span class="token operator">=</span> <span class="token function">acquire_or_create_shader</span><span class="token punctuation">(</span>gpu_addr<span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ shader<span class="token operator">-</span><span class="token operator">&gt;</span>pid <span class="token operator">=</span> execbuf<span class="token operator">-</span><span class="token operator">&gt;</span>pid
</span><span class="code-line">        ├─→ shader<span class="token operator">-</span><span class="token operator">&gt;</span>ustack_id <span class="token operator">=</span> <span class="token function">store_stack</span><span class="token punctuation">(</span>execbuf<span class="token operator">-</span><span class="token operator">&gt;</span>ustack<span class="token punctuation">)</span>
</span><span class="code-line">        └─→ <span class="token function">release_shader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">handle_ksp_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ shader <span class="token operator">=</span> <span class="token function">acquire_shader</span><span class="token punctuation">(</span>ksp<span class="token operator">-</span><span class="token operator">&gt;</span>gpu_addr<span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ shader<span class="token operator">-</span><span class="token operator">&gt;</span>type <span class="token operator">=</span> <span class="token constant">SHADER_TYPE_SHADER</span>
</span><span class="code-line">        └─→ <span class="token function">release_shader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>EU Stall Thread</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>should_stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">debug_read_eustall_sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sample<span class="token punctuation">)</span>  <span class="token comment">// Block until sample</span>
</span><span class="code-line">    <span class="token function">handle_eustall_sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sample<span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ addr <span class="token operator">=</span> sample<span class="token punctuation">.</span><span class="token property-access">ip</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span>
</span><span class="code-line">        ├─→ shader <span class="token operator">=</span> <span class="token function">acquire_containing_shader</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
</span><span class="code-line">        ├─→ <span class="token keyword control-flow">if</span> <span class="token literal-property property">shader</span><span class="token operator">:</span>
</span><span class="code-line">        │   ├─→ offset <span class="token operator">=</span> addr <span class="token operator">-</span> shader<span class="token operator">-</span><span class="token operator">&gt;</span>gpu_addr
</span><span class="code-line">        │   ├─→ profile <span class="token operator">=</span> shader<span class="token operator">-</span><span class="token operator">&gt;</span>stall_counts<span class="token punctuation">[</span>offset<span class="token punctuation">]</span>
</span><span class="code-line">        │   ├─→ profile<span class="token operator">-</span><span class="token operator">&gt;</span>active <span class="token operator">+=</span> sample<span class="token punctuation">.</span><span class="token property-access">active</span>
</span><span class="code-line">        │   └─→ <span class="token operator spread">...</span> <span class="token punctuation">(</span>other stall types<span class="token punctuation">)</span>
</span><span class="code-line">        └─→ <span class="token keyword control-flow">else</span><span class="token operator">:</span>
</span><span class="code-line">            └─→ add to deferred_eustall_waitlist
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Debug Thread</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>should_stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">debug_wait_event</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">)</span>  <span class="token comment">// Block until event</span>
</span><span class="code-line">    <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">case</span> <span class="token constant">SHADER_UPLOAD</span><span class="token operator">:</span>
</span><span class="code-line">        shader <span class="token operator">=</span> <span class="token function">acquire_shader</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">addr</span><span class="token punctuation">)</span>
</span><span class="code-line">        shader<span class="token operator">-</span><span class="token operator">&gt;</span>binary <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token function">memcpy</span><span class="token punctuation">(</span>shader<span class="token operator">-</span><span class="token operator">&gt;</span>binary<span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token property-access">size</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token function">release_shader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token function">signal_deferred_attrib_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// Wake deferred thread</span>
</span><span class="code-line">        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">case</span> <span class="token constant">CONTEXT_CREATE</span><span class="token operator">:</span>
</span><span class="code-line">        <span class="token function">track_context_vm_mapping</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Deferred Attribution Thread</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token keyword control-flow">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>should_stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>deferred_cond<span class="token punctuation">)</span>  <span class="token comment">// Wait for signal</span>
</span><span class="code-line">    <span class="token keyword control-flow">for</span> each deferred_sample <span class="token keyword">in</span> <span class="token literal-property property">waitlist</span><span class="token operator">:</span>
</span><span class="code-line">        shader <span class="token operator">=</span> <span class="token function">acquire_containing_shader</span><span class="token punctuation">(</span>deferred_sample<span class="token punctuation">.</span><span class="token property-access">addr</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword control-flow">if</span> <span class="token literal-property property">shader</span><span class="token operator">:</span>
</span><span class="code-line">            <span class="token function">associate_sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>deferred_sample<span class="token punctuation">,</span> shader<span class="token punctuation">)</span>
</span><span class="code-line">            deferred_sample<span class="token punctuation">.</span><span class="token property-access">satisfied</span> <span class="token operator">=</span> <span class="token number">1</span>
</span><span class="code-line">        <span class="token function">release_shader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
</span><span class="code-line">    remove satisfied samples <span class="token keyword module">from</span> waitlist
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 class="content-header" id="shutdown-and-output"><a class="break-words" href="#shutdown-and-output" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Shutdown and Output</h3><p>When profiling ends (either because a profiled command exits or the user presses Ctrl-C), iaprof performs an orderly shutdown. This involves stopping all collector threads, processing any remaining deferred samples, walking through the entire shader store to generate output, and cleaning up resources.</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token constant">SIGINT</span> received
</span><span class="code-line">    ↓
</span><span class="code-line">collect_threads_should_stop <span class="token operator">=</span> <span class="token constant">STOP_REQUESTED</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token maybe-class-name">Join</span> all collector threads
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token maybe-class-name">Process</span> remaining deferred <span class="token function">samples</span> <span class="token punctuation">(</span>final retry<span class="token punctuation">)</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token constant">FOR_SHADER</span> <span class="token punctuation">(</span>shader <span class="token keyword">in</span> shaders tree<span class="token punctuation">)</span><span class="token operator">:</span>
</span><span class="code-line">    <span class="token function">pthread_rwlock_rdlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>shaders_lock<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword control-flow">for</span> <span class="token function">each</span> <span class="token punctuation">(</span>offset<span class="token punctuation">,</span> stall_profile<span class="token punctuation">)</span> <span class="token keyword">in</span> shader<span class="token operator">-</span><span class="token operator">&gt;</span>stall_counts<span class="token operator">:</span>
</span><span class="code-line">        cpu_stack_str <span class="token operator">=</span> <span class="token function">resolve_stack</span><span class="token punctuation">(</span>shader<span class="token operator">-</span><span class="token operator">&gt;</span>ustack_id<span class="token punctuation">,</span> shader<span class="token operator">-</span><span class="token operator">&gt;</span>pid<span class="token punctuation">)</span>
</span><span class="code-line">        kernel_name <span class="token operator">=</span> <span class="token function">get_kernel_name</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span>
</span><span class="code-line">        inst_str <span class="token operator">=</span> <span class="token function">disassemble</span><span class="token punctuation">(</span>shader<span class="token operator">-</span><span class="token operator">&gt;</span>binary<span class="token punctuation">,</span> offset<span class="token punctuation">)</span>
</span><span class="code-line">        stalls_str <span class="token operator">=</span> <span class="token function">format_stalls</span><span class="token punctuation">(</span>stall_profile<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s;%s;%s %s\n&quot;</span><span class="token punctuation">,</span> cpu_stack_str<span class="token punctuation">,</span> kernel_name<span class="token punctuation">,</span> inst_str<span class="token punctuation">,</span> stalls_str<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>shaders_lock<span class="token punctuation">)</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token literal-property property">Cleanup</span><span class="token operator">:</span>
</span><span class="code-line">    <span class="token function">deinit_bpf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">deinit_debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">deinit_eustall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">free_profiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    ↓
</span><span class="code-line"><span class="token maybe-class-name">Exit</span>
</span></code></pre></div><h2 class="content-header" id="key-design-decisions"><a class="break-words" href="#key-design-decisions" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Key Design Decisions</h2><p>Throughout iaprof&#x27;s development, the team made several critical architectural choices that fundamentally shaped how the tool works. Understanding these decisions provides insight into the trade-offs involved in building a production-quality GPU profiler.</p><h3 class="content-header" id="1-why-ebpf"><a class="break-words" href="#1-why-ebpf" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>1. Why eBPF?</h3><p>The decision to use eBPF for kernel-level tracing was fundamental to iaprof&#x27;s design. Traditional approaches would require either a custom kernel module (difficult to maintain across kernel versions) or heavy instrumentation of the application (defeats the goal of transparent profiling). eBPF provides a middle ground that&#x27;s both powerful and safe.</p><p>eBPF brings significant advantages: no kernel module is required, eliminating complex build and distribution issues; programs are verified by the kernel before loading, ensuring safety and preventing crashes; JIT compilation provides high performance approaching native code; and the comprehensive tracing capabilities allow hooking virtually any kernel function. However, there are trade-offs. The eBPF verifier imposes complexity constraints including instruction count limits and requirements for bounded loops, making sophisticated parsing logic challenging to implement. The system requires BTF (BPF Type Format) type information to be available in the kernel, and needs a relatively recent kernel version (5.8 or later) for the CO-RE (Compile Once, Run Everywhere) features that iaprof relies on.</p><h3 class="content-header" id="2-why-in-kernel-batch-buffer-parsing"><a class="break-words" href="#2-why-in-kernel-batch-buffer-parsing" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>2. Why In-Kernel Batch Buffer Parsing?</h3><p>One of the most complex parts of iaprof is the batch buffer parser that runs inside the kernel via eBPF. An alternative would be to copy batch buffers to userspace and parse them there, which would be simpler to implement and debug. However, the team chose in-kernel parsing for important practical reasons.</p><p><strong>Alternative</strong>: Parse in userspace after capturing buffer</p><p><strong>Chosen</strong>: Parse in kernel with eBPF</p><p><strong>Rationale</strong>:</p><p>Copying batch buffers to userspace would be expensive since these buffers can be megabytes in size, adding significant overhead to every GPU submission. More critically, the parsing needs to happen before the buffer is reused or unmapped by the driver, which could happen immediately after submission. The deferred parsing mechanism handles the case where buffers aren&#x27;t yet complete when first intercepted, retrying later when the data is ready.</p><p><strong>Trade-off</strong>: Higher kernel overhead, but more reliable</p><h3 class="content-header" id="3-why-deferred-attribution"><a class="break-words" href="#3-why-deferred-attribution" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>3. Why Deferred Attribution?</h3><p><strong>Problem</strong>: EU stall samples can arrive before shader metadata</p><p><strong>Solution</strong>: Waitlist with retry mechanism</p><p><strong>Triggered by</strong>:</p><ul><li>New shader arrival (debug collector signals)</li><li>Periodic retry (every N seconds)</li><li>Final cleanup (at shutdown)</li></ul><h3 class="content-header" id="4-why-two-level-locking"><a class="break-words" href="#4-why-two-level-locking" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>4. Why Two-Level Locking?</h3><p><strong>Alternative</strong>: Global lock for entire shader tree</p><p><strong>Chosen</strong>: RW-lock on tree + per-shader mutex</p><p><strong>Benefits</strong>:</p><p>The two-level locking approach enables multiple readers to traverse the shader tree concurrently without blocking each other, which is crucial for lookup-heavy workloads. Stall attribution can proceed on one shader while other collectors work on different shaders, preventing bottlenecks. This fine-grained locking strategy significantly reduces contention compared to a global lock, allowing the profiler to scale efficiently with the number of shaders and collection threads.</p><h3 class="content-header" id="5-why-folded-stack-format"><a class="break-words" href="#5-why-folded-stack-format" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>5. Why Folded Stack Format?</h3><p><strong>Alternative</strong>: Custom binary format, JSON, protobuf</p><p><strong>Chosen</strong>: Text-based folded stacks</p><p><strong>Rationale</strong>:</p><p>The text-based folded stack format provides multiple advantages over binary alternatives. It&#x27;s compatible with Brendan Gregg&#x27;s existing FlameGraph ecosystem, allowing iaprof to leverage mature, well-tested visualization tools. The human-readable format makes debugging and validation straightforward - you can simply look at the output to verify correctness. Standard Unix tools like grep, sed, and awk can easily filter and transform the data for custom analyses. Despite being text-based, the format is remarkably compact due to its deduplication strategy where identical stack prefixes are represented once with semicolon-separated paths.</p><h2 class="content-header" id="performance-characteristics"><a class="break-words" href="#performance-characteristics" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Performance Characteristics</h2><h3 class="content-header" id="overhead"><a class="break-words" href="#overhead" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Overhead</h3><p><strong>i915 Driver</strong>:</p><ul><li><strong>BPF Collection</strong>: 10-20% (batch buffer parsing expensive)</li><li><strong>EU Stall</strong>: 2-5% (hardware sampling + attribution)</li><li><strong>Debug</strong>: 1-3% (event-driven)</li><li><strong>Total</strong>: 15-30% (workload-dependent)</li></ul><p><strong>Xe Driver</strong>:</p><ul><li><strong>BPF Collection</strong>: 3-5% (simpler batch buffer handling)</li><li><strong>EU Stall</strong>: 2-5%</li><li><strong>Debug</strong>: 1-3%</li><li><strong>Total</strong>: 5-10% (generally lower)</li></ul><h3 class="content-header" id="scalability"><a class="break-words" href="#scalability" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Scalability</h3><p><strong>Number of Shaders</strong>: O(log n) lookup, O(n) iteration</p><p><strong>Number of EU Stall Samples</strong>: O(1) attribution (hash table)</p><p><strong>Stack Depth</strong>: Linear in depth (but capped at 512)</p><p><strong>Multi-GPU</strong>: Currently limited to first GPU found</p><h3 class="content-header" id="memory-usage"><a class="break-words" href="#memory-usage" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Memory Usage</h3><p><strong>Typical</strong>:</p><ul><li>Shader store: 100-500 MB (depends on number/size of shaders)</li><li>eBPF ringbuffer: 512 MB (fixed)</li><li>Symbol caches: 50-200 MB (per-PID symbol tables)</li><li><strong>Total</strong>: 1-2 GB</li></ul><h2 class="content-header" id="platform-support"><a class="break-words" href="#platform-support" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Platform Support</h2><h3 class="content-header" id="supported-hardware"><a class="break-words" href="#supported-hardware" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Supported Hardware</h3><div class="w-full overflow-x-auto"><table><thead><tr><th>Platform</th><th>Architecture</th><th>Driver</th><th>Status</th></tr></thead><tbody><tr><td>Ponte Vecchio (PVC)</td><td>Xe HPC</td><td>i915 (patched)</td><td>Fully supported</td></tr><tr><td>Battlemage (BMG)</td><td>Xe2</td><td>Xe</td><td>Fully supported</td></tr><tr><td>Lunar Lake</td><td>Xe2</td><td>Xe</td><td>Supported (iGPU)</td></tr><tr><td>Meteor Lake</td><td>Xe</td><td>Xe</td><td>Partial support</td></tr><tr><td>Older Gen9-Gen12</td><td>Various</td><td>i915</td><td>Limited support</td></tr></tbody></table></div><h3 class="content-header" id="kernel-requirements"><a class="break-words" href="#kernel-requirements" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Kernel Requirements</h3><ul><li><strong>Linux 5.8+</strong>: eBPF CO-RE support</li><li><strong>BTF</strong>: <code>/sys/kernel/btf/vmlinux</code> must exist</li><li><strong>i915 debug</strong>: Requires Intel backport kernel with <code>PRELIM_DRM_I915_DEBUG</code> patches</li><li><strong>Xe debug</strong>: Mainline support in Linux 6.2+, full support in 6.6+</li></ul><h2 class="content-header" id="future-enhancements"><a class="break-words" href="#future-enhancements" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Future Enhancements</h2><h3 class="content-header" id="planned-features"><a class="break-words" href="#planned-features" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Planned Features</h3><ol><li><strong>Multi-GPU Profiling</strong>: Profile multiple GPUs simultaneously</li><li><strong>JSON Output</strong>: Structured output for analysis tools</li><li><strong>Differential Profiling</strong>: Compare two profile runs</li><li><strong>Continuous Profiling</strong>: Lower overhead, always-on mode</li><li><strong>TUI</strong>: Terminal UI for live profiling</li><li><strong>Remote Profiling</strong>: Profile remote systems</li><li><strong>Container Support</strong>: Profile containerized GPU workloads</li></ol><h3 class="content-header" id="research-directions"><a class="break-words" href="#research-directions" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Research Directions</h3><ol><li><strong>ML-Based Bottleneck Detection</strong>: Automatically identify performance issues</li><li><strong>Predictive Profiling</strong>: Suggest optimizations based on patterns</li><li><strong>Cross-Platform Support</strong>: NVIDIA, AMD GPU support</li><li><strong>Distributed Profiling</strong>: Multi-node GPU cluster profiling</li></ol><h2 class="content-header" id="references"><a class="break-words" href="#references" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>References</h2><h3 class="content-header" id="external-resources"><a class="break-words" href="#external-resources" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>External Resources</h3><ul><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://www.brendangregg.com/flamegraphs.html">FlameGraph</a> - Original flame graph concept</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://www.brendangregg.com/blog/2024-10-29/ai-flame-graphs.html">AI Flame Graphs</a> - iaprof announcement blog</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://ebpf.io/">eBPF Documentation</a> - eBPF programming guide</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="https://www.intel.com/content/www/us/en/developer/articles/technical/overview-of-the-compute-architecture-of-intel-processor-graphics-gen11.html">Intel GPU Architecture</a> - Gen11 architecture (similar to PVC/Xe)</li></ul><h3 class="content-header" id="internal-documentation"><a class="break-words" href="#internal-documentation" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Internal Documentation</h3><ul><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="src/README.md"><code>src/README.md</code></a> - Source code overview</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="src/collectors/bpf/README.md"><code>src/collectors/bpf/README.md</code></a> - BPF collector details</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="src/stores/README.md"><code>src/stores/README.md</code></a> - GPU kernel store internals</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="docs/README.pvc.md"><code>docs/README.pvc.md</code></a> - PVC-specific setup (if exists)</li><li><a class="break-words" target="_blank" rel="noopener noreferrer" href="docs/README.bmg.md"><code>docs/README.bmg.md</code></a> - Battlemage-specific setup (if exists)</li></ul><h2 class="content-header" id="flame-graph-generation-pipeline"><a class="break-words" href="#flame-graph-generation-pipeline" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Flame Graph Generation Pipeline</h2><p>The transformation from raw profiling data to interactive flame graphs involves multiple stages, each adding value and enabling different analyses. Understanding this pipeline helps explain why iaprof uses its particular data formats and how the tool chains together.</p><h3 class="content-header" id="stage-1-data-collection-record-command"><a class="break-words" href="#stage-1-data-collection-record-command" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Stage 1: Data Collection (record command)</h3><p>The <code>iaprof record</code> command captures raw profiling data and outputs it in a structured text format. This intermediate format serves as a language between iaprof&#x27;s internal representation and the flame graph visualization tools.</p><p><strong>Input</strong>: GPU execution + hardware sampling <strong>Output</strong>: Intermediate profile format (structured text) <strong>Location</strong>: <code>src/commands/record.c</code>, collectors</p><h4 class="content-header" id="collected-data-per-sample"><a class="break-words" href="#collected-data-per-sample" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Collected Data Per Sample</h4><p>For each EU stall sample, the record command collects:</p><p><strong>Process Context</strong>:</p><ul><li>PID, TID, CPU, timestamp</li><li>Process name (16 chars)</li></ul><p><strong>CPU Execution Context</strong>:</p><ul><li>User-space stack (up to 512 frames)</li><li>Kernel stack (up to 512 frames)</li></ul><p><strong>GPU Execution Context</strong>:</p><ul><li>GPU instruction pointer (IP)</li><li>Shader GPU address</li><li>Shader binary (from debug collector)</li></ul><p><strong>Performance Metrics</strong>:</p><ul><li>EU stall type breakdown (active, control, send, sync, etc.)</li><li>Sample counts per stall type</li></ul><h4 class="content-header" id="output-format"><a class="break-words" href="#output-format" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Output Format</h4><p>The record command outputs a custom structured format:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>string_value<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token constant">PROC_NAME</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>proc_name_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token constant">USTACK</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>ustack_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>frame1<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>frame2<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator spread">...</span>
</span><span class="code-line"><span class="token constant">KSTACK</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>kstack_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>frame1<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>frame2<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator spread">...</span>
</span><span class="code-line"><span class="token constant">GPU_FILE</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>gpu_file_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token constant">GPU_SYMBOL</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>gpu_symbol_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>symbol_name<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token constant">INSN_TEXT</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>insn_text_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>instruction_text<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token constant">EUSTALL</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>proc_name_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>ustack_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>kstack_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>gpu_file_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>gpu_symbol_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>insn_text_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>stall_type_id<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token operator">&lt;</span>count<span class="token operator">&gt;</span>
</span></code></pre></div><p><strong>Key Features</strong>:</p><p>The format incorporates several optimizations to reduce file size and improve processing efficiency. String interning ensures that repeated strings (like library names or function names) are stored only once, with subsequent references using compact numeric IDs. Stack deduplication means identical call stacks are assigned the same ID and only serialized once, dramatically reducing output size for workloads with repetitive execution patterns. The structured event system uses different event types (STRING for string definitions, EUSTALL for stall samples, etc.) to clearly delineate different kinds of profiling data.</p><p><strong>Example</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">;</span>python3<span class="token punctuation">.</span><span class="token number">11</span>
</span><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token number">2</span><span class="token punctuation">;</span>libpython3<span class="token punctuation">.</span><span class="token number">11</span><span class="token punctuation">.</span><span class="token property-access">so</span><span class="token punctuation">.</span><span class="token number">1.0</span>
</span><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token maybe-class-name">PyEval_EvalFrameDefault</span>
</span><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">;</span>libze_loader<span class="token punctuation">.</span><span class="token property-access">so</span><span class="token punctuation">.</span><span class="token number">1</span>
</span><span class="code-line"><span class="token constant">STRING</span><span class="token punctuation">;</span><span class="token number">5</span><span class="token punctuation">;</span>zeCommandListAppendLaunchKernel
</span><span class="code-line"><span class="token constant">PROC_NAME</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">12345</span>
</span><span class="code-line"><span class="token constant">USTACK</span><span class="token punctuation">;</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token number">0x7f8000001234</span><span class="token punctuation">;</span><span class="token number">0x7f8000005678</span><span class="token punctuation">;</span><span class="token number">0x7f800000abcd</span>
</span><span class="code-line"><span class="token constant">KSTACK</span><span class="token punctuation">;</span><span class="token number">200</span><span class="token punctuation">;</span><span class="token number">0xffffffffc0123456</span><span class="token punctuation">;</span><span class="token number">0xffffffffc0234567</span>
</span><span class="code-line"><span class="token constant">GPU_FILE</span><span class="token punctuation">;</span><span class="token number">10</span><span class="token punctuation">;</span>my_kernel<span class="token punctuation">.</span><span class="token property-access">cpp</span>
</span><span class="code-line"><span class="token constant">GPU_SYMBOL</span><span class="token punctuation">;</span><span class="token number">11</span><span class="token punctuation">;</span>my_compute_kernel
</span><span class="code-line"><span class="token constant">INSN_TEXT</span><span class="token punctuation">;</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token function">mad</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> r10<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token operator">:</span>f r2<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">:</span>f r3<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">:</span>f r4<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">:</span>f
</span><span class="code-line"><span class="token constant">EUSTALL</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">12345</span><span class="token punctuation">;</span><span class="token number">100</span><span class="token punctuation">;</span><span class="token number">200</span><span class="token punctuation">;</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token number">11</span><span class="token punctuation">;</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">0x40</span><span class="token punctuation">;</span><span class="token number">1234</span>
</span></code></pre></div><p>This represents:</p><ul><li>Process: python3.11 (PID 12345)</li><li>User stack: 3 frames (resolved later)</li><li>Kernel stack: 2 frames (resolved later)</li><li>GPU kernel: my_compute_kernel in my_kernel.cpp</li><li>Instruction: <code>mad(8) ...</code> at offset 0x40</li><li>Stall count: 1234 samples</li></ul><h3 class="content-header" id="stage-2-intermediate-processing-flame-command"><a class="break-words" href="#stage-2-intermediate-processing-flame-command" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Stage 2: Intermediate Processing (flame command)</h3><p><strong>Input</strong>: Record output (structured text) <strong>Output</strong>: Folded stacks (semicolon-separated) <strong>Location</strong>: <code>src/commands/flame.c</code></p><h4 class="content-header" id="processing-steps"><a class="break-words" href="#processing-steps" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Processing Steps</h4><p><strong>Parse Structured Input</strong>:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>line<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    event <span class="token operator">=</span> <span class="token function">get_profile_event_func</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">case</span> PROFILE_EVENT_STRING<span class="token operator">:</span>
</span><span class="code-line">        <span class="token function">store_string</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">break</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">case</span> PROFILE_EVENT_EUSTALL<span class="token operator">:</span>
</span><span class="code-line">        <span class="token function">parse_eustall</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token function">aggregate_sample</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">break</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Aggregate Samples</strong>:</p><p>The flame command uses a hash table to deduplicate identical stack traces, combining their sample counts. The hash key consists of the complete stack fingerprint: process name, PID, user stack ID, kernel stack ID, GPU file, GPU symbol, instruction text, stall type, and instruction offset. The value is simply the accumulated count of how many times this exact stack was observed. This aggregation is crucial for reducing the data volume - a workload might generate millions of samples, but if they come from a few hot paths, they&#x27;ll collapse down to just a few unique stacks with large counts.</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token function">hash_table</span><span class="token punctuation">(</span>eustall_result<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span><span class="token punctuation">)</span> flame_counts<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">lookup <span class="token operator">=</span> <span class="token function">hash_table_get_val</span><span class="token punctuation">(</span>flame_counts<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>lookup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token operator">*</span>lookup <span class="token operator">+=</span> result<span class="token punctuation">.</span>samp_count<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">hash_table_insert</span><span class="token punctuation">(</span>flame_counts<span class="token punctuation">,</span> result<span class="token punctuation">,</span> result<span class="token punctuation">.</span>samp_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Resolve String IDs</strong>:</p><p>Before outputting the final folded stacks, all numeric string IDs must be converted back to their actual string values. The flame command maintains a string table built from the STRING events encountered earlier in the input stream, allowing efficient lookup of any string by its ID.</p><p><strong>Format Folded Stacks</strong>:</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>flame_fmt <span class="token operator">=</span> <span class="token string">&quot;%s;%u;%s%s-;%s_[G];%s_[G];%s_[g];%s_[g];0x%lx_[g]&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">printf</span><span class="token punctuation">(</span>flame_fmt<span class="token punctuation">,</span>
</span><span class="code-line">    proc_name<span class="token punctuation">,</span>        <span class="token comment">// Process name</span>
</span><span class="code-line">    pid<span class="token punctuation">,</span>              <span class="token comment">// Process ID</span>
</span><span class="code-line">    ustack<span class="token punctuation">,</span>           <span class="token comment">// User stack (semicolon-separated)</span>
</span><span class="code-line">    kstack<span class="token punctuation">,</span>           <span class="token comment">// Kernel stack (semicolon-separated)</span>
</span><span class="code-line">    gpu_file<span class="token punctuation">,</span>         <span class="token comment">// GPU source file</span>
</span><span class="code-line">    gpu_symbol<span class="token punctuation">,</span>       <span class="token comment">// GPU kernel name</span>
</span><span class="code-line">    insn_text<span class="token punctuation">,</span>        <span class="token comment">// GPU instruction</span>
</span><span class="code-line">    stall_type<span class="token punctuation">,</span>       <span class="token comment">// Stall type</span>
</span><span class="code-line">    offset<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// Instruction offset</span>
</span><span class="code-line"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;;%lu\n&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Sample count</span>
</span></code></pre></div><h4 class="content-header" id="folded-stack-format"><a class="break-words" href="#folded-stack-format" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Folded Stack Format</h4><p>Format: <code>frame1;frame2;...;frameN count</code></p><p><strong>Annotations</strong> (for coloring):</p><ul><li><code>_[G]</code>: GPU frame (uppercase G) - Major GPU components</li><li><code>_[g]</code>: GPU instruction frame (lowercase g) - Individual instructions</li><li><code>-</code>: Stack separator (between user and kernel)</li></ul><p><strong>Example Output</strong>:</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line">python3<span class="token punctuation">.</span><span class="token number">11</span><span class="token punctuation">;</span><span class="token number">12345</span><span class="token punctuation">;</span><span class="token maybe-class-name">PyEval_EvalFrameDefault</span><span class="token punctuation">;</span>zeCommandListAppendLaunchKernel<span class="token operator">-</span><span class="token punctuation">;</span>i915_gem_do_execbuffer_<span class="token punctuation">[</span><span class="token constant">G</span><span class="token punctuation">]</span><span class="token punctuation">;</span>my_kernel<span class="token punctuation">.</span><span class="token property-access">cpp_</span><span class="token punctuation">[</span><span class="token constant">G</span><span class="token punctuation">]</span><span class="token punctuation">;</span>my_compute_kernel_<span class="token punctuation">[</span><span class="token constant">G</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">mad</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>_<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">;</span>active_<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">;</span>0x40_<span class="token punctuation">[</span>g<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token number">1234</span>
</span></code></pre></div><p>Breaking down this stack (bottom to top):</p><div class="relative"><pre><code class="language-js code-highlight"><span class="code-line"><span class="token number">1.</span> python3<span class="token punctuation">.</span><span class="token number">11</span> <span class="token operator">-</span> <span class="token maybe-class-name">Process</span> name
</span><span class="code-line"><span class="token number">2.</span> <span class="token number">12345</span> <span class="token operator">-</span> <span class="token constant">PID</span>
</span><span class="code-line"><span class="token number">3.</span> <span class="token maybe-class-name">PyEval_EvalFrameDefault</span> <span class="token operator">-</span> <span class="token maybe-class-name">Python</span> interpreter frame
</span><span class="code-line"><span class="token number">4.</span> zeCommandListAppendLaunchKernel <span class="token operator">-</span> <span class="token maybe-class-name">Level</span> <span class="token maybe-class-name">Zero</span> <span class="token constant">API</span> call
</span><span class="code-line"><span class="token number">5.</span> <span class="token operator">-</span> <span class="token punctuation">(</span>dash<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token maybe-class-name">User</span><span class="token operator">/</span>kernel separator
</span><span class="code-line"><span class="token number">6.</span> i915_gem_do_execbuffer <span class="token operator">-</span> <span class="token maybe-class-name">Kernel</span> driver <span class="token keyword">function</span>
</span><span class="code-line"><span class="token number">7.</span> my_kernel<span class="token punctuation">.</span><span class="token property-access">cpp</span> <span class="token operator">-</span> <span class="token constant">GPU</span> source file
</span><span class="code-line"><span class="token number">8.</span> my_compute_kernel <span class="token operator">-</span> <span class="token constant">GPU</span> kernel <span class="token keyword">function</span>
</span><span class="code-line"><span class="token number">9.</span> <span class="token function property-access method">mad</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token constant">GPU</span> <span class="token function">instruction</span> <span class="token punctuation">(</span>multiply<span class="token operator">-</span>add<span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">-</span>wide <span class="token constant">SIMD</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token number">10.</span> active <span class="token operator">-</span> <span class="token maybe-class-name">Stall</span> type
</span><span class="code-line"><span class="token number">11.</span> <span class="token number">0x40</span> <span class="token operator">-</span> <span class="token maybe-class-name">Instruction</span> offset
</span><span class="code-line"><span class="token number">12.</span> <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token number">1234</span> samples
</span></code></pre></div><h3 class="content-header" id="stage-3-flame-graph-rendering-flamegraphpl"><a class="break-words" href="#stage-3-flame-graph-rendering-flamegraphpl" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Stage 3: Flame Graph Rendering (flamegraph.pl)</h3><p><strong>Input</strong>: Folded stacks <strong>Output</strong>: Interactive SVG <strong>Location</strong>: <code>deps/flamegraph/flamegraph.pl</code></p><p>This is Brendan Gregg&#x27;s FlameGraph toolkit, invoked as:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">flamegraph.pl <span class="token variable parameter">--colors</span><span class="token operator">=</span>gpu <span class="token variable parameter">--title</span><span class="token operator">=</span><span class="token string">&quot;AI Flame Graph&quot;</span> <span class="token operator">&lt;</span> folded_stacks.txt <span class="token operator">&gt;</span> flame.svg
</span></code></pre></div><h4 class="content-header" id="rendering-process"><a class="break-words" href="#rendering-process" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Rendering Process</h4><p><strong>Parse Folded Stacks</strong>:</p><div class="relative"><pre><code class="code-highlight language-perl"><span class="code-line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token filehandle symbol">&lt;STDIN&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    chomp<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^(.*)\s+(\d+)$/</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token variable">$stack</span> <span class="token operator">=</span> <span class="token variable">$1</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$2</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token variable">@frames</span> <span class="token operator">=</span> split <span class="token regex">/;/</span><span class="token punctuation">,</span> <span class="token variable">$stack</span><span class="token punctuation">;</span>
</span><span class="code-line">        accumulate<span class="token punctuation">(</span><span class="token operator">\</span><span class="token variable">@frames</span><span class="token punctuation">,</span> <span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><strong>Build Call Tree</strong>:</p><p>From the folded stacks, FlameGraph.pl constructs a hierarchical tree structure where each node contains a function name, sample count, and list of children. As it processes each stack, it merges common prefixes - stacks that share the same initial call path are represented by the same nodes in the tree, with branches only where execution diverges. This tree structure is what enables the characteristic flame graph visualization where wide bases represent common entry points and narrower tops show specialized execution paths.</p><p><strong>Calculate Widths</strong>:</p><p>The visual width of each frame in the flame graph is proportional to its sample count. The algorithm starts with the total image width (default 1200 pixels) and allocates space to each frame based on its percentage of total samples: <code>frame_width = (frame_count / total_samples) × image_width</code>. Frames narrower than a minimum threshold (default 0.1 pixels) are omitted entirely to avoid visual clutter and improve rendering performance.</p><p><strong>Assign Colors</strong>:</p><p>Color assignment uses the <code>--colors=gpu</code> custom palette optimized for CPU/GPU profiling. The coloring is annotation-based: frames marked with <code>_[G]</code> (uppercase) representing major GPU components render in bright blue or cyan, while <code>_[g]</code> (lowercase) frames for individual GPU instructions use light blue, stack separator frames marked with <code>-</code> appear in gray, and all other frames (CPU code) use warm colors in the yellow/orange/red spectrum. Within each color family, the specific hue varies based on a hash of the function name, ensuring the same function always gets the same color across different profile runs for easy visual comparison.</p><p><strong>Generate SVG</strong>:</p><p>The final step produces the interactive SVG visualization. Each frame becomes an SVG rectangle element with calculated x, y, width, and height attributes, filled with the assigned color. A text label containing the function name is overlaid on each rectangle. Embedded JavaScript provides rich interactivity: mouse-over displays a tooltip showing the full function name and percentage of total samples, clicking a frame zooms the view to show just that frame&#x27;s subtree, Ctrl+F enables searching and highlighting frames by name, and a reset button returns to the full view.</p><h4 class="content-header" id="svg-structure"><a class="break-words" href="#svg-structure" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>SVG Structure</h4><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  {/* Title */}
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AI Flame Graph<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line">  {/* Flame graph frames */}
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>func_g<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>python3.11 (1234 samples, 45%)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>540<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>16<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rgb(230,150,80)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>110<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>python3.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>func_g<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>PyEval_EvalFrameDefault (1000 samples, 36%)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>84<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>450<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>16<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rgb(240,160,90)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>94<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>PyEval_EvalFrameDefault<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line">  {/* GPU frames (blue) */}
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>func_g<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>my_compute_kernel (500 samples, 18%)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>36<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>225<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>16<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rgb(80,150,230)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>46<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>my_compute_kernel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line">  {/* GPU instruction (light blue) */}
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>func_g<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>mad(8) r10 (200 samples, 7%)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>90<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>16<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rgb(150,200,250)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>mad(8) r10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">
</span><span class="code-line">  {/* JavaScript for interactivity */}
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/ecmascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token cdata">&lt;![CDATA[
</span></span><span class="code-line"><span class="token cdata">      function zoom(e) { ... }
</span></span><span class="code-line"><span class="token cdata">      function search() { ... }
</span></span><span class="code-line"><span class="token cdata">      function reset() { ... }
</span></span><span class="code-line"><span class="token cdata">    ]]&gt;</span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl"><a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2Fiaprof-analysis">Discuss on Twitter</a> • <a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37/yunwei37-blog/blob/main/data/blog/iaprof-analysis.mdx">View on GitHub</a></div><div class="pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl" id="comment"><button>Load Comments</button></div></div><footer><div class="divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4">Tags</h2><div class="flex flex-wrap gap-2"><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/ebpf">ebpf</a><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/systems">systems</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-6 xl:py-8"><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Previous Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/agentsight_paper">AgentSight: Keeping Your AI Agents Under Control with eBPF-Powered System Observability</a></div></div><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Next Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/nvidia-open-driver-analysis">NVIDIA Open GPU Kernel Modules Comprehensive Source Code Analysis</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105" aria-label="Back to the blog" href="/blog">← Back to the blog</a></div></footer></div></div></article></section><!--$--><!--/$--></main><footer class="border-t border-gray-200/30 dark:border-gray-700/30 pt-8"><div class="flex flex-col items-center space-y-6"><div class="flex flex-wrap justify-center gap-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:yunwei356@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Mail</title><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://facebook.com"><span class="sr-only">facebook</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Facebook</title><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://youtube.com"><span class="sr-only">youtube</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Youtube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/yusheng-zheng-611920280"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Linkedin</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://bsky.app/"><span class="sr-only">bluesky</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Bluesky</title><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://x.com/yunwei37"><span class="sr-only">x</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.instagram.com"><span class="sr-only">instagram</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Instagram</title><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.threads.net"><span class="sr-only">threads</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://medium.com"><span class="sr-only">medium</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Medium</title><path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"></path></svg></a></div><div class="flex space-x-2 text-sm opacity-80"><div>Yusheng Zheng</div><div> • </div><div>© 2026</div><div> • </div><a class="hover:text-primary-500 transition-colors" href="/">云微的胡思乱想</a></div><div class="text-sm opacity-60"><a class="hover:text-primary-500 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div><script src="/_next/static/chunks/webpack-91cf1b3b084c6ba2.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1478,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"ThemeProviders\"]\n3:I[4091,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n4:I[9243,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"\"]\n5:I[7392,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"KBarSearchProvider\"]\n6:I[6874,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"\"]\ne:I[8393,[],\"\"]\n:HL[\"/_next/static/media/36966cca54120369-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4ac7c0f872b74ee7.css\",\"style\"]\n:HL[\"/_next/static/css/a06d7e24bf9a7d93.css\",\"style\"]\n:HL[\"/_next/static/css/7246298b30c42979.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"MYXrWUjg0HELsl6zLYF_6\",\"p\":\"\",\"c\":[\"\",\"blog\",\"iaprof-analysis\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"iaprof-analysis\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4ac7c0f872b74ee7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a06d7e24bf9a7d93.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_dd5b2f scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/static/favicons/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen\",\"children\":[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$L4\",null,{\"async\":true,\"defer\":true,\"src\":\"https://analytics.umami.is/script.js\"}],\"$undefined\",\"$undefined\"],[\"$\",\"div\",null,{\"className\":\"min-h-screen flex flex-col justify-center py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8\",\"children\":[\"$\",\"$L5\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30\",\"children\":[[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/\",\"aria-label\":\"yunwei37\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mr-3\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":40,\"height\":40,\"fill\":\"none\",\"children\":[[\"$\",\"defs\",null,{\"children\":[[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__a\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#06b6d4\",\"stopOpacity\":1}}]]}],[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__b\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#8b5cf6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}]]}]]}],[\"$\",\"circle\",null,{\"cx\":20,\"cy\":20,\"r\":18,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.1}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__a)\",\"d\":\"m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z\"}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__b)\",\"d\":\"m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z\",\"opacity\":0.8}],[\"$\",\"circle\",null,{\"cx\":32,\"cy\":12,\"r\":2,\"fill\":\"url(#logo_svg__b)\"}],[\"$\",\"circle\",null,{\"cx\":8,\"cy\":12,\"r\":1.5,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.6}]]}]}],[\"$\",\"div\",null,{\"className\":\"hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":\"yunwei37\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"no-scrollbar hidden items-center space-x-2 sm:flex\",\"children\":[[\"$\",\"$L6\",\"Blog\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$L6\",\"Docs\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/docs\",\"children\":\"Docs\"}],[\"$\",\"$L6\",\"Tags\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/tags\",\"children\":\"Tags\"}],[\"$\",\"$L6\",\"About\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/about\",\"children\":\"About\"}]]}],\"$L7\"]}]]}],\"$L8\",\"$L9\"]}]}]}]]}]}]]}]]}],{\"children\":[\"blog\",\"$La\",{\"children\":[[\"slug\",\"iaprof-analysis\",\"c\"],\"$Lb\",{\"children\":[\"__PAGE__\",\"$Lc\",{},null,false]},null,false]},null,false]},null,false],\"$Ld\",false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[4159,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"KBarButton\"]\n10:I[1762,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n11:I[7298,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n12:I[7555,[],\"\"]\n13:I[1295,[],\"\"]\n1e:I[9665,[],\"OutletBoundary\"]\n20:I[4911,[],\"AsyncMetadataOutlet\"]\n22:I[9665,[],\"ViewportBoundary\"]\n24:I[9665,[],\"MetadataBoundary\"]\n25:\"$Sreact.suspense\"\n7:[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"className\":\"p-2 rounded-lg transition-all duration-200\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"main\",null,{\"className\":\"py-6\",\"children\":[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pt-6 pb-8 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl leading-9 font-extrabold tracking-tight md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl leading-normal font-bold md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$L6\",null,{\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm leading-5 font-medium text-white shadow-xs transition-colors duration-150 hover:bg-blue-700 focus:outline-hidden dark:hover:bg-blue-500\",\"href\":\"/\",\"children\":\"Back to homepage\"}]]}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"footer\",null,{\"className\":\"border-t border-gray-200/30 dark:border-gray-700/30 pt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center space-y-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap justify-center gap-4\",\"children\":[[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"mailto:yunwei356@gmail.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mail\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 20 20\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Mail\"}],[\"$\",\"path\",null,{\"d\":\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\"}],[\"$\",\"path\",null,{\"d\":\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://facebook.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"facebook\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Facebook\"}],[\"$\",\"path\",null,{\"d\":\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://youtube.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"youtube\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Youtube\"}],[\"$\",\"path\",null,{\"d\":\"M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z\"}]]}]]}],\"$L14\",\"$L15\",\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\"]}],\"$L1b\",\"$L1c\"]}]}]\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nb:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nc:[\"$\",\"$1\",\"c\",{\"children\":[\"$L1d\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7246298b30c42979.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L1e\",null,{\"children\":[\"$L1f\",[\"$\",\"$L20\",null,{\"promise\":\"$@21\"}]]}]]}]\nd:[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L22\",null,{\"children\":\"$L23\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L24\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$25\",null,{\"fallback\":null,\"children\":\"$L26\"}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.linkedin.com/in/yusheng-zheng-611920280\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"linkedin\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Linkedin\"}],[\"$\",\"path\",null,{\"d\":\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"15:null\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://bsky.app/\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"bluesky\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Bluesky\"}],[\"$\",\"path\",null,{\"d\":\"M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://x.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"x\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"X\"}],[\"$\",\"path\",null,{\"d\":\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z\"}]]}]]}]\n27:T69f,"])</script><script>self.__next_f.push([1,"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"])</script><script>self.__next_f.push([1,"18:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.instagram.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"instagram\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Instagram\"}],[\"$\",\"path\",null,{\"d\":\"$27\"}]]}]]}]\n28:T498,"])</script><script>self.__next_f.push([1,"M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"])</script><script>self.__next_f.push([1,"19:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.threads.net\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"threads\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Threads\"}],[\"$\",\"path\",null,{\"d\":\"$28\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1a:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://medium.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"medium\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Medium\"}],[\"$\",\"path\",null,{\"d\":\"M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"div\",null,{\"className\":\"flex space-x-2 text-sm opacity-80\",\"children\":[[\"$\",\"div\",null,{\"children\":\"Yusheng Zheng\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2026\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$L6\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"href\":\"/\",\"children\":\"云微的胡思乱想\"}]]}]\n1c:[\"$\",\"div\",null,{\"className\":\"text-sm opacity-60\",\"children\":[\"$\",\"a\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/timlrx/tailwind-nextjs-starter-blog\",\"children\":\"Tailwind Nextjs Theme\"}]}]\n"])</script><script>self.__next_f.push([1,"29:I[1839,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\n2a:I[3063,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"1d:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling\\\",\\\"datePublished\\\":\\\"2025-10-11T16:00:00.000Z\\\",\\\"dateModified\\\":\\\"2025-10-11T16:00:00.000Z\\\",\\\"image\\\":\\\"/static/images/twitter-card.png\\\",\\\"url\\\":\\\"https://www.yunwei37.com/blog/iaprof-analysis\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Yusheng Zheng (云微)\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L29\",null,{}],[\"$\",\"article\",null,{\"className\":\"content-glass p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-4 text-center\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"space-y-4\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base leading-6 font-medium text-gray-600 dark:text-gray-300\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2025-10-11T16:00:00.000Z\",\"children\":\"Saturday, October 11, 2025\"}]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Authors\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0\",\"children\":[[\"$\",\"li\",\"Yusheng Zheng (云微)\",{\"className\":\"flex items-center space-x-3 glass p-4 rounded-xl\",\"children\":[[\"$\",\"$L2a\",null,{\"src\":\"/static/images/avatar.png\",\"width\":38,\"height\":38,\"alt\":\"avatar\",\"className\":\"h-10 w-10 rounded-full\"}],[\"$\",\"dl\",null,{\"className\":\"text-sm leading-5 font-medium whitespace-nowrap\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Name\"}],[\"$\",\"dd\",null,{\"className\":\"text-gray-900 dark:text-gray-100\",\"children\":\"Yusheng Zheng (云微)\"}],[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Twitter\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/yunwei37\",\"children\":\"@yunwei37\"}]}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"content-header\",\"id\":\"understanding-iaprof-a-deep-dive-into-aigpu-flame-graph-profiling\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#understanding-iaprof-a-deep-dive-into-aigpu-flame-graph-profiling\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling\"]}],\"$L2b\",\"$L2c\",\"$L2d\",\"$L2e\",\"$L2f\",\"$L30\",\"$L31\",\"$L32\",\"$L33\",\"$L34\",\"$L35\",\"$L36\",\"$L37\",\"$L38\",\"$L39\",\"$L3a\",\"$L3b\",\"$L3c\",\"$L3d\",\"$L3e\",\"$L3f\",\"$L40\",\"$L41\",\"$L42\",\"$L43\",\"$L44\",\"$L45\",\"$L46\",\"$L47\",\"$L48\",\"$L49\",\"$L4a\",\"$L4b\",\"$L4c\",\"$L4d\",\"$L4e\",\"$L4f\",\"$L50\",\"$L51\",\"$L52\",\"$L53\",\"$L54\",\"$L55\",\"$L56\",\"$L57\",\"$L58\",\"$L59\",\"$L5a\",\"$L5b\",\"$L5c\",\"$L5d\",\"$L5e\",\"$L5f\",\"$L60\",\"$L61\",\"$L62\",\"$L63\",\"$L64\",\"$L65\",\"$L66\",\"$L67\",\"$L68\",\"$L69\",\"$L6a\",\"$L6b\",\"$L6c\",\"$L6d\",\"$L6e\",\"$L6f\",\"$L70\",\"$L71\",\"$L72\",\"$L73\",\"$L74\",\"$L75\",\"$L76\",\"$L77\",\"$L78\",\"$L79\",\"$L7a\",\"$L7b\",\"$L7c\",\"$L7d\",\"$L7e\",\"$L7f\",\"$L80\",\"$L81\",\"$L82\",\"$L83\",\"$L84\",\"$L85\",\"$L86\",\"$L87\",\"$L88\",\"$L89\",\"$L8a\",\"$L8b\",\"$L8c\",\"$L8d\",\"$L8e\",\"$L8f\",\"$L90\",\"$L91\",\"$L92\",\"$L93\",\"$L94\",\"$L95\",\"$L96\",\"$L97\",\"$L98\",\"$L99\",\"$L9a\",\"$L9b\",\"$L9c\",\"$L9d\",\"$L9e\",\"$L9f\",\"$La0\",\"$La1\",\"$La2\",\"$La3\",\"$La4\",\"$La5\",\"$La6\",\"$La7\",\"$La8\",\"$La9\",\"$Laa\",\"$Lab\",\"$Lac\",\"$Lad\",\"$Lae\",\"$Laf\",\"$Lb0\",\"$Lb1\",\"$Lb2\",\"$Lb3\",\"$Lb4\",\"$Lb5\",\"$Lb6\",\"$Lb7\",\"$Lb8\",\"$Lb9\",\"$Lba\",\"$Lbb\",\"$Lbc\",\"$Lbd\",\"$Lbe\",\"$Lbf\",\"$Lc0\",\"$Lc1\",\"$Lc2\",\"$Lc3\",\"$Lc4\",\"$Lc5\",\"$Lc6\",\"$Lc7\",\"$Lc8\",\"$Lc9\",\"$Lca\",\"$Lcb\",\"$Lcc\",\"$Lcd\",\"$Lce\",\"$Lcf\",\"$Ld0\",\"$Ld1\",\"$Ld2\",\"$Ld3\",\"$Ld4\",\"$Ld5\",\"$Ld6\",\"$Ld7\",\"$Ld8\",\"$Ld9\",\"$Lda\",\"$Ldb\",\"$Ldc\",\"$Ldd\",\"$Lde\",\"$Ldf\",\"$Le0\",\"$Le1\",\"$Le2\",\"$Le3\",\"$Le4\",\"$Le5\",\"$Le6\",\"$Le7\",\"$Le8\",\"$Le9\",\"$Lea\",\"$Leb\",\"$Lec\",\"$Led\",\"$Lee\",\"$Lef\",\"$Lf0\",\"$Lf1\",\"$Lf2\",\"$Lf3\",\"$Lf4\",\"$Lf5\",\"$Lf6\",\"$Lf7\",\"$Lf8\",\"$Lf9\",\"$Lfa\",\"$Lfb\",\"$Lfc\",\"$Lfd\",\"$Lfe\",\"$Lff\",\"$L100\",\"$L101\",\"$L102\",\"$L103\",\"$L104\",\"$L105\",\"$L106\",\"$L107\",\"$L108\",\"$L109\",\"$L10a\",\"$L10b\",\"$L10c\",\"$L10d\",\"$L10e\",\"$L10f\",\"$L110\",\"$L111\",\"$L112\",\"$L113\",\"$L114\",\"$L115\",\"$L116\",\"$L117\",\"$L118\",\"$L119\",\"$L11a\",\"$L11b\",\"$L11c\",\"$L11d\",\"$L11e\",\"$L11f\",\"$L120\",\"$L121\",\"$L122\",\"$L123\",\"$L124\",\"$L125\",\"$L126\",\"$L127\",\"$L128\",\"$L129\",\"$L12a\",\"$L12b\",\"$L12c\",\"$L12d\",\"$L12e\",\"$L12f\",\"$L130\"]}],\"$L131\",\"$L132\"]}],\"$L133\"]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"135:I[2100,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\n1f5:I[1449,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\n2b:[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"An exploration of Intel's innovative profiling tool that bridges the gap between CPU and GPU execution\"}]}]\n2c:[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Project Link\"}],\": \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/intel/iaprof\",\"children\":\"github.com/intel/iaprof\"}],\" - Intel's AI/GPU flame graph profiler\"]}]}]\n2d:[\"$\",\"p\",null,{\"children\":\"If you've ever tried to optimize a GPU-accelerated machine learning workload, you've likely encountered a frustrating problem: your code runs on the CPU, but the performance bottlenecks live on the GPU. Traditional profiling tools show you one world or the other, but never both together. This disconnect makes it nearly impossible to understand which lines of your Python or C++ code are responsible for expensive GPU operations.\"}]\n2e:[\"$\",\"p\",null,{\"children\":[\"Enter \",[\"$\",\"strong\",null,{\"children\":\"iaprof\"}],\", Intel's solution to this observability challenge. At its core, iaprof is a profiling tool that generates what Intel calls \\\"AI Flame Graphs\\\" - interactive visualizations that seamlessly connect your application code to the GPU instructions it triggers, all while showing where performance is actually being lost. This blog post will take you on a deep dive into how iaprof works, the technologies it leverages, and the architecture that makes it possible.\"]}]\n"])</script><script>self.__next_f.push([1,"2f:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"the-visibility-gap-in-gpu-computing\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#the-visibility-gap-in-gpu-computing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"The Visibility Gap in GPU Computing\"]}]\n"])</script><script>self.__next_f.push([1,"30:[\"$\",\"p\",null,{\"children\":\"To appreciate what iaprof accomplishes, we need to understand the fundamental challenge of profiling GPU workloads. When you write code that uses GPUs for computation, there's an inherent disconnect between where you write code and where that code actually executes. Your application runs on the CPU, making calls to high-level frameworks like PyTorch or TensorFlow, which in turn call runtime libraries like Level Zero or CUDA, which eventually communicate with kernel drivers that manage the GPU hardware.\"}]\n31:[\"$\",\"p\",null,{\"children\":\"This deep software stack creates multiple layers of abstraction. By the time your matrix multiplication reaches the GPU, it's been transformed from Python through multiple runtime layers into GPU machine code - shader instructions executing on Execution Units (EUs) deep inside the silicon. When that operation runs slowly, traditional tools struggle to tell you why.\"}]\n32:[\"$\",\"p\",null,{\"children\":[\"General-purpose profilers like \",[\"$\",\"code\",null,{\"children\":\"perf\"}],\" or Intel VTune excel at showing CPU execution patterns. They can tell you exactly which CPU functions are consuming time, but they treat the GPU as an opaque black box. When your profile shows that most time is spent in \",[\"$\",\"code\",null,{\"children\":\"cudaLaunchKernel\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"zeCommandListAppendLaunchKernel\"}],\", you know you're waiting on the GPU, but not which specific GPU operations are slow or what those operations are actually doing.\"]}]\n33:[\"$\",\"p\",null,{\"children\":[\"GPU-specific profilers take the opposite approach. Tools like Intel GPA or \",[\"$\",\"code\",null,{\"children\":\"nvidia-smi\"}],\" provide detailed GPU metrics - memory bandwidth utilization, compute unit occupancy, instruction throughput. These metrics are invaluable for understanding GPU performance, but they lack the crucial connection back to your source code. You might see that a particular shader has memory access stalls, but determining which line of your training loop launched that shade"])</script><script>self.__next_f.push([1,"r requires manual detective work, correlating timestamps across separate CPU and GPU timelines.\"]}]\n"])</script><script>self.__next_f.push([1,"34:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"how-iaprof-bridges-the-gap\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#how-iaprof-bridges-the-gap\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"How iaprof Bridges the Gap\"]}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"p\",null,{\"children\":\"iaprof's innovation is creating a single, unified view that connects application code to GPU hardware performance. The tool combines three sophisticated techniques to achieve this visibility.\"}]\n36:[\"$\",\"p\",null,{\"children\":\"First, it uses eBPF (extended Berkeley Packet Filter) to trace GPU driver operations at the kernel level. eBPF is a Linux kernel technology that allows safe, verified programs to run inside the kernel with minimal overhead. iaprof's eBPF programs hook into the GPU driver's execution paths, intercepting every GPU kernel launch and capturing the complete CPU call stack at the moment of launch. This happens transparently, without requiring any modifications to your application code or even recompilation.\"}]\n37:[\"$\",\"p\",null,{\"children\":\"Second, iaprof leverages Intel's Observability Architecture (OA) for hardware sampling. The OA is a hardware feature built into modern Intel GPUs that can collect performance counter samples directly from the Execution Units with minimal overhead - typically under 5%. These samples capture detailed information about what's happening at the hardware level: which instructions are executing, what types of stalls are occurring (memory access, control flow, synchronization), and how frequently each pattern appears.\"}]\n38:[\"$\",\"p\",null,{\"children\":\"Third, the tool uses the GPU debug API to retrieve shader binaries and execution metadata. This allows iaprof to disassemble GPU machine code and map hardware samples to specific instructions, complete with human-readable assembly syntax.\"}]\n39:[\"$\",\"p\",null,{\"children\":\"The magic happens when iaprof combines these three data streams. For every GPU instruction that shows up in hardware sampling, the tool can trace back through the debug information to identify the shader, through the driver trace to find the kernel launch, and through the CPU stack capture to determine which application functions triggered that launch. The result is a complete execution path from your Python script or C++ applic"])</script><script>self.__next_f.push([1,"ation all the way down to the specific multiply-add instruction stalling on memory access inside the GPU.\"}]\n"])</script><script>self.__next_f.push([1,"3a:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"intel-gpu-architecture-background\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#intel-gpu-architecture-background\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Intel GPU Architecture Background\"]}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"p\",null,{\"children\":\"To understand how iaprof works, it's helpful to know the basics of Intel GPU architecture. Modern Intel GPUs are built around a hierarchy of parallel execution units designed for massive throughput.\"}]\n3c:[\"$\",\"p\",null,{\"children\":[\"At the lowest level are \",[\"$\",\"strong\",null,{\"children\":\"Execution Units (EUs)\"}],\", the fundamental compute cores of the GPU. Each EU contains a SIMD (Single Instruction Multiple Data) processor that can execute the same instruction across multiple data elements simultaneously - typically 8 or 16 elements wide depending on the architecture. Think of an EU as analogous to a CPU core, but optimized for data-parallel workloads rather than sequential code.\"]}]\n134:T49c,"])</script><script>self.__next_f.push([1,"Intel's use of SIMD differs from NVIDIA's SIMT (Single Instruction Multiple Thread) approach, though the distinction has blurred in modern architectures. In pure SIMD, all data lanes execute exactly the same instruction in lockstep with no per-lane control flow - if one lane needs to branch differently, all lanes must execute both paths with masking. NVIDIA's SIMT model, by contrast, treats each lane as an independent thread with its own instruction pointer and register file, allowing for more flexible divergence handling through hardware thread scheduling. Each NVIDIA \"warp\" contains 32 threads that preferentially execute together but can diverge when needed. However, Intel GPUs have evolved to include masked execution capabilities similar to SIMT, allowing individual SIMD lanes to be selectively enabled or disabled based on predicate masks. This hybrid approach gives Intel GPUs some SIMT-like flexibility while maintaining the efficiency of SIMD execution for uniform workloads. For profiling purposes, this means that control flow divergence can create performance artifacts where some EU lanes are active while others are masked off, wasting potential throughput."])</script><script>self.__next_f.push([1,"3d:[\"$\",\"p\",null,{\"children\":\"$134\"}]\n3e:[\"$\",\"p\",null,{\"children\":[\"EUs are organized into \",[\"$\",\"strong\",null,{\"children\":\"subslices\"}],\" (or \",[\"$\",\"strong\",null,{\"children\":\"Xe-cores\"}],\" in newer architectures), which group multiple EUs together with shared resources like a local L1 cache, texture sampling units, and load/store units. A subslice might contain 8-16 EUs working together. These subslices are further grouped into \",[\"$\",\"strong\",null,{\"children\":\"slices\"}],\", which share larger caches and memory controllers.\"]}]\n3f:[\"$\",\"p\",null,{\"children\":[\"When you launch a GPU kernel - whether it's a compute shader in SYCL, a CUDA kernel compiled for Intel, or a graphics shader in Vulkan - the GPU's thread dispatcher breaks your work into many parallel threads. These threads are grouped into \",[\"$\",\"strong\",null,{\"children\":\"SIMD lanes\"}],\" that execute together on an EU. The hardware automatically manages scheduling these threads across available EUs to maximize utilization.\"]}]\n40:[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"strong\",null,{\"children\":\"Observability Architecture (OA)\"}],\" is Intel's hardware performance monitoring system built into the GPU. It can sample the execution state of EUs at regular intervals, capturing which instruction each EU is executing and critically, what's preventing it from making progress. These \\\"stall types\\\" reveal whether an EU is actively computing, waiting for memory, blocked on control flow dependencies, or stalled on synchronization primitives.\"]}]\n41:[\"$\",\"p\",null,{\"children\":\"This is where iaprof's power comes from: by sampling EU stall states and correlating them with specific shader instructions and CPU call stacks, it reveals exactly where your code is losing performance - not just that a kernel is slow, but which specific instructions within that kernel are causing the bottleneck and what hardware resource they're waiting on.\"}]\n"])</script><script>self.__next_f.push([1,"42:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"the-architecture-inside-iaprof\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#the-architecture-inside-iaprof\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"The Architecture: Inside iaprof\"]}]\n"])</script><script>self.__next_f.push([1,"43:[\"$\",\"p\",null,{\"children\":[\"Understanding how iaprof works requires looking at its multi-threaded architecture. The tool runs as a privileged user-space application (requiring root or \",[\"$\",\"code\",null,{\"children\":\"CAP_PERFMON\"}],\" capabilities) that coordinates several concurrent collection threads, each gathering different pieces of the profiling puzzle.\"]}]\n"])</script><script>self.__next_f.push([1,"44:[\"$\",\"p\",null,{\"children\":\"At the heart of iaprof's approach is the combination of four key technologies working in concert. eBPF kernel tracing intercepts GPU driver calls to track kernel launches and memory mappings without requiring any code changes to the target application. Hardware sampling collects Execution Unit (EU) stall samples via Intel's Observability Architecture with less than 5% overhead, ensuring the profiler doesn't significantly perturb the workload being measured. The debug API retrieves shader binaries and detailed execution information enabling instruction-level analysis of what the GPU is actually doing. Finally, sophisticated symbol resolution translates raw memory addresses in both CPU and kernel stacks into human-readable symbols complete with file and line number information.\"}]\n"])</script><script>self.__next_f.push([1,"45:[\"$\",\"p\",null,{\"children\":\"The end result is an interactive flame graph showing the complete execution path from application code - whether that's Python, C++, or another language - through runtime libraries like PyTorch, Level Zero, or Vulkan, down through the kernel driver, all the way to specific GPU shader instructions. Each frame in this visualization is annotated with hardware stall metrics broken down by type: memory access stalls, control flow stalls, synchronization stalls, and more.\"}]\n"])</script><script>self.__next_f.push([1,"46:[\"$\",\"p\",null,{\"children\":\"This comprehensive visibility enables several critical use cases in modern GPU computing. Teams can optimize AI training and inference workloads by identifying exactly which parts of their neural network architecture are causing GPU performance bottlenecks. Graphics engineers can pinpoint bottlenecks in rendering pipelines and trace them back to the specific draw calls or shader code responsible. Machine learning engineers can understand and quantify the overhead introduced by framework layers, distinguishing between actual computation time and framework coordination overhead. Compiler teams can validate whether their GPU compiler optimizations are having the intended effect at the hardware level. And development teams can run performance regression testing to catch when code changes inadvertently introduce GPU performance issues.\"}]\n"])</script><script>self.__next_f.push([1,"47:[\"$\",\"p\",null,{\"children\":\"Currently, iaprof supports Intel Data Center GPU Max (Ponte Vecchio), Intel Arc B-series (Battlemage), and other Xe2-based GPUs, with ongoing work to expand hardware compatibility.\"}]\n"])</script><script>self.__next_f.push([1,"48:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"system-overview\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#system-overview\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"System Overview\"]}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"┌─────────────────────────────────────────────────────────────────────┐\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│                           \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"User\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Application\"}],\"                          │\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"│\"}],\"         \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"g\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"PyTorch\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"TensorFlow\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SYCL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Vulkan\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" etc\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"             │\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"└────────────────────────────┬────────────────────────────────────────┘\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                             │ \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"API\"}],\" calls\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"┌────────────────────────────▼────────────────────────────────────────┐\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│                     \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Runtime\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Libraries\"}],\"                                │\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"│\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Zero\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Vulkan\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"OpenCL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" oneDNN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" cuDNN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" etc\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"             │\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"└────────────────────────────┬────────────────────────────────────────┘\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                             │ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ioctl\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"┌────────────────────────────▼────────────────────────────────────────┐\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│                      \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Linux\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Kernel\"}],\"                                    │\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  ┌──────────────────┐  ┌─────────────────┐  ┌────────────────────┐ │\\n\"}],\"$L136\",\"$L137\",\"$L138\",\"$L139\",\"$L13a\",\"$L13b\",\"$L13c\",\"$L13d\",\"$L13e\",\"$L13f\",\"$L140\",\"$L141\",\"$L142\",\"$L143\",\"$L144\",\"$L145\",\"$L146\",\"$L147\",\"$L148\",\"$L149\",\"$L14a\",\"$L14b\",\"$L14c\",\"$L14d\",\"$L14e\",\"$L14f\",\"$L150\",\"$L151\",\"$L152\",\"$L153\",\"$L154\",\"$L155\",\"$L156\",\"$L157\",\"$L158\",\"$L159\",\"$L15a\",\"$L15b\",\"$L15c\",\"$L15d\",\"$L15e\",\"$L15f\",\"$L160\",\"$L161\",\"$L162\",\"$L163\",\"$L164\",\"$L165\",\"$L166\",\"$L167\",\"$L168\",\"$L169\",\"$L16a\",\"$L16b\",\"$L16c\",\"$L16d\",\"$L16e\",\"$L16f\",\"$L170\",\"$L171\",\"$L172\",\"$L173\",\"$L174\"]}]}]\n"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"core-components\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#core-components\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Core Components\"]}]\n"])</script><script>self.__next_f.push([1,"4b:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"1-ebpf-subsystem-kernel-space\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-ebpf-subsystem-kernel-space\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"1. eBPF Subsystem (Kernel Space)\"]}]\n"])</script><script>self.__next_f.push([1,"4c:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/collectors/bpf/bpf/*.bpf.c\"}]]}]\n4d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Purpose\"}],\": Trace GPU driver operations in real-time without modifying kernel source\"]}]\n"])</script><script>self.__next_f.push([1,"4e:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"key-ebpf-programs\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#key-ebpf-programs\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Key eBPF Programs\"]}]\n"])</script><script>self.__next_f.push([1,"4f:[\"$\",\"p\",null,{\"children\":\"iaprof uses several specialized eBPF programs, each targeting different aspects of GPU driver behavior. These programs work together to build a complete picture of what happens when your application submits work to the GPU.\"}]\n50:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"a) Execution Buffer Tracing\"}],\" (\",[\"$\",\"code\",null,{\"children\":\"i915/execbuffer.bpf.c\"}],\", \",[\"$\",\"code\",null,{\"children\":\"xe/exec.bpf.c\"}],\")\"]}]\n51:[\"$\",\"p\",null,{\"children\":[\"The execution buffer tracer is the cornerstone of iaprof's CPU-to-GPU correlation. It hooks into the critical moment when the GPU driver receives a submission request from userspace. This hook uses fexit (function exit) probes on \",[\"$\",\"code\",null,{\"children\":\"i915_gem_do_execbuffer\"}],\" for i915 driver or \",[\"$\",\"code\",null,{\"children\":\"xe_exec_ioctl\"}],\" for Xe driver, ensuring it captures the complete context after the driver has processed the submission.\"]}]\n52:[\"$\",\"p\",null,{\"children\":\"At this point, the tracer captures:\"}]\n53:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Execution buffer ID\"}],[\"$\",\"li\",null,{\"children\":\"VM and context IDs\"}],[\"$\",\"li\",null,{\"children\":[\"CPU user-space stack (via \",[\"$\",\"code\",null,{\"children\":\"bpf_get_stack\"}],\" with \",[\"$\",\"code\",null,{\"children\":\"BPF_F_USER_STACK\"}],\")\"]}],[\"$\",\"li\",null,{\"children\":[\"Kernel stack (via \",[\"$\",\"code\",null,{\"children\":\"bpf_get_stack\"}],\")\"]}],[\"$\",\"li\",null,{\"children\":\"Process metadata (PID, TID, CPU, timestamp, command name)\"}],[\"$\",\"li\",null,{\"children\":\"Batch buffer location (GPU address, CPU mapping)\"}]]}]\n54:[\"$\",\"p\",null,{\"children\":[\"Sends: \",[\"$\",\"code\",null,{\"children\":\"struct execbuf_info\"}],\" to ringbuffer\"]}]\n55:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"b) Batch Buffer Parser\"}],\" (\",[\"$\",\"code\",null,{\"children\":\"batchbuffer.bpf.c\"}],\")\"]}]\n56:[\"$\",\"p\",null,{\"children\":\"The batch buffer parser represents one of iaprof's most sophisticated eBPF components. Batch buffers are the command streams that tell the G"])</script><script>self.__next_f.push([1,"PU what to execute - they contain encoded instructions for loading shaders, configuring registers, and dispatching compute or graphics work. To correlate GPU execution with specific shaders, iaprof must parse these buffers to extract the addresses where shader code resides.\"}]\n57:[\"$\",\"p\",null,{\"children\":\"This parser runs in the same hook context as the execbuffer tracer, giving it access to the freshly submitted batch buffer. The parsing process:\"}]\n"])</script><script>self.__next_f.push([1,"58:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Translates\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" batch buffer address to \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CPU\"}],\" address using gpu_cpu_map\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Reads\"}],\" batch buffer \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" userspace \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"memory\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"bpf_probe_read_user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Parses\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" commands \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"DWORD\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"by\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"DWORD\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Identifies\"}],\" command type \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" bits \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"31\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"29\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Calculates\"}],\" command \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"length\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" or dynamic based on command\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Follows\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BATCH_BUFFER_START\"}],\" to chained \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"buffers\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"up to \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\" levels deep\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Extracts\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Kernel\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"State\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Pointers\"}]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"KSPs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"COMPUTE_WALKER\"}],\" and 3DSTATE commands\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Extracts\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"System\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Instruction\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Pointer\"}]}],\" \",\"$L175\",\"$L176\",\"$L177\",\" \",\"$L178\",\" \",\"$L179\",\"\\n\"]}],\"$L17a\",\"$L17b\"]}]}]\n"])</script><script>self.__next_f.push([1,"59:[\"$\",\"p\",null,{\"children\":\"Challenges:\"}]\n5a:[\"$\",\"p\",null,{\"children\":\"Implementing this parser within eBPF presents several significant challenges. The eBPF verifier imposes strict constraints including maximum instruction counts and requirements that all loops must be provably bounded, making complex parsing logic difficult to express. The parser must also handle race conditions where the batch buffer may not yet be fully written by userspace when the execbuffer ioctl is called, requiring deferred parsing with timers. Additionally, nested batch buffers that chain to other buffers require careful state tracking to avoid infinite loops while ensuring all shader pointers are discovered.\"}]\n5b:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"c) Memory Mapping Tracing\"}],\" (\",[\"$\",\"code\",null,{\"children\":\"i915/mmap.bpf.c\"}],\", \",[\"$\",\"code\",null,{\"children\":\"xe/mmap.bpf.c\"}],\")\"]}]\n5c:[\"$\",\"p\",null,{\"children\":\"GPU buffers live in a complex memory space with multiple address translations. A single buffer might have a GPU virtual address (what the GPU sees), a handle (what userspace uses to reference it), and a CPU virtual address (what the application can read/write). The memory mapping tracer maintains these translation tables, which are essential for the batch buffer parser to read GPU command streams from userspace memory.\"}]\n5d:[\"$\",\"p\",null,{\"children\":\"This tracer hooks:\"}]\n5e:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"i915_gem_mmap_offset_ioctl\"}],\" (fexit) - Records fake offset\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"i915_gem_mmap\"}],\" (fexit) - Captures CPU address, associates with handle\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"unmap_region\"}],\" (fentry) - Cleans up mappings on munmap\"]}]]}]\n5f:[\"$\",\"p\",null,{\"children\":[\"Maintains: \",[\"$\",\"code\",null,{\"children\":\"gpu_cpu_map\"}],\" (GPU addr → CPU addr) and \",[\"$\",\"code\",null,{\"children\":\"cpu_gpu_map\"}],\" (reverse)\"]}]\n60:[\"$\",\"p\",null,{\"children\":[[\"$\",\"st"])</script><script>self.__next_f.push([1,"rong\",null,{\"children\":\"d) VM Bind Tracing\"}],\" (\",[\"$\",\"code\",null,{\"children\":\"i915/vm_bind.bpf.c\"}],\", \",[\"$\",\"code\",null,{\"children\":\"xe/vm_bind.bpf.c\"}],\")\"]}]\n61:[\"$\",\"p\",null,{\"children\":\"Discrete GPUs (those with their own dedicated memory, separate from system RAM) use an additional layer of virtual memory management. Before the GPU can access a buffer, the buffer must be \\\"bound\\\" to a GPU virtual address within a specific virtual memory (VM) context. The VM bind tracer tracks these bindings, allowing iaprof to resolve GPU addresses back to the actual buffer contents.\"}]\n62:[\"$\",\"p\",null,{\"children\":\"This tracer hooks:\"}]\n63:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"i915_gem_vm_bind_ioctl\"}],\" / \",[\"$\",\"code\",null,{\"children\":\"xe_vm_bind\"}],\" (fexit)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"i915_gem_vm_unbind_ioctl\"}],\" / \",[\"$\",\"code\",null,{\"children\":\"xe_vm_unbind\"}],\" (fentry)\"]}]]}]\n64:[\"$\",\"p\",null,{\"children\":\"Purpose: For discrete GPUs, maps GPU virtual addresses to buffer handles and CPU addresses\"}]\n65:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"e) Context Tracking\"}],\" (\",[\"$\",\"code\",null,{\"children\":\"i915/context.bpf.c\"}],\", \",[\"$\",\"code\",null,{\"children\":\"xe/context.bpf.c\"}],\")\"]}]\n66:[\"$\",\"p\",null,{\"children\":\"GPU contexts are execution environments that encapsulate state like which VM is being used, what shaders are loaded, and various configuration settings. When an execution buffer is submitted, it's associated with a specific context. The context tracker maintains the mapping from context IDs to VM IDs, which is crucial for tying everything together - when we see a GPU address in a batch buffer, we need to know which VM context it belongs to in order to translate it correctly.\"}]\n67:[\"$\",\"p\",null,{\"children\":\"Tracks: Context ID → VM ID mapping\"}]\n68:[\"$\",\"p\",null,{\"children\":\"Needed: To resolve which VM an execbuffer belongs to\"}]\n"])</script><script>self.__next_f.push([1,"69:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"ebpf-maps\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#ebpf-maps\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"eBPF Maps\"]}]\n"])</script><script>self.__next_f.push([1,"6a:[\"$\",\"p\",null,{\"children\":\"eBPF maps are shared data structures that act as the communication and storage layer for the eBPF programs. They allow programs to share data with each other and with userspace, and persist state across multiple invocations. iaprof uses several key maps:\"}]\n"])</script><script>self.__next_f.push([1,"6b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"rb\"}],\" (ringbuffer)\"]}],\": Main output channel, 512 MB\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"gpu_cpu_map\"}]}],\": Hash table, GPU address → CPU address/size\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"cpu_gpu_map\"}]}],\": Reverse lookup\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deferred_parse\"}]}],\": Batch buffers awaiting retry\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"deferred_timers\"}]}],\": BPF timer wrappers for deferred parsing\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bb_ksps\"}]}],\": Per-CPU hash table of discovered KSPs\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"context_create_wait_for_exec\"}]}],\": Context → VM ID mappings\"]}]]}]\n"])</script><script>self.__next_f.push([1,"6c:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"2-userspace-bpf-collector\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-userspace-bpf-collector\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"2. Userspace BPF Collector\"]}]\n"])</script><script>self.__next_f.push([1,"6d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/collectors/bpf/bpf_collector.c\"}]]}]\n6e:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Responsibilities\"}],\":\"]}]\n6f:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Initialization\"}],\":\"]}]\n70:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Loads compiled eBPF object file (\",[\"$\",\"code\",null,{\"children\":\".bpf.o\"}],\")\"]}],[\"$\",\"li\",null,{\"children\":\"Resolves BTF relocations\"}],[\"$\",\"li\",null,{\"children\":\"Attaches programs to kernel tracepoints\"}],[\"$\",\"li\",null,{\"children\":\"Creates ringbuffer and maps file descriptors\"}]]}]\n71:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Event Loop\"}],\" (runs in dedicated thread):\"]}]\n72:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"epoll_wait()\"}],\" on ringbuffer file descriptor\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ring_buffer__poll()\"}],\" to consume events\"]}],[\"$\",\"li\",null,{\"children\":\"Dispatches to event handlers based on event type\"}]]}]\n73:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Event Handlers\"}],\":\"]}]\n74:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"EXECBUF\"}],\": Creates or updates shader in GPU kernel store\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"EXECBUF_END\"}],\": Marks batch buffer parsing complete\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"KSP\"}],\": Adds kernel pointer to shader\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SIP\"}],\": Adds system routine pointer\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"UPROBE_\"}],\"* (if enabled): User-space probe events\"]}]]}]\n"])</script><script>self.__next_f.push([1,"75:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"3-eu-stall-collector\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-eu-stall-collector\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"3. EU Stall Collector\"]}]\n"])</script><script>self.__next_f.push([1,"76:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/collectors/eustall/eustall_collector.c\"}]]}]\n77:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Purpose\"}],\": Collect and attribute hardware EU stall samples\"]}]\n78:[\"$\",\"p\",null,{\"children\":\"The EU stall collector is where iaprof connects hardware performance data to the execution context captured by eBPF. Intel's Observability Architecture continuously samples the GPU's Execution Units, recording which instruction is executing and what type of stall (if any) is occurring at each sample point. The EU stall collector receives these samples and attributes them to specific shaders and instruction offsets, building up a statistical profile of where the GPU is spending its time and what's causing performance bottlenecks.\"}]\n"])</script><script>self.__next_f.push([1,"79:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"data-flow\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#data-flow\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Data Flow\"]}]\n"])</script><script>self.__next_f.push([1,"7a:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Hardware\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Sampling\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"OA\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Debug\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Interface\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"struct eustall_sample \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    uint32_t ip\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"      \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// GPU instruction pointer (shifted by 3)\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    uint64_t active\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Active execution count\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    uint64_t control\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Control flow stall count\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    uint64_t send\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Memory access stall count\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... more stall types\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_eustall_sample\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    ├─→ addr \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ip \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    ├─→ shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_containing_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    ├─→ \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" shader found\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    │   ├─→ offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" addr \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"gpu_addr\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    │   └─→ shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"stall_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" sample counts\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    └─→ \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"        └─→ add to deferred_eustall_waitlist\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"7b:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"stall-types\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#stall-types\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Stall Types\"]}]\n"])</script><script>self.__next_f.push([1,"7c:[\"$\",\"p\",null,{\"children\":\"Understanding stall types is key to interpreting iaprof's output. Not all time on the GPU represents productive computation. The hardware distinguishes between several categories of execution state, from hardware sampling:\"}]\n"])</script><script>self.__next_f.push([1,"7d:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Active\"}],\": EU actively executing (not stalled)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Control\"}],\": Control flow dependencies (branches, predication)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Pipestall\"}],\": Pipeline resource stalls\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Send\"}],\": Memory/sampler/URB send stalls\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Dist_acc\"}],\": Distributed accumulator stalls\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SBID\"}],\": Scoreboard ID stalls (dependency chains)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Sync\"}],\": Synchronization (barriers, fences)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Inst_fetch\"}],\": Instruction fetch stalls\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"TDR\"}],\" (Xe only): Thread dispatch/retire stalls\"]}]]}]\n"])</script><script>self.__next_f.push([1,"7e:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"deferred-attribution\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#deferred-attribution\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Deferred Attribution\"]}]\n"])</script><script>self.__next_f.push([1,"7f:[\"$\",\"p\",null,{\"children\":\"One challenge in correlating hardware samples with shaders is timing - hardware samples can arrive before iaprof has received the shader metadata from the debug collector. This happens because the GPU might start executing a shader while the debug information is still being processed by the kernel and transmitted to userspace. Rather than discarding these samples, iaprof uses a deferred attribution mechanism.\"}]\n80:[\"$\",\"p\",null,{\"children\":\"When EU stall arrives before corresponding shader metadata:\"}]\n"])</script><script>self.__next_f.push([1,"81:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"deferred_eustall\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"eustall_sample\"}],\" sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" satisfied\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// 0 = still waiting, 1 = attributed\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"82:[\"$\",\"p\",null,{\"children\":\"These deferred samples are placed on a waitlist. A separate thread periodically retries attribution when new shaders arrive from the debug collector, eventually matching samples to their corresponding shaders. This ensures no performance data is lost, even when events arrive out of order.\"}]\n"])</script><script>self.__next_f.push([1,"83:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"4-debug-collector\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#4-debug-collector\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"4. Debug Collector\"]}]\n"])</script><script>self.__next_f.push([1,"84:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/collectors/debug/debug_collector.c\"}]]}]\n85:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Purpose\"}],\": Interface with GPU debug API for detailed execution information\"]}]\n86:[\"$\",\"p\",null,{\"children\":\"The debug collector interfaces with Intel's GPU debug API to access information that's not available through standard driver interfaces. This includes the actual compiled shader binaries, detailed context information, and fine-grained execution control. Without the debug API, iaprof would only have GPU addresses - the debug API provides the actual machine code at those addresses, enabling instruction-level disassembly and analysis.\"}]\n"])</script><script>self.__next_f.push([1,"87:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"capabilities\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#capabilities\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Capabilities\"]}]\n"])</script><script>self.__next_f.push([1,"88:[\"$\",\"p\",null,{\"children\":\"The debug collector provides several critical capabilities that enable deep GPU inspection. For shader binary collection, it receives shader upload events directly from the driver, copies the shader binary to the shader store, and enables instruction-level disassembly. This is essential for translating GPU instruction pointers into human-readable assembly code.\"}]\n89:[\"$\",\"p\",null,{\"children\":\"Context tracking is another key responsibility - the collector monitors context create and destroy events and tracks VM (virtual memory) associations. This information helps iaprof understand which memory space each shader operates in, crucial for correct address resolution.\"}]\n8a:[\"$\",\"p\",null,{\"children\":\"For deterministic sampling scenarios, the debug collector can exercise execution control by sending SIGSTOP signals to GPU processes for synchronized sampling and triggering EU attention events. This allows for more precise profiling in controlled environments.\"}]\n8b:[\"$\",\"p\",null,{\"children\":[\"The implementation varies by platform: on i915 systems, it uses \",[\"$\",\"code\",null,{\"children\":\"PRELIM_DRM_I915_DEBUG_*\"}],\" ioctls which require a patched kernel, while on Xe systems it uses \",[\"$\",\"code\",null,{\"children\":\"DRM_XE_EUDEBUG_*\"}],\" ioctls that have mainline support starting from Linux 6.2.\"]}]\n"])</script><script>self.__next_f.push([1,"8c:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"5-oa-collector\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#5-oa-collector\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"5. OA Collector\"]}]\n"])</script><script>self.__next_f.push([1,"8d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/collectors/oa/oa_collector.c\"}]]}]\n8e:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Purpose\"}],\": Initialize Observability Architecture hardware\"]}]\n8f:[\"$\",\"p\",null,{\"children\":\"The OA (Observability Architecture) collector is responsible for configuring Intel's hardware performance monitoring infrastructure. The OA is a dedicated hardware unit within Intel GPUs that can sample execution state with minimal performance impact. This collector sets up the OA hardware to specifically capture EU stall information, configuring sampling rates and which performance counters to monitor.\"}]\n"])</script><script>self.__next_f.push([1,"90:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"initialization-sequence\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#initialization-sequence\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Initialization Sequence\"]}]\n"])</script><script>self.__next_f.push([1,"91:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Open\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"DRM\"}],\" device\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Write\"}],\" to \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"OA\"}],\" control registers\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Enable\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"OA\"}],\" unit\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Configure\"}],\" sampling period\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Select\"}],\" counter \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"set\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EU\"}],\" stalls\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Enable\"}],\" triggers\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Start\"}],\" sampling\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"92:[\"$\",\"p\",null,{\"children\":\"Interfaces with EU stall collector to provide sample stream.\"}]\n"])</script><script>self.__next_f.push([1,"93:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"6-gpu-kernel-store\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#6-gpu-kernel-store\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"6. GPU Kernel Store\"]}]\n"])</script><script>self.__next_f.push([1,"94:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/stores/gpu_kernel.c\"}]]}]\n95:[\"$\",\"p\",null,{\"children\":\"The GPU kernel store is iaprof's central data repository - a thread-safe tree structure that maintains information about all discovered GPU shaders. Each shader entry contains not just the shader binary and GPU address, but also the CPU call stack that launched it and accumulated performance samples. This store acts as the meeting point where data from all the collectors comes together, enabling the correlation between CPU code, GPU shaders, and hardware performance metrics.\"}]\n96:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Data Structure\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"97:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"tree\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" shader_struct\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" shaders\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Global, sorted by GPU address\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"pthread_rwlock_t\"}],\" shaders_lock\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"          \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Protects tree operations\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"shader\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"pthread_mutex_t\"}],\" lock\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"                \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Per-shader lock\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Identity\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],\" gpu_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],\" size\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"enum\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"shader_type\"}],\" type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"               \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// SHADER, SYSTEM_ROUTINE, DEBUG_AREA\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Attribution\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint32_t\"}],\" pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],\" proc_name_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ustack_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" kstack_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],\" symbol_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" filename_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" linenum\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Binary\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"binary\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Profiling data\"}],\"\\n\"]}],\"$L17c\",\"$L17d\"]}]}]\n"])</script><script>self.__next_f.push([1,"98:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Thread Safety\"}],\":\"]}]\n99:[\"$\",\"p\",null,{\"children\":\"The GPU kernel store uses a sophisticated two-level locking strategy to maximize concurrency while maintaining data consistency. At the first level, a reader-writer lock protects the tree structure itself, allowing multiple threads to search for shaders concurrently while ensuring exclusive access for structural modifications. At the second level, each individual shader has its own mutex that protects its fields, enabling different threads to update different shaders simultaneously without contention. This design ensures that the high-frequency operations like stall attribution don't block other collectors from accessing the store.\"}]\n9a:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Operations\"}],\":\"]}]\n9b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"acquire_containing_shader(addr)\"}],\": Range query, finds shader where \",[\"$\",\"code\",null,{\"children\":\"addr ∈ [gpu_addr, gpu_addr+size)\"}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"acquire_or_create_shader(addr)\"}],\": Gets existing or allocates new\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"release_shader(shader)\"}],\": Unlocks shader mutex\"]}]]}]\n"])</script><script>self.__next_f.push([1,"9c:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"7-stack-printer\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#7-stack-printer\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"7. Stack Printer\"]}]\n"])</script><script>self.__next_f.push([1,"9d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/printers/stack/stack_printer.c\"}]]}]\n9e:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Purpose\"}],\": Transform collected data into folded stacks for flame graphs\"]}]\n9f:[\"$\",\"p\",null,{\"children\":\"The stack printer is the final transformation stage that converts iaprof's internal data structures into the \\\"folded stack\\\" text format that FlameGraph tools understand. This involves translating raw memory addresses from CPU call stacks into human-readable function names, file paths, and line numbers, then combining them with GPU shader names and instruction disassembly to create complete execution traces.\"}]\n"])</script><script>self.__next_f.push([1,"a0:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"symbol-resolution\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#symbol-resolution\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Symbol Resolution\"]}]\n"])</script><script>self.__next_f.push([1,"a1:[\"$\",\"p\",null,{\"children\":\"Symbol resolution is the process of converting raw instruction pointer addresses into meaningful names. The stack printer handles both kernel and user-space symbols differently, using appropriate symbol sources for each.\"}]\na2:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Kernel Symbols\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"a3:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ksyms\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ksyms \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ksyms_load\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Loads /proc/kallsyms\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ksym\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"sym \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ksyms_search\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ksyms\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"a4:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"User-Space Symbols\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"a5:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"syms_cache\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"cache \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"syms_cache_create\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Per-PID cache\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"sym\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"sym \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"syms_cache_get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"cache\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Parses ELF + DWARF to get function, file, line\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"a6:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"output-generation\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#output-generation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Output Generation\"]}]\n"])</script><script>self.__next_f.push([1,"a7:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"For\"}],\" each shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"For\"}],\" each offset \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"with\"}],\" stall counts\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Resolve\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CPU\"}],\" user stack to symbols\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" main\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"submit_kernel\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Append\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" kernel name\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" main\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"submit_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"my_compute_kernel\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Disassemble\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" instruction at offset\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mad\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" r10\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"f \",[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Format\"}],\" stall counts\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" active\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1234\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"send\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"567\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"control\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"89\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"Output\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" main\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"worker\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"submit_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"my_compute_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mad\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" active\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1234\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"send\",\"$L17e\",\"$L17f\",\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"a8:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Optimizations\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"a9:[\"$\",\"p\",null,{\"children\":\"Symbol resolution can be expensive when performed repeatedly for thousands of samples. The stack printer employs several optimization strategies to minimize this overhead. Stack string caching uses a hash table to map complete stacks to their folded string representations, ensuring that identical call stacks are only processed once regardless of how many samples they appear in. Symbol caching maintains per-PID symbol tables, so function addresses are resolved just once per process rather than for every sample. Additionally, batch symbol lookups group address resolution operations together, amortizing the cost of parsing debug information across multiple addresses.\"}]\n"])</script><script>self.__next_f.push([1,"aa:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"execution-flow\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#execution-flow\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Execution Flow\"]}]\n"])</script><script>self.__next_f.push([1,"ab:[\"$\",\"p\",null,{\"children\":\"Now that we understand the individual components, let's see how they work together during a typical profiling session. The execution flow shows how iaprof initializes, collects data, and produces output.\"}]\n"])</script><script>self.__next_f.push([1,"ac:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"startup-sequence\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#startup-sequence\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Startup Sequence\"]}]\n"])</script><script>self.__next_f.push([1,"ad:[\"$\",\"p\",null,{\"children\":[\"When you run \",[\"$\",\"code\",null,{\"children\":\"iaprof record\"}],\", a carefully orchestrated initialization sequence sets up all the collectors and prepares the system for profiling. Each step must complete successfully before moving to the next, ensuring that all components are ready to capture data.\"]}]\n"])</script><script>self.__next_f.push([1,"ae:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"main\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"argc\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" argv\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Parse\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"command\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"record \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" flame \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" flamescope\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"record\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"argc\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" argv\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"check_permissions\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Verify\"}],\" root or \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CAP_PERFMON\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"drm_open_device\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Open\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"dev\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"dri\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"card0\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"drm_get_driver_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Detect\"}],\" i915 vs \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Xe\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Initialize\"}],\" collectors\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   a\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"init_bpf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_object__open_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"$L180\",\"$L181\",\"\\n\"]}],\"$L182\",\"$L183\",\"$L184\",\"$L185\",\"$L186\",\"$L187\",\"$L188\",\"$L189\",\"$L18a\",\"$L18b\",\"$L18c\",\"$L18d\",\"$L18e\",\"$L18f\",\"$L190\",\"$L191\",\"$L192\",\"$L193\",\"$L194\"]}]}]\n"])</script><script>self.__next_f.push([1,"af:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"data-collection-multi-threaded\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#data-collection-multi-threaded\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Data Collection (Multi-threaded)\"]}]\n"])</script><script>self.__next_f.push([1,"b0:[\"$\",\"p\",null,{\"children\":\"Once initialization completes, iaprof runs several threads concurrently, each collecting different types of data. These threads operate independently but coordinate through the shared GPU kernel store. This multi-threaded design allows iaprof to handle high event rates without dropping data.\"}]\nb1:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"BPF Thread\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"b2:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"should_stop\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"epoll_wait\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"rb_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Block until events\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ring_buffer__poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" timeout\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ↓ callback \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" each event\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_execbuf_event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_or_create_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"gpu_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"pid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" execbuf\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"pid\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"ustack_id \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"store_stack\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"execbuf\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"ustack\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"release_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_ksp_event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ksp\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"gpu_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SHADER_TYPE_SHADER\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"release_shader\"}],\"$L195\",\"shader\",\"$L196\",\"\\n\"]}],\"$L197\"]}]}]\n"])</script><script>self.__next_f.push([1,"b3:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"EU Stall Thread\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"b4:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"should_stop\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"debug_read_eustall_sample\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Block until sample\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_eustall_sample\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ addr \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"ip\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_containing_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"shader\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        │   ├─→ offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" addr \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"gpu_addr\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        │   ├─→ profile \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"stall_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        │   ├─→ profile\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"active \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"active\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        │   └─→ \",[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"other stall types\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"else\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"            └─→ add to deferred_eustall_waitlist\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"b5:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Debug Thread\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"b6:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"should_stop\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"debug_wait_event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Block until event\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"switch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"case\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SHADER_UPLOAD\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"addr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"binary \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"malloc\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"memcpy\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"binary\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"data\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"size\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"release_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"signal_deferred_attrib_thread\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Wake deferred thread\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"break\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"case\"}],\" \",\"$L198\",\"$L199\",\"\\n\"]}],\"$L19a\",\"$L19b\",\"$L19c\",\"$L19d\"]}]}]\n"])</script><script>self.__next_f.push([1,"b7:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Deferred Attribution Thread\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"b8:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"should_stop\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pthread_cond_wait\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"deferred_cond\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Wait for signal\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" each deferred_sample \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"waitlist\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        shader \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"acquire_containing_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"deferred_sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"addr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"shader\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"associate_sample\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"deferred_sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            deferred_sample\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"satisfied\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"release_shader\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    remove satisfied samples \",[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}],\" waitlist\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"b9:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"shutdown-and-output\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#shutdown-and-output\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Shutdown and Output\"]}]\n"])</script><script>self.__next_f.push([1,"ba:[\"$\",\"p\",null,{\"children\":\"When profiling ends (either because a profiled command exits or the user presses Ctrl-C), iaprof performs an orderly shutdown. This involves stopping all collector threads, processing any remaining deferred samples, walking through the entire shader store to generate output, and cleaning up resources.\"}]\n"])</script><script>self.__next_f.push([1,"bb:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SIGINT\"}],\" received\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"collect_threads_should_stop \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STOP_REQUESTED\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Join\"}],\" all collector threads\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Process\"}],\" remaining deferred \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"samples\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"final retry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"FOR_SHADER\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" shaders tree\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pthread_rwlock_rdlock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"shaders_lock\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"each\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" stall_profile\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"in\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"stall_counts\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        cpu_stack_str \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"resolve_stack\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"ustack_id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        kernel_name \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_kernel_name\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        inst_str \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"disassemble\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"shader\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"binary\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        stalls_str \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"format_stalls\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"stall_profile\",\"$L19e\",\"\\n\"]}],\"$L19f\",\"$L1a0\",\"$L1a1\",\"$L1a2\",\"$L1a3\",\"$L1a4\",\"$L1a5\",\"$L1a6\",\"$L1a7\",\"$L1a8\"]}]}]\n"])</script><script>self.__next_f.push([1,"bc:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"key-design-decisions\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#key-design-decisions\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Key Design Decisions\"]}]\n"])</script><script>self.__next_f.push([1,"bd:[\"$\",\"p\",null,{\"children\":\"Throughout iaprof's development, the team made several critical architectural choices that fundamentally shaped how the tool works. Understanding these decisions provides insight into the trade-offs involved in building a production-quality GPU profiler.\"}]\n"])</script><script>self.__next_f.push([1,"be:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"1-why-ebpf\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#1-why-ebpf\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"1. Why eBPF?\"]}]\n"])</script><script>self.__next_f.push([1,"bf:[\"$\",\"p\",null,{\"children\":\"The decision to use eBPF for kernel-level tracing was fundamental to iaprof's design. Traditional approaches would require either a custom kernel module (difficult to maintain across kernel versions) or heavy instrumentation of the application (defeats the goal of transparent profiling). eBPF provides a middle ground that's both powerful and safe.\"}]\n"])</script><script>self.__next_f.push([1,"c0:[\"$\",\"p\",null,{\"children\":\"eBPF brings significant advantages: no kernel module is required, eliminating complex build and distribution issues; programs are verified by the kernel before loading, ensuring safety and preventing crashes; JIT compilation provides high performance approaching native code; and the comprehensive tracing capabilities allow hooking virtually any kernel function. However, there are trade-offs. The eBPF verifier imposes complexity constraints including instruction count limits and requirements for bounded loops, making sophisticated parsing logic challenging to implement. The system requires BTF (BPF Type Format) type information to be available in the kernel, and needs a relatively recent kernel version (5.8 or later) for the CO-RE (Compile Once, Run Everywhere) features that iaprof relies on.\"}]\n"])</script><script>self.__next_f.push([1,"c1:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"2-why-in-kernel-batch-buffer-parsing\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#2-why-in-kernel-batch-buffer-parsing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"2. Why In-Kernel Batch Buffer Parsing?\"]}]\n"])</script><script>self.__next_f.push([1,"c2:[\"$\",\"p\",null,{\"children\":\"One of the most complex parts of iaprof is the batch buffer parser that runs inside the kernel via eBPF. An alternative would be to copy batch buffers to userspace and parse them there, which would be simpler to implement and debug. However, the team chose in-kernel parsing for important practical reasons.\"}]\nc3:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Alternative\"}],\": Parse in userspace after capturing buffer\"]}]\nc4:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chosen\"}],\": Parse in kernel with eBPF\"]}]\nc5:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rationale\"}],\":\"]}]\nc6:[\"$\",\"p\",null,{\"children\":\"Copying batch buffers to userspace would be expensive since these buffers can be megabytes in size, adding significant overhead to every GPU submission. More critically, the parsing needs to happen before the buffer is reused or unmapped by the driver, which could happen immediately after submission. The deferred parsing mechanism handles the case where buffers aren't yet complete when first intercepted, retrying later when the data is ready.\"}]\nc7:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Trade-off\"}],\": Higher kernel overhead, but more reliable\"]}]\n"])</script><script>self.__next_f.push([1,"c8:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"3-why-deferred-attribution\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#3-why-deferred-attribution\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"3. Why Deferred Attribution?\"]}]\n"])</script><script>self.__next_f.push([1,"c9:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Problem\"}],\": EU stall samples can arrive before shader metadata\"]}]\nca:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Solution\"}],\": Waitlist with retry mechanism\"]}]\ncb:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Triggered by\"}],\":\"]}]\ncc:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"New shader arrival (debug collector signals)\"}],[\"$\",\"li\",null,{\"children\":\"Periodic retry (every N seconds)\"}],[\"$\",\"li\",null,{\"children\":\"Final cleanup (at shutdown)\"}]]}]\n"])</script><script>self.__next_f.push([1,"cd:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"4-why-two-level-locking\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#4-why-two-level-locking\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"4. Why Two-Level Locking?\"]}]\n"])</script><script>self.__next_f.push([1,"ce:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Alternative\"}],\": Global lock for entire shader tree\"]}]\ncf:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chosen\"}],\": RW-lock on tree + per-shader mutex\"]}]\nd0:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Benefits\"}],\":\"]}]\nd1:[\"$\",\"p\",null,{\"children\":\"The two-level locking approach enables multiple readers to traverse the shader tree concurrently without blocking each other, which is crucial for lookup-heavy workloads. Stall attribution can proceed on one shader while other collectors work on different shaders, preventing bottlenecks. This fine-grained locking strategy significantly reduces contention compared to a global lock, allowing the profiler to scale efficiently with the number of shaders and collection threads.\"}]\n"])</script><script>self.__next_f.push([1,"d2:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"5-why-folded-stack-format\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#5-why-folded-stack-format\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"5. Why Folded Stack Format?\"]}]\n"])</script><script>self.__next_f.push([1,"d3:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Alternative\"}],\": Custom binary format, JSON, protobuf\"]}]\nd4:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Chosen\"}],\": Text-based folded stacks\"]}]\nd5:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rationale\"}],\":\"]}]\nd6:[\"$\",\"p\",null,{\"children\":\"The text-based folded stack format provides multiple advantages over binary alternatives. It's compatible with Brendan Gregg's existing FlameGraph ecosystem, allowing iaprof to leverage mature, well-tested visualization tools. The human-readable format makes debugging and validation straightforward - you can simply look at the output to verify correctness. Standard Unix tools like grep, sed, and awk can easily filter and transform the data for custom analyses. Despite being text-based, the format is remarkably compact due to its deduplication strategy where identical stack prefixes are represented once with semicolon-separated paths.\"}]\n"])</script><script>self.__next_f.push([1,"d7:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"performance-characteristics\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#performance-characteristics\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Performance Characteristics\"]}]\n"])</script><script>self.__next_f.push([1,"d8:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"overhead\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#overhead\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Overhead\"]}]\n"])</script><script>self.__next_f.push([1,"d9:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"i915 Driver\"}],\":\"]}]\nda:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"BPF Collection\"}],\": 10-20% (batch buffer parsing expensive)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"EU Stall\"}],\": 2-5% (hardware sampling + attribution)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Debug\"}],\": 1-3% (event-driven)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Total\"}],\": 15-30% (workload-dependent)\"]}]]}]\ndb:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Xe Driver\"}],\":\"]}]\ndc:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"BPF Collection\"}],\": 3-5% (simpler batch buffer handling)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"EU Stall\"}],\": 2-5%\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Debug\"}],\": 1-3%\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Total\"}],\": 5-10% (generally lower)\"]}]]}]\n"])</script><script>self.__next_f.push([1,"dd:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"scalability\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#scalability\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Scalability\"]}]\n"])</script><script>self.__next_f.push([1,"de:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Number of Shaders\"}],\": O(log n) lookup, O(n) iteration\"]}]\ndf:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Number of EU Stall Samples\"}],\": O(1) attribution (hash table)\"]}]\ne0:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stack Depth\"}],\": Linear in depth (but capped at 512)\"]}]\ne1:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Multi-GPU\"}],\": Currently limited to first GPU found\"]}]\n"])</script><script>self.__next_f.push([1,"e2:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"memory-usage\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#memory-usage\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Memory Usage\"]}]\n"])</script><script>self.__next_f.push([1,"e3:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Typical\"}],\":\"]}]\ne4:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Shader store: 100-500 MB (depends on number/size of shaders)\"}],[\"$\",\"li\",null,{\"children\":\"eBPF ringbuffer: 512 MB (fixed)\"}],[\"$\",\"li\",null,{\"children\":\"Symbol caches: 50-200 MB (per-PID symbol tables)\"}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Total\"}],\": 1-2 GB\"]}]]}]\n"])</script><script>self.__next_f.push([1,"e5:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"platform-support\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#platform-support\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Platform Support\"]}]\n"])</script><script>self.__next_f.push([1,"e6:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"supported-hardware\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#supported-hardware\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Supported Hardware\"]}]\n"])</script><script>self.__next_f.push([1,"e7:[\"$\",\"div\",null,{\"className\":\"w-full overflow-x-auto\",\"children\":[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Platform\"}],[\"$\",\"th\",null,{\"children\":\"Architecture\"}],[\"$\",\"th\",null,{\"children\":\"Driver\"}],[\"$\",\"th\",null,{\"children\":\"Status\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Ponte Vecchio (PVC)\"}],[\"$\",\"td\",null,{\"children\":\"Xe HPC\"}],[\"$\",\"td\",null,{\"children\":\"i915 (patched)\"}],[\"$\",\"td\",null,{\"children\":\"Fully supported\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Battlemage (BMG)\"}],[\"$\",\"td\",null,{\"children\":\"Xe2\"}],[\"$\",\"td\",null,{\"children\":\"Xe\"}],[\"$\",\"td\",null,{\"children\":\"Fully supported\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Lunar Lake\"}],[\"$\",\"td\",null,{\"children\":\"Xe2\"}],[\"$\",\"td\",null,{\"children\":\"Xe\"}],[\"$\",\"td\",null,{\"children\":\"Supported (iGPU)\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Meteor Lake\"}],[\"$\",\"td\",null,{\"children\":\"Xe\"}],[\"$\",\"td\",null,{\"children\":\"Xe\"}],[\"$\",\"td\",null,{\"children\":\"Partial support\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Older Gen9-Gen12\"}],[\"$\",\"td\",null,{\"children\":\"Various\"}],[\"$\",\"td\",null,{\"children\":\"i915\"}],[\"$\",\"td\",null,{\"children\":\"Limited support\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e8:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"kernel-requirements\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#kernel-requirements\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Kernel Requirements\"]}]\n"])</script><script>self.__next_f.push([1,"e9:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Linux 5.8+\"}],\": eBPF CO-RE support\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"BTF\"}],\": \",[\"$\",\"code\",null,{\"children\":\"/sys/kernel/btf/vmlinux\"}],\" must exist\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"i915 debug\"}],\": Requires Intel backport kernel with \",[\"$\",\"code\",null,{\"children\":\"PRELIM_DRM_I915_DEBUG\"}],\" patches\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Xe debug\"}],\": Mainline support in Linux 6.2+, full support in 6.6+\"]}]]}]\n"])</script><script>self.__next_f.push([1,"ea:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"future-enhancements\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#future-enhancements\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Future Enhancements\"]}]\n"])</script><script>self.__next_f.push([1,"eb:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"planned-features\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#planned-features\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Planned Features\"]}]\n"])</script><script>self.__next_f.push([1,"ec:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Multi-GPU Profiling\"}],\": Profile multiple GPUs simultaneously\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"JSON Output\"}],\": Structured output for analysis tools\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Differential Profiling\"}],\": Compare two profile runs\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Continuous Profiling\"}],\": Lower overhead, always-on mode\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"TUI\"}],\": Terminal UI for live profiling\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Remote Profiling\"}],\": Profile remote systems\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Container Support\"}],\": Profile containerized GPU workloads\"]}]]}]\n"])</script><script>self.__next_f.push([1,"ed:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"research-directions\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#research-directions\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Research Directions\"]}]\n"])</script><script>self.__next_f.push([1,"ee:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"ML-Based Bottleneck Detection\"}],\": Automatically identify performance issues\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Predictive Profiling\"}],\": Suggest optimizations based on patterns\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Cross-Platform Support\"}],\": NVIDIA, AMD GPU support\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Distributed Profiling\"}],\": Multi-node GPU cluster profiling\"]}]]}]\n"])</script><script>self.__next_f.push([1,"ef:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"references\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#references\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"References\"]}]\n"])</script><script>self.__next_f.push([1,"f0:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"external-resources\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#external-resources\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"External Resources\"]}]\n"])</script><script>self.__next_f.push([1,"f1:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.brendangregg.com/flamegraphs.html\",\"children\":\"FlameGraph\"}],\" - Original flame graph concept\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.brendangregg.com/blog/2024-10-29/ai-flame-graphs.html\",\"children\":\"AI Flame Graphs\"}],\" - iaprof announcement blog\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://ebpf.io/\",\"children\":\"eBPF Documentation\"}],\" - eBPF programming guide\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.intel.com/content/www/us/en/developer/articles/technical/overview-of-the-compute-architecture-of-intel-processor-graphics-gen11.html\",\"children\":\"Intel GPU Architecture\"}],\" - Gen11 architecture (similar to PVC/Xe)\"]}]]}]\n"])</script><script>self.__next_f.push([1,"f2:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"internal-documentation\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#internal-documentation\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Internal Documentation\"]}]\n"])</script><script>self.__next_f.push([1,"f3:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/README.md\",\"children\":[\"$\",\"code\",null,{\"children\":\"src/README.md\"}]}],\" - Source code overview\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/collectors/bpf/README.md\",\"children\":[\"$\",\"code\",null,{\"children\":\"src/collectors/bpf/README.md\"}]}],\" - BPF collector details\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"src/stores/README.md\",\"children\":[\"$\",\"code\",null,{\"children\":\"src/stores/README.md\"}]}],\" - GPU kernel store internals\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"docs/README.pvc.md\",\"children\":[\"$\",\"code\",null,{\"children\":\"docs/README.pvc.md\"}]}],\" - PVC-specific setup (if exists)\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"docs/README.bmg.md\",\"children\":[\"$\",\"code\",null,{\"children\":\"docs/README.bmg.md\"}]}],\" - Battlemage-specific setup (if exists)\"]}]]}]\n"])</script><script>self.__next_f.push([1,"f4:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"flame-graph-generation-pipeline\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#flame-graph-generation-pipeline\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Flame Graph Generation Pipeline\"]}]\n"])</script><script>self.__next_f.push([1,"f5:[\"$\",\"p\",null,{\"children\":\"The transformation from raw profiling data to interactive flame graphs involves multiple stages, each adding value and enabling different analyses. Understanding this pipeline helps explain why iaprof uses its particular data formats and how the tool chains together.\"}]\n"])</script><script>self.__next_f.push([1,"f6:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"stage-1-data-collection-record-command\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#stage-1-data-collection-record-command\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Stage 1: Data Collection (record command)\"]}]\n"])</script><script>self.__next_f.push([1,"f7:[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"iaprof record\"}],\" command captures raw profiling data and outputs it in a structured text format. This intermediate format serves as a language between iaprof's internal representation and the flame graph visualization tools.\"]}]\nf8:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Input\"}],\": GPU execution + hardware sampling \",[\"$\",\"strong\",null,{\"children\":\"Output\"}],\": Intermediate profile format (structured text) \",[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/commands/record.c\"}],\", collectors\"]}]\n"])</script><script>self.__next_f.push([1,"f9:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"collected-data-per-sample\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#collected-data-per-sample\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Collected Data Per Sample\"]}]\n"])</script><script>self.__next_f.push([1,"fa:[\"$\",\"p\",null,{\"children\":\"For each EU stall sample, the record command collects:\"}]\nfb:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Process Context\"}],\":\"]}]\nfc:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"PID, TID, CPU, timestamp\"}],[\"$\",\"li\",null,{\"children\":\"Process name (16 chars)\"}]]}]\nfd:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"CPU Execution Context\"}],\":\"]}]\nfe:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"User-space stack (up to 512 frames)\"}],[\"$\",\"li\",null,{\"children\":\"Kernel stack (up to 512 frames)\"}]]}]\nff:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"GPU Execution Context\"}],\":\"]}]\n100:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"GPU instruction pointer (IP)\"}],[\"$\",\"li\",null,{\"children\":\"Shader GPU address\"}],[\"$\",\"li\",null,{\"children\":\"Shader binary (from debug collector)\"}]]}]\n101:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Performance Metrics\"}],\":\"]}]\n102:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"EU stall type breakdown (active, control, send, sync, etc.)\"}],[\"$\",\"li\",null,{\"children\":\"Sample counts per stall type\"}]]}]\n"])</script><script>self.__next_f.push([1,"103:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"output-format\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#output-format\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Output Format\"]}]\n"])</script><script>self.__next_f.push([1,"104:[\"$\",\"p\",null,{\"children\":\"The record command outputs a custom structured format:\"}]\n"])</script><script>self.__next_f.push([1,"105:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"string_value\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PROC_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"proc_name_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"pid\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"USTACK\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"ustack_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"frame1\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"frame2\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"KSTACK\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"kstack_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"frame1\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"frame2\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator spread\",\"children\":\"...\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU_FILE\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"gpu_file_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"filename\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU_SYMBOL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"gpu_symbol_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"symbol_name\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"INSN_TEXT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"insn_text_id\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"instruction_text\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EUSTALL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"proc_name_id\",\"$L1a9\",\"$L1aa\",\"$L1ab\",\"pid\",\"$L1ac\",\"$L1ad\",\"$L1ae\",\"ustack_id\",\"$L1af\",\"$L1b0\",\"$L1b1\",\"kstack_id\",\"$L1b2\",\"$L1b3\",\"$L1b4\",\"gpu_file_id\",\"$L1b5\",\"$L1b6\",\"$L1b7\",\"gpu_symbol_id\",\"$L1b8\",\"$L1b9\",\"$L1ba\",\"insn_text_id\",\"$L1bb\",\"$L1bc\",\"$L1bd\",\"stall_type_id\",\"$L1be\",\"$L1bf\",\"$L1c0\",\"offset\",\"$L1c1\",\"$L1c2\",\"$L1c3\",\"count\",\"$L1c4\",\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"106:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Key Features\"}],\":\"]}]\n107:[\"$\",\"p\",null,{\"children\":\"The format incorporates several optimizations to reduce file size and improve processing efficiency. String interning ensures that repeated strings (like library names or function names) are stored only once, with subsequent references using compact numeric IDs. Stack deduplication means identical call stacks are assigned the same ID and only serialized once, dramatically reducing output size for workloads with repetitive execution patterns. The structured event system uses different event types (STRING for string definitions, EUSTALL for stall samples, etc.) to clearly delineate different kinds of profiling data.\"}]\n108:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Example\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"109:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"python3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"libpython3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"so\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.0\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"PyEval_EvalFrameDefault\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"libze_loader\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"so\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STRING\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"zeCommandListAppendLaunchKernel\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PROC_NAME\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12345\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"USTACK\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x7f8000001234\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x7f8000005678\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x7f800000abcd\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"KSTACK\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"200\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0xffffffffc0123456\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0xffffffffc0234567\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU_FILE\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"my_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"cpp\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$L1c5\",\"$L1c6\",\"$L1c7\",\"$L1c8\",\"my_compute_kernel\\n\"]}],\"$L1c9\",\"$L1ca\"]}]}]\n"])</script><script>self.__next_f.push([1,"10a:[\"$\",\"p\",null,{\"children\":\"This represents:\"}]\n10b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Process: python3.11 (PID 12345)\"}],[\"$\",\"li\",null,{\"children\":\"User stack: 3 frames (resolved later)\"}],[\"$\",\"li\",null,{\"children\":\"Kernel stack: 2 frames (resolved later)\"}],[\"$\",\"li\",null,{\"children\":\"GPU kernel: my_compute_kernel in my_kernel.cpp\"}],[\"$\",\"li\",null,{\"children\":[\"Instruction: \",[\"$\",\"code\",null,{\"children\":\"mad(8) ...\"}],\" at offset 0x40\"]}],[\"$\",\"li\",null,{\"children\":\"Stall count: 1234 samples\"}]]}]\n"])</script><script>self.__next_f.push([1,"10c:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"stage-2-intermediate-processing-flame-command\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#stage-2-intermediate-processing-flame-command\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Stage 2: Intermediate Processing (flame command)\"]}]\n"])</script><script>self.__next_f.push([1,"10d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Input\"}],\": Record output (structured text) \",[\"$\",\"strong\",null,{\"children\":\"Output\"}],\": Folded stacks (semicolon-separated) \",[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"src/commands/flame.c\"}]]}]\n"])</script><script>self.__next_f.push([1,"10e:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"processing-steps\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#processing-steps\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Processing Steps\"]}]\n"])</script><script>self.__next_f.push([1,"10f:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Parse Structured Input\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"110:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"getline\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"line\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"size\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"stdin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    event \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"get_profile_event_func\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"switch\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"case\"}],\" PROFILE_EVENT_STRING\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"store_string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" value\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"break\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"case\"}],\" PROFILE_EVENT_EUSTALL\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"parse_eustall\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"aggregate_sample\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"break\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"111:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Aggregate Samples\"}],\":\"]}]\n112:[\"$\",\"p\",null,{\"children\":\"The flame command uses a hash table to deduplicate identical stack traces, combining their sample counts. The hash key consists of the complete stack fingerprint: process name, PID, user stack ID, kernel stack ID, GPU file, GPU symbol, instruction text, stall type, and instruction offset. The value is simply the accumulated count of how many times this exact stack was observed. This aggregation is crucial for reducing the data volume - a workload might generate millions of samples, but if they come from a few hot paths, they'll collapse down to just a few unique stacks with large counts.\"}]\n"])</script><script>self.__next_f.push([1,"113:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"hash_table\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"eustall_result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" flame_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"lookup \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"hash_table_get_val\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"flame_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"lookup\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"lookup \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+=\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"samp_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"else\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"hash_table_insert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"flame_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"samp_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"114:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Resolve String IDs\"}],\":\"]}]\n115:[\"$\",\"p\",null,{\"children\":\"Before outputting the final folded stacks, all numeric string IDs must be converted back to their actual string values. The flame command maintains a string table built from the STRING events encountered earlier in the input stream, allowing efficient lookup of any string by its ID.\"}]\n116:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Format Folded Stacks\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"117:[\"$\",\"$L135\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"flame_fmt \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%s;%u;%s%s-;%s_[G];%s_[G];%s_[g];%s_[g];0x%lx_[g]\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"flame_fmt\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    proc_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Process name\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"              \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Process ID\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    ustack\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"           \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// User stack (semicolon-separated)\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    kstack\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"           \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Kernel stack (semicolon-separated)\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    gpu_file\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"         \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// GPU source file\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    gpu_symbol\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// GPU kernel name\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    insn_text\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// GPU instruction\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    stall_type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Stall type\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"          \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Instruction offset\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\";%lu\\\\n\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Sample count\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"118:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"folded-stack-format\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#folded-stack-format\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Folded Stack Format\"]}]\n"])</script><script>self.__next_f.push([1,"119:[\"$\",\"p\",null,{\"children\":[\"Format: \",[\"$\",\"code\",null,{\"children\":\"frame1;frame2;...;frameN count\"}]]}]\n11a:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Annotations\"}],\" (for coloring):\"]}]\n11b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"_[G]\"}],\": GPU frame (uppercase G) - Major GPU components\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"_[g]\"}],\": GPU instruction frame (lowercase g) - Individual instructions\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"-\"}],\": Stack separator (between user and kernel)\"]}]]}]\n11c:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Example Output\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"11d:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"python3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12345\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"PyEval_EvalFrameDefault\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"zeCommandListAppendLaunchKernel\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"i915_gem_do_execbuffer_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"G\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"my_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"cpp_\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"G\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"my_compute_kernel_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"G\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mad\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"active_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"0x40_\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1234\"}],\"\\n\"]}]}]}]\n"])</script><script>self.__next_f.push([1,"11e:[\"$\",\"p\",null,{\"children\":\"Breaking down this stack (bottom to top):\"}]\n"])</script><script>self.__next_f.push([1,"11f:[\"$\",\"$L135\",null,{\"className\":\"language-js\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" python3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Process\"}],\" name\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12345\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"PID\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"PyEval_EvalFrameDefault\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Python\"}],\" interpreter frame\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4.\"}],\" zeCommandListAppendLaunchKernel \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Level\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Zero\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"API\"}],\" call\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"dash\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"User\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"kernel separator\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6.\"}],\" i915_gem_do_execbuffer \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Kernel\"}],\" driver \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"function\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7.\"}],\" my_kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"cpp\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" source file\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8.\"}],\" my_compute_kernel \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" kernel \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"function\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"9.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"mad\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"instruction\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"multiply\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"add\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"wide \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SIMD\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10.\"}],\" active \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stall\"}],\" type\\n\"]}],\"$L1cb\",\"$L1cc\"]}]}]\n"])</script><script>self.__next_f.push([1,"120:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"stage-3-flame-graph-rendering-flamegraphpl\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#stage-3-flame-graph-rendering-flamegraphpl\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Stage 3: Flame Graph Rendering (flamegraph.pl)\"]}]\n"])</script><script>self.__next_f.push([1,"121:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Input\"}],\": Folded stacks \",[\"$\",\"strong\",null,{\"children\":\"Output\"}],\": Interactive SVG \",[\"$\",\"strong\",null,{\"children\":\"Location\"}],\": \",[\"$\",\"code\",null,{\"children\":\"deps/flamegraph/flamegraph.pl\"}]]}]\n122:[\"$\",\"p\",null,{\"children\":\"This is Brendan Gregg's FlameGraph toolkit, invoked as:\"}]\n"])</script><script>self.__next_f.push([1,"123:[\"$\",\"$L135\",null,{\"className\":\"language-bash\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-bash\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"flamegraph.pl \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"--colors\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"gpu \",[\"$\",\"span\",null,{\"className\":\"token variable parameter\",\"children\":\"--title\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"AI Flame Graph\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" folded_stacks.txt \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" flame.svg\\n\"]}]}]}]\n"])</script><script>self.__next_f.push([1,"124:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"rendering-process\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#rendering-process\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Rendering Process\"]}]\n"])</script><script>self.__next_f.push([1,"125:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Parse Folded Stacks\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"126:[\"$\",\"$L135\",null,{\"className\":\"language-perl\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-perl\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token filehandle symbol\",\"children\":\"\u003cSTDIN\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    chomp\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token regex\",\"children\":\"/^(.*)\\\\s+(\\\\d+)$/\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$stack\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$count\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"@frames\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" split \",[\"$\",\"span\",null,{\"className\":\"token regex\",\"children\":\"/;/\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$stack\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        accumulate\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\\\\\"}],[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"@frames\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token variable\",\"children\":\"$$count\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"127:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Build Call Tree\"}],\":\"]}]\n128:[\"$\",\"p\",null,{\"children\":\"From the folded stacks, FlameGraph.pl constructs a hierarchical tree structure where each node contains a function name, sample count, and list of children. As it processes each stack, it merges common prefixes - stacks that share the same initial call path are represented by the same nodes in the tree, with branches only where execution diverges. This tree structure is what enables the characteristic flame graph visualization where wide bases represent common entry points and narrower tops show specialized execution paths.\"}]\n129:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Calculate Widths\"}],\":\"]}]\n12a:[\"$\",\"p\",null,{\"children\":[\"The visual width of each frame in the flame graph is proportional to its sample count. The algorithm starts with the total image width (default 1200 pixels) and allocates space to each frame based on its percentage of total samples: \",[\"$\",\"code\",null,{\"children\":\"frame_width = (frame_count / total_samples) × image_width\"}],\". Frames narrower than a minimum threshold (default 0.1 pixels) are omitted entirely to avoid visual clutter and improve rendering performance.\"]}]\n12b:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Assign Colors\"}],\":\"]}]\n"])</script><script>self.__next_f.push([1,"12c:[\"$\",\"p\",null,{\"children\":[\"Color assignment uses the \",[\"$\",\"code\",null,{\"children\":\"--colors=gpu\"}],\" custom palette optimized for CPU/GPU profiling. The coloring is annotation-based: frames marked with \",[\"$\",\"code\",null,{\"children\":\"_[G]\"}],\" (uppercase) representing major GPU components render in bright blue or cyan, while \",[\"$\",\"code\",null,{\"children\":\"_[g]\"}],\" (lowercase) frames for individual GPU instructions use light blue, stack separator frames marked with \",[\"$\",\"code\",null,{\"children\":\"-\"}],\" appear in gray, and all other frames (CPU code) use warm colors in the yellow/orange/red spectrum. Within each color family, the specific hue varies based on a hash of the function name, ensuring the same function always gets the same color across different profile runs for easy visual comparison.\"]}]\n"])</script><script>self.__next_f.push([1,"12d:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Generate SVG\"}],\":\"]}]\n12e:[\"$\",\"p\",null,{\"children\":\"The final step produces the interactive SVG visualization. Each frame becomes an SVG rectangle element with calculated x, y, width, and height attributes, filled with the assigned color. A text label containing the function name is overlaid on each rectangle. Embedded JavaScript provides rich interactivity: mouse-over displays a tooltip showing the full function name and percentage of total samples, clicking a frame zooms the view to show just that frame's subtree, Ctrl+F enables searching and highlighting frames by name, and a reset button returns to the full view.\"}]\n"])</script><script>self.__next_f.push([1,"12f:[\"$\",\"h4\",null,{\"className\":\"content-header\",\"id\":\"svg-structure\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#svg-structure\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"SVG Structure\"]}]\n"])</script><script>self.__next_f.push([1,"130:[\"$\",\"$L135\",null,{\"className\":\"language-xml\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"svg\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"xmlns\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"http://www.w3.org/2000/svg\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"width\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"1200\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"height\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"...\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  {/* Title */}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"text\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"24\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"AI Flame Graph\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"text\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  {/* Flame graph frames */}\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"g\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"func_g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"python3.11 (1234 samples, 45%)\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"rect\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"0\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"100\",\"$L1cd\"]}],\" \",\"$L1ce\",\"$L1cf\",\" \",\"$L1d0\",\"$L1d1\",\" \",\"$L1d2\",\"$L1d3\",\" \",\"$L1d4\"]}],\"\\n\"]}],\"$L1d5\",\"$L1d6\",\"$L1d7\",\"$L1d8\",\"$L1d9\",\"$L1da\",\"$L1db\",\"$L1dc\",\"$L1dd\",\"$L1de\",\"$L1df\",\"$L1e0\",\"$L1e1\",\"$L1e2\",\"$L1e3\",\"$L1e4\",\"$L1e5\",\"$L1e6\",\"$L1e7\",\"$L1e8\",\"$L1e9\",\"$L1ea\",\"$L1eb\",\"$L1ec\",\"$L1ed\",\"$L1ee\",\"$L1ef\",\"$L1f0\",\"$L1f1\",\"$L1f2\",\"$L1f3\",\"$L1f4\"]}]}]\n"])</script><script>self.__next_f.push([1,"131:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl\",\"children\":[[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2Fiaprof-analysis\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37/yunwei37-blog/blob/main/data/blog/iaprof-analysis.mdx\",\"children\":\"View on GitHub\"}]]}]\n132:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl\",\"id\":\"comment\",\"children\":[\"$\",\"$L1f5\",null,{\"slug\":\"iaprof-analysis\"}]}]\n"])</script><script>self.__next_f.push([1,"133:[\"$\",\"footer\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"py-4 xl:py-8\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4\",\"children\":\"Tags\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"$L6\",\"ebpf\",{\"href\":\"/tags/ebpf\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"ebpf\"}],[\"$\",\"$L6\",\"systems\",{\"href\":\"/tags/systems\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"systems\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-between py-4 xl:block xl:space-y-6 xl:py-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Previous Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/agentsight_paper\",\"children\":\"AgentSight: Keeping Your AI Agents Under Control with eBPF-Powered System Observability\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Next Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/nvidia-open-driver-analysis\",\"children\":\"NVIDIA Open GPU Kernel Modules Comprehensive Source Code Analysis\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105\",\"href\":\"/blog\",\"aria-label\":\"Back to the blog\",\"children\":\"← Back to the blog\"}]}]]}]\n"])</script><script>self.__next_f.push([1,"136:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"DRM\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Subsystem\"}],\"   │  │  i915\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Xe\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Driver\"}],\" │  │  eBPF \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Subsystem\"}],\"    │ │\\n\"]}]\n137:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │                  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"│◄─┤\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Driver\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"   │  │                    │ │\\n\"]}]\n138:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Device\"}],\" mgmt   │  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Memory\"}],\" mgmt  │◄─┤  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" iaprof \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BPF\"}],\"      │ │\\n\"]}]\n139:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"IOCTL\"}],\" routing │  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Execution\"}],\"    │  │    programs       "])</script><script>self.__next_f.push([1," │ │\\n\"]}]\n13a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │                  │  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Batch\"}],\" buffers│  │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Ringbuffer\"}],\"      │ │\\n\"]}]\n13b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  └──────────────────┘  └────────┬────────┘  └─────────┬──────────┘ │\\n\"}]\n13c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                                 │                      │             │\\n\"}]\n13d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│                                 │ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Commands\"}],\"             │ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Events\"}],\"      │\\n\"]}]\n13e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                                 ▼                      │             │\\n\"}]\n13f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  ┌────────────────────────────────────────────────────┼──────────┐ │\\n\"}]\n140:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │                 \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Intel\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Hardware\"}],\"                  │          │ │\\n\"]}]\n141:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  │  ┌──────────┐  ┌───────"])</script><script>self.__next_f.push([1,"───┐  ┌─────────────────┐  │          │ │\\n\"}]\n"])</script><script>self.__next_f.push([1,"142:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  │ \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name known-class-name\",\"children\":\"Array\"}],\" │  │ \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"L1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"L3\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"RAM\"}],\"│  │ \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"OA\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Observ\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"    \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"│\"}],\"  │          │ │\\n\"]}]\n"])</script><script>self.__next_f.push([1,"143:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"│\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Compute\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"│  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"│\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Memory\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" │  │  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Architecture\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" │◄─┘          │ │\\n\"]}]\n"])</script><script>self.__next_f.push([1,"144:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  │          │  │          │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Sampling\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"HW\"}],\"  │             │ │\\n\"]}]\n145:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │  │ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Execution│\"}],\"  │ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Data\"}],\"     │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Perf\"}],\" counters│             │ │\\n\"]}]\n146:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  │  └──────────┘  └──────────┘  └─────────────────┘             │ │\\n\"}]\n147:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  └────────────────────────────────────────────────────────────────┘ │\\n\"}]\n148:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"└──────────────────────────────────────┬──────────────────────────────┘\\n\"}]\n149:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                                       │\\n\"}]\n14a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                                       │ \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.\"}],\" eBPF \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"events\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ringbuffer\",[\"$\",\"span\",null,{\"className\":\"token"])</script><script>self.__next_f.push([1," punctuation\",\"children\":\")\"}],\"\\n\"]}]\n14b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                                       │ \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EU\"}],\" stall \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"samples\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"debug \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"API\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n14c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                                       │ \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Shader\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"uploads\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"debug \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"API\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n14d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                                       ▼\\n\"}]\n14e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"┌─────────────────────────────────────────────────────────────────────┐\\n\"}]\n14f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                            iaprof                                    │\\n\"}]\n150:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │\\n\"}]\n"])</script><script>self.__next_f.push([1,"151:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │ \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BPF\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Collector│\"}],\"  │Debug \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Collect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"│\"}],\"  │EUStall \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Coll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"│\"}],\"             │\\n\"]}]\n"])</script><script>self.__next_f.push([1,"152:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  │              │  │              │  │              │             │\\n\"}]\n153:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Load\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BPF\"}],\"   │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Shader\"}],\" bin │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"HW\"}],\" samples │             │\\n\"]}]\n"])</script><script>self.__next_f.push([1,"154:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Parse\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BB\"}],\"   │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Context\"}],\"    │  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stall\"}],\" attr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"│\"}],\"             │\\n\"]}]\n"])</script><script>self.__next_f.push([1,"155:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│  │ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stacks\"}],\"     │  │   tracking   │  │   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"ibution   │             │\\n\"]}]\n156:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘             │\\n\"}]\n157:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         │                 │                 │                       │\\n\"}]\n158:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         └────────┬────────┴────────┬────────┘                       │\\n\"}]\n159:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                  ▼                 ▼                                 │\\n\"}]\n15a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         ┌────────────────────────────────┐                          │\\n\"}]\n15b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │    \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Kernel\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Store\"}]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Tree\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"     │                          │\\n\"]}]\n15c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\""])</script><script>self.__next_f.push([1,",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Shader\"}],\" metadata \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\" binaries  │                          │\\n\"]}]\n15d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CPU\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"kernel stacks           │                          │\\n\"]}]\n15e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Per\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"offset stall counts     │                          │\\n\"]}]\n15f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         └───────────────┬────────────────┘                          │\\n\"}]\n160:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                         │                                            │\\n\"}]\n161:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                         ▼                                            │\\n\"}]\n162:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         ┌────────────────────────────────┐                          │\\n\"}]\n163:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │       \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stack\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Printer\"}],\"            │                          │\\n\"]}]\n164:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],"])</script><script>self.__next_f.push([1,"\" \",[\"$\",\"span\",null,{\"className\":\"token class-name known-class-name\",\"children\":\"Symbol\"}],\" resolution           │                          │\\n\"]}]\n165:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stack\"}],\" deduplication         │                          │\\n\"]}]\n166:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"│         │  \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Folded\"}],\" stack output         │                          │\\n\"]}]\n167:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│         └───────────────┬────────────────┘                          │\\n\"}]\n168:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"│                         │                                            │\\n\"}]\n169:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"└─────────────────────────┼────────────────────────────────────────────┘\\n\"}]\n16a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          │\\n\"}]\n16b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          ▼\\n\"}]\n16c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                   \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Folded\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Stacks\"}]}],\"\\n\"]}]\n16d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"CPU_st"])</script><script>self.__next_f.push([1,"ack\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"GPU_kernel\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"GPU_instruction\"}],\" stall_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n16e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          │\\n\"}]\n16f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          ▼\\n\"}]\n170:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                   \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"FlameGraph\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token property-access\",\"children\":\"pl\"}],\"\\n\"]}]\n171:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          │\\n\"}]\n172:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"                          ▼\\n\"}]\n173:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                  \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Interactive\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SVG\"}],\"\\n\"]}]\n174:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"               \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"AI\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Flame\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Graph\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n175:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n176:[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SIP\"}]\n177:[\"$\",\"span\","])</script><script>self.__next_f.push([1,"null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n178:[\"$\",\"span\",null,{\"className\":\"token keyword module\",\"children\":\"from\"}]\n179:[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"STATE_SIP\"}]\n"])</script><script>self.__next_f.push([1,"17a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"If\"}],\" buffer \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"incomplete\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"NOOPs\"}],\" encountered\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Defers\"}],\" parsing \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"with\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"BPF\"}],\" timer\\n\"]}]\n"])</script><script>self.__next_f.push([1,"17b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Emits\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"KSPs\"}],\" and \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SIP\"}],\" to ringbuffer\\n\"]}]\n17c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"hash_table\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" offset_profile_struct\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" stall_counts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n17d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n17e:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}]\n17f:[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"567\"}]\n180:[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"main.bpf.o\\\"\"}]\n181:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n182:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        ├─→ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_object__load\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"obj\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Loads into kernel\"}],\"\\n\"]}]\n183:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"        └─→ attach tracepoints\\n\"}]\n184:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   b\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\""])</script><script>self.__next_f.push([1,":\"token function property-access method\",\"children\":\"init_oa\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n185:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Configure\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"OA\"}],\" hardware registers\\n\"]}]\n186:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   c\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"init_debug\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n187:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"debug_attach\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pid\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Attach to all processes\"}],\"\\n\"]}]\n188:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   d\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function property-access method\",\"children\":\"init_eustall\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n189:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        └─→ \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Initialize\"}],\" waitlists\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" start deferred thread\\n\"]}]\n18a:[\"$\",\"span\",null,{\"className\":\"code-line\","])</script><script>self.__next_f.push([1,"\"children\":\"     ↓\\n\"}]\n18b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Spawn\"}],\" collector threads\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\n18c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_collect_thread\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n18d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"eustall_collect_thread\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n18e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"debug_collect_thread\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n18f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"eustall_deferred_attrib_thread\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n190:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"     ↓\\n\"}]\n191:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"9.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"If\"}],\" command specified\""])</script><script>self.__next_f.push([1,",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\n192:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"     \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"fork\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"exec\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" child process\\n\"]}]\n193:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"   \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"Else\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\n194:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"     \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Wait\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"SIGINT\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Ctrl\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"C\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n195:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n196:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n197:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n198:[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CONTEXT_CREATE\"}]\n199:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}]\n19a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"childre"])</script><script>self.__next_f.push([1,"n\":\"track_context_vm_mapping\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n19b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword control-flow\",\"children\":\"break\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n19c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n19d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n19e:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n"])</script><script>self.__next_f.push([1,"19f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%s;%s;%s %s\\\\n\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" cpu_stack_str\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" kernel_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" inst_str\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" stalls_str\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1a0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"pthread_rwlock_unlock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"shaders_lock\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n1a1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}]\n1a2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"Cleanup\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\n1a3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deinit_bpf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n1a4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deinit_debug\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n1a5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"deinit_eustall\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n1a6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"free_profiles\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n1a7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    ↓\\n\"}]\n1a8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Exit\"}],\"\\n\"]}]\n1a9:[\"$\",\"span\",null,{\"className\":\"token operator"])</script><script>self.__next_f.push([1,"\",\"children\":\"\u003e\"}]\n1aa:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1ab:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1ac:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1ad:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1ae:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1af:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1b0:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1b1:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1b2:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1b3:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1b4:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1b5:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1b6:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1b7:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1b8:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1b9:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1ba:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1bb:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1bc:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1bd:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1be:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1bf:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1c0:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1c1:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1c2:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1c3:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}]\n1c4:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]\n1c5:[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"GPU_SYMBOL\"}]\n1c6:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n1c7:[\"$\",\"span\",nu"])</script><script>self.__next_f.push([1,"ll,{\"className\":\"token number\",\"children\":\"11\"}]\n1c8:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n"])</script><script>self.__next_f.push([1,"1c9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"INSN_TEXT\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"20\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mad\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" r10\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"f r2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"f r3\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"f r4\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"f\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1ca:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"EUSTALL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12345\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"200\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"20\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x40\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1234\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1cb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"11.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x40\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token maybe-class-name\",\"children\":\"Instruction\"}],\" offset\\n\"]}]\n1cc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12.\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token literal-property property\",\"children\":\"Count\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1234\"}],\" samples\\n\"]}]\n1cd:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]\n1ce:[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"width\"}]\n1cf:[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"540\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}]\n1d0:[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"height\"}]\n1d1:[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"16\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}]\n1d2:[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"fill\"}]\n1d3:[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"rgb(230,150,80)\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}]\n1d4:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"/\u003e\"}]\n"])</script><script>self.__next_f.push([1,"1d5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"text\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"5\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"110\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"python3.11\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"text\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1d6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"g\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n1d7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n"])</script><script>self.__next_f.push([1,"1d8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"g\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"func_g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1d9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"PyEval_EvalFrameDefault (1000 samples, 36%)\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1da:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"rect\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"0\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"84\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"width\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"450\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"height\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"16\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"fill\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"rgb(240,160,90)\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"/\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1db:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"text\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"5\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"94\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"PyEval_EvalFrameDefault\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"text\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1dc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"g\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n1dd:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n1de:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  {/* GPU frames (blue) */}\\n\"}]\n"])</script><script>self.__next_f.push([1,"1df:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"g\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"func_g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"my_compute_kernel (500 samples, 18%)\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"rect\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"0\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"36\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"width\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"225\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"height\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"16\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"fill\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"rgb(80,150,230)\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"/\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"text\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"5\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"46\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"my_compute_kernel\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"text\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"g\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n1e4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n1e5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  {/* GPU instruction (light blue) */}\\n\"}]\n"])</script><script>self.__next_f.push([1,"1e6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"g\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"class\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"func_g\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"mad(8) r10 (200 samples, 7%)\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"title\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"rect\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"0\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"20\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"width\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"90\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"height\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"16\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"fill\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"rgb(150,200,250)\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"/\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1e9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"text\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"x\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"5\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"y\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"30\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"mad(8) r10\",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"text\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1ea:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"g\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n1eb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n1ec:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  {/* JavaScript for interactivity */}\\n\"}]\n"])</script><script>self.__next_f.push([1,"1ed:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"script\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"token attr-name\",\"children\":\"type\"}],[\"$\",\"span\",null,{\"className\":\"token attr-value\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation attr-equals\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}],\"text/ecmascript\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\\\"\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"1ee:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token cdata\",\"children\":\"\u003c![CDATA[\\n\"}]]}]\n1ef:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token cdata\",\"children\":\"      function zoom(e) { ... }\\n\"}]}]\n1f0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token cdata\",\"children\":\"      function search() { ... }\\n\"}]}]\n1f1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$\",\"span\",null,{\"className\":\"token cdata\",\"children\":\"      function reset() { ... }\\n\"}]}]\n1f2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token cdata\",\"children\":\"    ]]\u003e\"}],\"\\n\"]}]\n1f3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"script\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n1f4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token tag\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c/\"}],\"svg\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"23:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n1f:null\n"])</script><script>self.__next_f.push([1,"21:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling | 云微的胡思乱想\"}],[\"$\",\"meta\",\"1\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"2\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://www.yunwei37.com/blog/iaprof-analysis\"}],[\"$\",\"link\",\"4\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://www.yunwei37.com/feed.xml\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://www.yunwei37.com/blog/iaprof-analysis\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"云微的胡思乱想\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:published_time\",\"content\":\"2025-10-11T16:00:00.000Z\"}],[\"$\",\"meta\",\"12\",{\"property\":\"article:modified_time\",\"content\":\"2025-10-11T16:00:00.000Z\"}],[\"$\",\"meta\",\"13\",{\"property\":\"article:author\",\"content\":\"Yusheng Zheng (云微)\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:title\",\"content\":\"Understanding iaprof: A Deep Dive into AI/GPU Flame Graph Profiling\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"26:\"$21:metadata\"\n"])</script></body></html>