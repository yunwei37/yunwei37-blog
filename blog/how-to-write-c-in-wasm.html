<!DOCTYPE html><!--MYXrWUjg0HELsl6zLYF_6--><html lang="en-us" class="__variable_dd5b2f scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/36966cca54120369-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4ac7c0f872b74ee7.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/a06d7e24bf9a7d93.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7246298b30c42979.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-91cf1b3b084c6ba2.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-dd2321b4b492b566.js" async=""></script><script src="/_next/static/chunks/main-app-01d32ba99375ba1b.js" async=""></script><script src="/_next/static/chunks/874-8edb22cc7428423c.js" async=""></script><script src="/_next/static/chunks/650-5bb235cd9bfca45d.js" async=""></script><script src="/_next/static/chunks/app/layout-66df3ac28fcfbced.js" async=""></script><script src="/_next/static/chunks/63-d245e42a784ca56d.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js" async=""></script><link rel="preload" href="https://analytics.umami.is/script.js" as="script"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/svg+xml" href="/static/favicons/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="next-size-adjust" content=""/><title>在 WebAssembly 中编写 eBPF 程序和使用 libbpf | 云微的胡思乱想</title><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://www.yunwei37.com/blog/how-to-write-c-in-wasm"/><link rel="alternate" type="application/rss+xml" href="https://www.yunwei37.com/feed.xml"/><meta property="og:title" content="在 WebAssembly 中编写 eBPF 程序和使用 libbpf"/><meta property="og:url" content="https://www.yunwei37.com/blog/how-to-write-c-in-wasm"/><meta property="og:site_name" content="云微的胡思乱想"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-02-11T16:00:00.000Z"/><meta property="article:modified_time" content="2022-02-11T16:00:00.000Z"/><meta property="article:author" content="Yusheng Zheng (云微)"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="在 WebAssembly 中编写 eBPF 程序和使用 libbpf"/><meta name="twitter:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="min-h-screen flex flex-col justify-center py-8"><div class="content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8"><header class="flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30"><a class="break-words" aria-label="yunwei37" href="/"><div class="flex items-center"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none"><defs><linearGradient id="logo_svg__a" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1"></stop></linearGradient><linearGradient id="logo_svg__b" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1"></stop></linearGradient></defs><circle cx="20" cy="20" r="18" fill="url(#logo_svg__a)" opacity="0.1"></circle><path fill="url(#logo_svg__a)" d="m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z"></path><path fill="url(#logo_svg__b)" d="m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z" opacity="0.8"></path><circle cx="32" cy="12" r="2" fill="url(#logo_svg__b)"></circle><circle cx="8" cy="12" r="1.5" fill="url(#logo_svg__a)" opacity="0.6"></circle></svg></div><div class="hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors">yunwei37</div></div></a><div class="flex items-center space-x-4"><div class="no-scrollbar hidden items-center space-x-2 sm:flex"><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/blog">Blog</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/docs">Docs</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/tags">Tags</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/about">About</a></div><div class="flex items-center space-x-2"><button aria-label="Search" class="p-2 rounded-lg transition-all duration-200"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden p-2 rounded-lg hover:glass transition-all duration-200 hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></div></div></header><main class="py-6"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"在 WebAssembly 中编写 eBPF 程序和使用 libbpf","datePublished":"2022-02-11T16:00:00.000Z","dateModified":"2022-02-11T16:00:00.000Z","image":"/static/images/twitter-card.png","url":"https://www.yunwei37.com/blog/how-to-write-c-in-wasm","author":[{"@type":"Person","name":"Yusheng Zheng (云微)"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article class="content-glass p-8"><div class="xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30"><header class="pt-6 xl:pb-6"><div class="space-y-4 text-center"><dl class="space-y-4"><div><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-600 dark:text-gray-300"><time dateTime="2022-02-11T16:00:00.000Z">Friday, February 11, 2022</time></dd></div></dl><div><h1 class="text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">在 WebAssembly 中编写 eBPF 程序和使用 libbpf</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0"><li class="flex items-center space-x-3 glass p-4 rounded-xl"><img alt="avatar" loading="lazy" width="38" height="38" decoding="async" data-nimg="1" class="h-10 w-10 rounded-full" style="color:transparent" src="/static/images/avatar.png"/><dl class="text-sm leading-5 font-medium whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Yusheng Zheng (云微)</dd><dt class="sr-only">Twitter</dt><dd><a class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors" target="_blank" rel="noopener noreferrer" href="https://twitter.com/yunwei37">@yunwei37</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30"><div class="prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200"><h1 class="content-header" id="在-webassembly-中编写-ebpf-程序和使用-libbpf"><a class="break-words" href="#在-webassembly-中编写-ebpf-程序和使用-libbpf" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>在 WebAssembly 中编写 eBPF 程序和使用 libbpf</h1><blockquote><p>Authors: Yu Tong, Zheng Yusheng</p></blockquote><p>eBPF (extended Berkeley Packet Filter) is a high-performance kernel virtual machine that runs in the kernel space and is used to collect system and network information. With the continuous development of computer technology, eBPF has become increasingly powerful and is used to build various efficient online diagnostic and tracing systems, as well as secure networks and service meshes.</p><p>WebAssembly (Wasm) was initially developed for browser security sandbox purposes. As of now, WebAssembly has evolved into a high-performance, cross-platform, and multi-language software sandbox environment for cloud-native software components. The lightweight nature of Wasm containers makes them suitable for running as the next-generation serverless platform runtime or for efficient execution in resource-constrained scenarios such as edge computing.</p><p>Now, with the help of the Wasm-bpf compilation toolchain and runtime, we can use Wasm to write eBPF programs as cross-platform modules, while using C/C++ or Rust to write Wasm programs. By using eBPF programs in WebAssembly, we not only enable Wasm applications to benefit from the high performance and access to system interfaces of eBPF, but also allow eBPF programs to leverage the sandboxing, flexibility, cross-platform nature, and dynamic loading of Wasm. Additionally, we can conveniently and quickly distribute and manage eBPF programs using Wasm OCI images. Combining these two technologies will provide a completely new development experience for the eBPF and Wasm ecosystems!</p><h2 class="content-header" id="writing-dynamically-loading-and-distributing-ebpf-programs-in-wasm-with-the-wasm-bpf-toolchain"><a class="break-words" href="#writing-dynamically-loading-and-distributing-ebpf-programs-in-wasm-with-the-wasm-bpf-toolchain" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Writing, Dynamically Loading, and Distributing eBPF Programs in Wasm with the Wasm-bpf Toolchain</h2><p>Wasm-bpf is a new open-source project: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/wasm-bpf">https://github.com/eunomia-bpf/wasm-bpf</a>. It defines an abstraction for the eBPF-related system interfaces and provides a corresponding development toolchain, library, and a general Wasm + eBPF runtime instance. It can provide a similar development experience to libbpf-bootstrap, automatically generating skeleton header files and data structure definitions for unordered communication between Wasm and eBPF. With this toolchain, you can easily build your own Wasm-eBPF runtime in any language on any platform. For more details, please refer to our previous blog post: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew">Wasm-bpf: Bridging WebAssembly and eBPF Kernel Programmability</a>.</p><p>With Wasm, we can build eBPF applications using multiple languages and manage and distribute them in a unified and lightweight manner. As an example, our sample application bootstrap.wasm is only ~90K in size, making it easy to distribute over the network and dynamically deploy, load, and run on another machine in less than 100ms, while retaining the isolation characteristics of lightweight containers. The runtime does not require kernel headers, LLVM, clang, or any resource-consuming heavy compilation work.</p><p>This article will discuss writing and compiling eBPF programs in C/C++ and converting them into Wasm modules. A specific example of writing and compiling eBPF programs in Rust and converting them into Wasm modules will be described in the next article.</p><p>We provide several sample programs in the repository, each corresponding to different scenarios such as observability, networking, and security.</p><h2 class="content-header" id="writing-ebpf-programs-in-cc-and-compiling-into-wasm"><a class="break-words" href="#writing-ebpf-programs-in-cc-and-compiling-into-wasm" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Writing eBPF Programs in C/C++ and Compiling into Wasm</h2><p>libbpf is a C/C++ user space loading and control library for eBPF and has become the de facto API standard for eBPF user space. libbpf also supports the CO-RE (Compile Once - Run Everywhere) solution, which allows precompiled BPF code to work on different kernel versions without the need to recompile for each specific kernel. We aim to maintain compatibility and minimize migration costs to Wasm (if necessary) by keeping the user space API and behavior consistent with libbpf.</p><p>libbpf-bootstrap provides templates for generating libbpf-based BPF programs, making it easy for developers to generate custom BPF programs. In general, outside the Wasm sandbox, using the libbpf-bootstrap scaffolding, you can quickly and easily build BPF applications using C/C++.</p><p>The compilation, building, and running of eBPF programs (regardless of the programming language) usually involve the following steps:</p><ul><li>Write the code for the kernel space eBPF program, generally using C/C++ or Rust.</li><li>Compile the eBPF program using the clang compiler or related toolchains (including BTF information to achieve cross-kernel version portability).</li><li>In the user space development program, write the corresponding logic for loading, controlling, mounting, and processing data.</li><li>During runtime, load the eBPF program into the kernel from the user space and execute it.</li></ul><h3 class="content-header" id="bootstrap"><a class="break-words" href="#bootstrap" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>bootstrap</h3><p><code>bootstrap</code> is a simple (but practical) example of a BPF application. It tracks the startup (specifically, the <code>exec()</code> series of system calls) and exit of processes, and sends data about the file name, PID, and parent PID, as well as the exit status and duration of the process. With <code>-d &lt;min-duration-ms&gt;</code>, you can specify the minimum duration of the processes to be recorded.</p><p><code>bootstrap</code> is created based on the similar idea of <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/iovisor/bcc/tree/master/libbpf-tools">libbpf-tools</a> in the BCC package, but it is designed to be more independent and has a simpler Makefile to simplify user&#x27;s specific needs. It demonstrates typical BPF features, including cooperation with multiple BPF program segments, maintaining state using BPF maps, sending data to userspace using BPF ring buffer, and parameterizing application behavior using global variables.</p><p>Here is an example output of running <code>bootstrap</code> by compiling it with Wasm:</p><div class="relative"><pre><code class="code-highlight language-console"><span class="code-line">$ sudo sudo ./wasm-bpf bootstrap.wasm -h
</span><span class="code-line">BPF bootstrap demo application.
</span><span class="code-line">
</span><span class="code-line">It traces process start and exits and shows associated
</span><span class="code-line">information (filename, process duration, PID and PPID, etc).
</span><span class="code-line">
</span><span class="code-line">USAGE: ./bootstrap [-d &lt;min-duration-ms&gt;] -v
</span><span class="code-line">$ sudo ./wasm-bpf bootstrap.wasm
</span><span class="code-line">TIME     EVENT COMM             PID     PPID    FILENAME/EXIT CODE
</span><span class="code-line">18:57:58 EXEC  sed              74911   74910   /usr/bin/sed
</span><span class="code-line">18:57:58 EXIT  sed              74911   74910   [0] (2ms)
</span><span class="code-line">18:57:58 EXIT  cat              74912   74910   [0] (0ms)
</span><span class="code-line">18:57:58 EXEC  cat              74913   74910   /usr/bin/cat
</span><span class="code-line">18:57:59 EXIT  cat              74913   74910   [0] (0ms)
</span><span class="code-line">18:57:59 EXEC  cat              74914   74910   /usr/bin/cat
</span><span class="code-line">18:57:59 EXIT  cat              74914   74910   [0] (0ms)
</span><span class="code-line">18:57:59 EXEC  cat              74915   74910   /usr/bin/cat
</span><span class="code-line">18:57:59 EXIT  cat              74915   74910   [0] (1ms)
</span><span class="code-line">18:57:59 EXEC  sleep            74916   74910   /usr/bin/sleep
</span></code></pre></div><p>We can provide a development experience similar to libbpf-bootstrap. Just run <code>make</code> to build the wasm binary:</p><div class="relative"><pre><code class="code-highlight language-console"><span class="code-line">git clone https://github.com/eunomia-bpf/wasm-bpf --recursive
</span><span class="code-line">cd examples/bootstrap
</span><span class="code-line">make
</span></code></pre></div><h3 class="content-header" id="writing-ebpf-programs-in-kernel-space"><a class="break-words" href="#writing-ebpf-programs-in-kernel-space" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Writing eBPF programs in kernel space</h3><p>To build a complete eBPF program, you need to first write the BPF code in kernel space. This is typically done using the C language and compiled using clang:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">char</span> LICENSE<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;license&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;Dual BSD/GPL&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> BPF_MAP_TYPE_HASH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>max_entries<span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">pid_t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> u64<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> exec_start <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;.maps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> BPF_MAP_TYPE_RINGBUF<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>max_entries<span class="token punctuation">,</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> rb <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;.maps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>&quot;<span class="token punctuation">.</span><span class="token keyword">const</span> <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> min_duration_ns <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> <span class="token operator">*</span>name_ptr<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;tp/sched/sched_process_exec&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">handle_exec</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sched_process_exec</span> <span class="token operator">*</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>task<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> fname_off<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">event</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
</span><span class="code-line">    u64 ts<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span></code></pre></div><p>Due to space constraints, the full code is not shown here. The way to write kernel code is exactly the same as other libbpf-based programs. Generally, it includes some global variables, eBPF functions declared with <code>SEC</code> for mounting points, and map objects used to store state or communicate between user space and kernel space (we are also doing other work in progress: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/iovisor/bcc/issues/4404">bcc to libbpf converter</a>, and once it is completed, you will be able to compile BCC-style eBPF kernel code in this way). After writing the eBPF program, running <code>make</code> will invoke clang and llvm-strip in the <code>Makefile</code> to build the BPF program and remove debug information:</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">clang <span class="token parameter variable">-g</span> <span class="token parameter variable">-O2</span> <span class="token parameter variable">-target</span> bpf <span class="token parameter variable">-D__TARGET_ARCH_x86</span> -I<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/third_party/vmlinux/x86/ <span class="token parameter variable">-idirafter</span> /usr/local/include <span class="token parameter variable">-idirafter</span> /usr/include <span class="token parameter variable">-c</span> bootstrap.bpf.c <span class="token parameter variable">-o</span> bootstrap.bpf.o
</span><span class="code-line">llvm-strip <span class="token parameter variable">-g</span> bootstrap.bpf.o <span class="token comment"># strip useless DWARF info</span>
</span></code></pre></div><p>Then we provide a specialized bpftool for Wasm, which generates C header files from BPF programs:</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/third_party/bpftool/src/bpftool gen skeleton <span class="token parameter variable">-j</span> bootstrap.bpf.o <span class="token operator">&gt;</span> bootstrap.skel.h
</span></code></pre></div><p>Since the C memory layout for eBPF itself is the same as the instruction set of the current machine, but Wasm has a specific memory layout (e.g., the current machine is 64-bit, and the Wasm virtual machine is 32-bit, so the C struct layout, pointer width, endianness, etc. may be different), in order to ensure that eBPF programs can communicate correctly with Wasm, we need to customize a specialized bpftool and other tools to generate a user space development framework that can work in Wasm.</p><p>The skeleton contains a skeleton for a BPF program, used to manipulate BPF objects and control the lifecycle of the BPF program, for example:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">bootstrap_bpf</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token class-name">bpf_object_skeleton</span> <span class="token operator">*</span>skeleton<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token class-name">bpf_object</span> <span class="token operator">*</span>obj<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">struct</span> <span class="token class-name">bpf_map</span> <span class="token operator">*</span>exec_start<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">struct</span> <span class="token class-name">bpf_map</span> <span class="token operator">*</span>rb<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">struct</span> <span class="token class-name">bpf_map</span> <span class="token operator">*</span>rodata<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> maps<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">struct</span> <span class="token class-name">bpf_program</span> <span class="token operator">*</span>handle_exec<span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token keyword">struct</span> <span class="token class-name">bpf_program</span> <span class="token operator">*</span>handle_exit<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> progs<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token class-name">bootstrap_bpf__rodata</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> min_duration_ns<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token operator">*</span>rodata<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">struct</span> <span class="token class-name">bootstrap_bpf__bss</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">uint64_t</span> <span class="token comment">/* pointer */</span> name_ptr<span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span> <span class="token operator">*</span>bss<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>We will convert all pointers to integers based on the pointer size of the eBPF program&#x27;s target instruction set, for example, <code>name_ptr</code>. In addition, padding bytes will be explicitly added to the structure to ensure that the structure layout matches the target, for example using <code>char __pad0[4];</code>. We will also use <code>static_assert</code> to ensure that the size of the structure matches the type length in the original BTF (BPF Type Format) information.### Building User-Space Wasm Code and Accessing Kernel-Space Data</p><p>We assume the use of wasi-sdk to build the wasm binary from C/C++ code. You can also use the emcc toolchain to build the wasm binary, and the commands should be similar. You can run the following command to install wasi-sdk:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line"><span class="token function">wget</span> https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-17/wasi-sdk-17.0-linux.tar.gz
</span><span class="code-line"><span class="token function">tar</span> <span class="token parameter variable">-zxf</span> wasi-sdk-17.0-linux.tar.gz
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/wasi-sdk/ <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">mv</span> wasi-sdk-17.0/* /opt/wasi-sdk/
</span></code></pre></div><p>Then running <code>make</code> will compile the C code to generate the Wasm bytecode in the <code>Makefile</code> using wasi-clang:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">/opt/wasi-sdk/bin/clang <span class="token parameter variable">-O2</span> <span class="token parameter variable">--sysroot</span><span class="token operator">=</span>/opt/wasi-sdk/share/wasi-sysroot -Wl,--allow-undefined <span class="token parameter variable">-o</span> bootstrap.wasm bootstrap.c
</span></code></pre></div><p>Since the C structure layout on the host (or eBPF side) might be different from the target (Wasm side), you can use ecc and our wasm-bpftool to generate the C header file for the user-space code:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">ecc bootstrap.h --header-only
</span><span class="code-line"><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/third_party/bpftool/src/bpftool btf dump <span class="token function">file</span> bootstrap.bpf.o <span class="token function">format</span> c <span class="token parameter variable">-j</span> <span class="token operator">&gt;</span> bootstrap.wasm.h
</span></code></pre></div><p>For example, the original kernel-side header file contains the following structure definition:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">event</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">int</span> ppid<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> exit_code<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> duration_ns<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> comm<span class="token punctuation">[</span>TASK_COMM_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> filename<span class="token punctuation">[</span>MAX_FILENAME_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> exit_event<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Our tool will transform it to:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">event</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">int</span> ppid<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> exit_code<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> __pad0<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> duration_ns<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> comm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> filename<span class="token punctuation">[</span><span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">char</span> exit_event<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">static_assert</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">event</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token string">&quot;Size of event is not 168&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p><strong>Note: This process and tool are not always necessary. For simple applications, you can do it manually.</strong> For cases where both kernel-side and Wasm applications use C/C++ languages, you can manually write all event structure definitions, use <code>__attribute__((packed))</code> to avoid padding bytes, and convert all pointers between the host and Wasm side to the correct integers. All types must have the same size and layout as the host on the Wasm side.</p><p>For complex programs, manually confirming the correct memory layout is difficult. Therefore, we have created a Wasm-specific <code>bpftool</code> that generates a C header file containing all type definitions and the correct structure layout from <code>BTF</code> information for user-space code. By using a similar approach, you can convert all structure definitions in the eBPF program to the memory layout on the Wasm side at once, ensuring endianness consistency to access correctly.</p><p>For cases where Wasm is not developed using the C language, with the help of Wasm&#x27;s component model, we can also output these BTF information structure definitions as wit type declarations, and then use the wit-bindgen tool in user-space code to generate type definitions for multiple languages (such as C/C++/Rust/Go) at once. This will be described in detail in the section on how to write eBPF programs in Rust in Wasm, and we will continue to improve these steps and toolchains to enhance the programming experience of Wasm-bpf programs.</p><p>We provide a libbpf API library for Wasm programs that includes only header files. You can find it in libbpf-wasm.h (wasm-include/libbpf-wasm.h), which contains some commonly used user-space libbpf APIs and type definitions. Wasm programs can use the libbpf API to manipulate BPF objects, for example:</p><div class="relative"><pre><code class="code-highlight language-c&quot;./*"><span class="code-line">skel = bootstrap_bpf__open();
</span><span class="code-line">/* Parameterize BPF code with minimum duration parameter */
</span><span class="code-line">skel-&gt;rodata-&gt;min_duration_ns = env.min_duration_ms * 1000000ULL;
</span><span class="code-line">/* Load &amp; verify BPF programs */
</span><span class="code-line">err = bootstrap_bpf__load(skel);
</span><span class="code-line">/* Attach tracepoints */
</span><span class="code-line">err = bootstrap_bpf__attach(skel);
</span><span class="code-line">
</span><span class="code-line">The rodata section is used to store constants in the BPF program, and these values will be mapped to the correct offsets in the object file generated by bpftool gen skeleton. After opening, the values can be modified through memory mapping, so there is no need to compile the libelf library in Wasm. The BPF object can still be dynamically loaded and manipulated at runtime.
</span><span class="code-line">
</span><span class="code-line">The C code on the Wasm side is slightly different from the local libbpf code, but it can provide most of the functionalities from the eBPF side. For example, polling from a ring buffer or perf buffer, accessing maps from both the Wasm and eBPF sides, loading, attaching, and detaching BPF programs, etc. It can support a wide range of eBPF program types and maps, covering most use cases of eBPF programs in domains such as tracing, networking, and security.
</span><span class="code-line">
</span><span class="code-line">Due to the lack of certain functionalities on the Wasm side, such as signal handler support (as of February 2023), the original C code may not be directly compilable to wasm. You may need to make slight modifications to the code to make it work. We will make best efforts to make the libbpf API on the wasm side as similar as possible to the libbpf API typically used in user space so that user space code can be directly compiled to wasm in the future. We will also provide more language bindings (e.g., Go) for wasm-based eBPF program development libraries as soon as possible.
</span><span class="code-line">
</span><span class="code-line">You can use the polling API in user space programs to retrieve data uploaded from kernel space. It is a wrapper for the ring buffer and perf buffer, allowing user space code to use the same API to poll events from either a ring buffer or a perf buffer, depending on the type specified in the BPF program. For example, ring buffer polling is defined as `BPF_MAP_TYPE_RINGBUF`:
</span><span class="code-line">
</span><span class="code-line">```c
</span><span class="code-line">struct {
</span><span class="code-line">    __uint(type, BPF_MAP_TYPE_RINGBUF);
</span><span class="code-line">    __uint(max_entries, 256 * 1024);
</span><span class="code-line">} rb SEC(&quot;.maps&quot;);
</span></code></pre></div><p>You can use the following code in user space to poll events from the ring buffer:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">rb <span class="token operator">=</span> <span class="token function">bpf_buffer__open</span><span class="token punctuation">(</span>skel<span class="token operator">-&gt;</span>maps<span class="token punctuation">.</span>rb<span class="token punctuation">,</span> handle_event<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/* Process events */</span>
</span><span class="code-line"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-8s %-5s %-16s %-7s %-7s %s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TIME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EVENT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;COMM&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PID&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">       <span class="token string">&quot;PPID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FILENAME/EXIT CODE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>exiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// poll buffer</span>
</span><span class="code-line">    err <span class="token operator">=</span> <span class="token function">bpf_buffer__poll</span><span class="token punctuation">(</span>rb<span class="token punctuation">,</span> <span class="token number">100</span> <span class="token comment">/* timeout, ms */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Ring buffer polling does not require serialization overhead. The bpf_buffer__poll API will call the handle_event callback function to process event data from the ring buffer:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">int</span>
</span><span class="code-line"><span class="token function">handle_event</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ctx<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token class-name">size_t</span> data_sz<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">event</span> <span class="token operator">*</span>e <span class="token operator">=</span> data<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>exit_event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-8s %-5s %-16s %-7d %-7d [%u]&quot;</span><span class="token punctuation">,</span> ts<span class="token punctuation">,</span> <span class="token string">&quot;EXIT&quot;</span><span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>comm<span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>pid<span class="token punctuation">,</span>
</span><span class="code-line">               e<span class="token operator">-&gt;</span>ppid<span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>exit_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>duration_ns<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; (%llums)&quot;</span><span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>duration_ns <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">```The Markdown content has been translated to English <span class="token keyword">while</span> preserving the original formatting<span class="token operator">:</span>
</span><span class="code-line">
</span><span class="code-line">&quot;Runtime is based on the libbpf CO<span class="token operator">-</span><span class="token function">RE</span> <span class="token punctuation">(</span>Compile Once<span class="token punctuation">,</span> Run Everywhere<span class="token punctuation">)</span> API<span class="token punctuation">,</span> which is used to load BPF objects into the kernel<span class="token punctuation">.</span> Therefore<span class="token punctuation">,</span> wasm<span class="token operator">-</span>bpf programs are not affected by the kernel version they are compiled with and can run on any kernel version that supports BPF CO<span class="token operator">-</span>RE<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line">### Accessing and updating map data of eBPF programs from user<span class="token operator">-</span>space programs
</span><span class="code-line">
</span><span class="code-line">runqlat is a more complex example that shows the scheduler run queue latency through a histogram<span class="token punctuation">,</span> displaying how <span class="token keyword">long</span> a task has waited to run<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line">```console
</span><span class="code-line">$ sudo <span class="token punctuation">.</span><span class="token operator">/</span>wasm<span class="token operator">-</span>bpf runqlat<span class="token punctuation">.</span>wasm <span class="token operator">-</span>h
</span><span class="code-line">Summarize run <span class="token function">queue</span> <span class="token punctuation">(</span>scheduler<span class="token punctuation">)</span> latency as a histogram<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line">USAGE<span class="token operator">:</span> runqlat <span class="token punctuation">[</span><span class="token operator">--</span>help<span class="token punctuation">]</span> <span class="token punctuation">[</span>interval<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">EXAMPLES<span class="token operator">:</span>
</span><span class="code-line">    runqlat         # summarize run queue latency as a histogram
</span><span class="code-line">    runqlat <span class="token number">1</span> <span class="token number">10</span>    # print <span class="token number">1</span> second summaries<span class="token punctuation">,</span> <span class="token number">10</span> times
</span><span class="code-line">$ sudo <span class="token punctuation">.</span><span class="token operator">/</span>wasm<span class="token operator">-</span>bpf runqlat<span class="token punctuation">.</span>wasm <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line">Tracing run queue latency<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Hit Ctrl<span class="token operator">-</span>C to end<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line">     usecs               <span class="token operator">:</span> count    distribution
</span><span class="code-line">         <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token number">1</span>          <span class="token operator">:</span> <span class="token number">72</span>       <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>           <span class="token operator">|</span>
</span><span class="code-line">         <span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">3</span>          <span class="token operator">:</span> <span class="token number">93</span>       <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>   <span class="token operator">|</span>
</span><span class="code-line">         <span class="token number">4</span> <span class="token operator">-&gt;</span> <span class="token number">7</span>          <span class="token operator">:</span> <span class="token number">98</span>       <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">|</span>
</span><span class="code-line">         <span class="token number">8</span> <span class="token operator">-&gt;</span> <span class="token number">15</span>         <span class="token operator">:</span> <span class="token number">96</span>       <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">|</span>
</span><span class="code-line">        <span class="token number">16</span> <span class="token operator">-&gt;</span> <span class="token number">31</span>         <span class="token operator">:</span> <span class="token number">38</span>       <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>                         <span class="token operator">|</span>
</span><span class="code-line">        <span class="token number">32</span> <span class="token operator">-&gt;</span> <span class="token number">63</span>         <span class="token operator">:</span> <span class="token number">4</span>        <span class="token operator">|</span><span class="token operator">*</span>                                       <span class="token operator">|</span>
</span><span class="code-line">        <span class="token number">64</span> <span class="token operator">-&gt;</span> <span class="token number">127</span>        <span class="token operator">:</span> <span class="token number">5</span>        <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span>                                      <span class="token operator">|</span>
</span><span class="code-line">       <span class="token number">128</span> <span class="token operator">-&gt;</span> <span class="token number">255</span>        <span class="token operator">:</span> <span class="token number">6</span>        <span class="token operator">|</span><span class="token operator">*</span><span class="token operator">*</span>                                      <span class="token operator">|</span>
</span><span class="code-line">       <span class="token number">256</span> <span class="token operator">-&gt;</span> <span class="token number">511</span>        <span class="token operator">:</span> <span class="token number">0</span>        <span class="token operator">|</span>                                        <span class="token operator">|</span>
</span><span class="code-line">       <span class="token number">512</span> <span class="token operator">-&gt;</span> <span class="token number">1023</span>       <span class="token operator">:</span> <span class="token number">0</span>        <span class="token operator">|</span>                                        <span class="token operator">|</span>
</span><span class="code-line">      <span class="token number">1024</span> <span class="token operator">-&gt;</span> <span class="token number">2047</span>       <span class="token operator">:</span> <span class="token number">0</span>        <span class="token operator">|</span>                                        <span class="token operator">|</span>
</span><span class="code-line">      <span class="token number">2048</span> <span class="token operator">-&gt;</span> <span class="token number">4095</span>       <span class="token operator">:</span> <span class="token number">1</span>        <span class="token operator">|</span>                                        <span class="token operator">|</span>
</span></code></pre></div><p>In runqlat, the <code>map</code> API is used to access and directly read data from a <code>map</code> in the kernel from user-space, for example:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">bpf_map_get_next_key</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lookup_key<span class="token punctuation">,</span> <span class="token operator">&amp;</span>next_key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        err <span class="token operator">=</span> <span class="token function">bpf_map_lookup_elem</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>next_key<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hist<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">        lookup_key <span class="token operator">=</span> next_key<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    lookup_key <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">bpf_map_get_next_key</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lookup_key<span class="token punctuation">,</span> <span class="token operator">&amp;</span>next_key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        err <span class="token operator">=</span> <span class="token function">bpf_map_delete_elem</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>next_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">        lookup_key <span class="token operator">=</span> next_key<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>When running wasm code, shared memory will be used to access the kernel map. The kernel space can directly copy data to the stack of the Wasm virtual machine in user space, without the additional copy overhead between the user space host program and the Wasm runtime. Similarly, for type definitions shared between the Wasm virtual machine and the kernel space, careful checking is required to ensure that they have consistent types in both Wasm and kernel space.</p><p>The <code>bpf_map_update_elem</code> function can be used to update the eBPF map in user space programs to update the kernel&#x27;s eBPF map, for example:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">        cg_map_fd <span class="token operator">=</span> <span class="token function">bpf_map__fd</span><span class="token punctuation">(</span>obj<span class="token operator">-&gt;</span>maps<span class="token punctuation">.</span>cgroup_map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        cgfd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>cgroupspath<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>cgfd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bpf_map_update_elem</span><span class="token punctuation">(</span>cg_map_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>idx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cgfd<span class="token punctuation">,</span> BPF_ANY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span></code></pre></div><p>Therefore, the eBPF program in the kernel can obtain configurations from the Wasm program side, or receive messages during runtime.</p><h3 class="content-header" id="more-examples-socket-filter-and-lsm"><a class="break-words" href="#more-examples-socket-filter-and-lsm" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>More examples: socket filter and LSM</h3><p>In the repository, we also provide more examples, such as using socket filters to monitor and filter packets:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">socket_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">so_event</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
</span><span class="code-line">    __u8 verlen<span class="token punctuation">;</span>
</span><span class="code-line">    __u16 proto<span class="token punctuation">;</span>
</span><span class="code-line">    __u32 nhoff <span class="token operator">=</span> ETH_HLEN<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>verlen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>verlen <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>ports<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    e<span class="token operator">-&gt;</span>pkt_type <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>pkt_type<span class="token punctuation">;</span>
</span><span class="code-line">    e<span class="token operator">-&gt;</span>ifindex <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>ifindex<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_ringbuf_submit</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">return</span> skb<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Linux Security Modules (LSM) is a hook-based framework for implementing security policies and mandatory access control in the Linux kernel. Until now, there have been two choices for enforcing security policy goals: configuring existing LSM modules (such as AppArmor and SELinux) or writing custom kernel modules.</p><p>Linux Kernel 5.7 introduces a third option: LSM eBPF. LSM BPF allows developers to write custom policies without configuring or loading kernel modules. LSM BPF programs are verified at load time and then executed when reaching the LSM hook in the call path. For example, we can use LSM in a Wasm lightweight container to restrict file system operations:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token comment">// all lsm the hook point refer https://www.kernel.org/doc/html/v5.2/security/LSM.html</span>
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;lsm/path_rmdir&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">path_rmdir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">path</span> <span class="token operator">*</span>dir<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">dentry</span> <span class="token operator">*</span>dentry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">char</span> comm<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">bpf_get_current_comm</span><span class="token punctuation">(</span>comm<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> dir_name<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;can_not_rm&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> d_iname<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token function">bpf_probe_read_kernel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d_iname<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>d_iname<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">                        <span class="token operator">&amp;</span><span class="token punctuation">(</span>dir<span class="token operator">-&gt;</span>dentry<span class="token operator">-&gt;</span>d_iname<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">bpf_printk</span><span class="token punctuation">(</span><span class="token string">&quot;comm %s try to rmdir %s&quot;</span><span class="token punctuation">,</span> comm<span class="token punctuation">,</span> d_iname<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>d_iname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span>dir_name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 class="content-header" id="summary"><a class="break-words" href="#summary" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Summary</h2><p>In this example, we discuss how to use C/C++ language to write eBPF programs and compile them into Wasm modules. For more complete code, please refer to our GitHub repository: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/wasm-bpf">https://github.com/eunomia-bpf/wasm-bpf</a>.</p><p>In the next article, we will discuss how to write eBPF programs using Rust and compile them into Wasm modules. We will also cover using OCI images to publish, deploy, and manage eBPF programs, similar to the experience with Docker.</p><p>Next, we will continue to improve the experience of developing and running eBPF programs in multiple languages within Wasm. We will provide more comprehensive examples, user-level development libraries/toolchains, and more specific use cases.</p><h2 class="content-header" id="reference"><a class="break-words" href="#reference" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Reference</h2><ul><li>wasm-bpf GitHub repository: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/wasm-bpf">https://github.com/eunomia-bpf/wasm-bpf</a></li><li>What is eBPF: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://ebpf.io/what-is-ebpf">https://ebpf.io/what-is-ebpf</a></li><li>WASI-eBPF: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/WebAssembly/WASI/issues/513">https://github.com/WebAssembly/WASI/issues/513</a></li><li>Anolis Community eBPF Technology Exploration SIG: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://openanolis.cn/sig/ebpfresearch">https://openanolis.cn/sig/ebpfresearch</a></li><li>eunomia-bpf project: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/eunomia-bpf">https://github.com/eunomia-bpf/eunomia-bpf</a></li><li>eunomia-bpf project Anolis Gitee mirror: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://gitee.com/anolis/eunomia">https://gitee.com/anolis/eunomia</a></li><li>Wasm-bpf: Bridging the gap between WebAssembly and eBPF kernel programming: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew">https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew</a></li><li>When WASM meets eBPF: Writing, distributing, loading, and running eBPF programs using WebAssembly: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/573941739">https://zhuanlan.zhihu.com/p/573941739</a></li><li>Teaching you how to use eBPF LSM to hotfix Linux kernel vulnerabilities: <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://www.bilibili.com/read/cv19597563">https://www.bilibili.com/read/cv19597563</a></li></ul></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl"><a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2Fhow-to-write-c-in-wasm">Discuss on Twitter</a> • <a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37/yunwei37-blog/blob/main/data/blog/how-to-write-c-in-wasm.mdx">View on GitHub</a></div><div class="pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl" id="comment"><button>Load Comments</button></div></div><footer><div class="divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4">Tags</h2><div class="flex flex-wrap gap-2"><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/ebpf">ebpf</a><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/systems">systems</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-6 xl:py-8"><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Previous Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/how-to-write-rust-in-wasm">在 WebAssembly 中使用 Rust 编写 eBPF 程序并发布 OCI 镜像</a></div></div><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Next Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/2022">2022 一个新的开始</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105" aria-label="Back to the blog" href="/blog">← Back to the blog</a></div></footer></div></div></article></section><!--$--><!--/$--></main><footer class="border-t border-gray-200/30 dark:border-gray-700/30 pt-8"><div class="flex flex-col items-center space-y-6"><div class="flex flex-wrap justify-center gap-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:yunwei356@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Mail</title><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://facebook.com"><span class="sr-only">facebook</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Facebook</title><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://youtube.com"><span class="sr-only">youtube</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Youtube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/yusheng-zheng-611920280"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Linkedin</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://bsky.app/"><span class="sr-only">bluesky</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Bluesky</title><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://x.com/yunwei37"><span class="sr-only">x</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.instagram.com"><span class="sr-only">instagram</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Instagram</title><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.threads.net"><span class="sr-only">threads</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://medium.com"><span class="sr-only">medium</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Medium</title><path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"></path></svg></a></div><div class="flex space-x-2 text-sm opacity-80"><div>Yusheng Zheng</div><div> • </div><div>© 2026</div><div> • </div><a class="hover:text-primary-500 transition-colors" href="/">云微的胡思乱想</a></div><div class="text-sm opacity-60"><a class="hover:text-primary-500 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div><script src="/_next/static/chunks/webpack-91cf1b3b084c6ba2.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1478,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"ThemeProviders\"]\n3:I[4091,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n4:I[9243,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"\"]\n5:I[7392,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"KBarSearchProvider\"]\n6:I[6874,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"\"]\ne:I[8393,[],\"\"]\n:HL[\"/_next/static/media/36966cca54120369-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/4ac7c0f872b74ee7.css\",\"style\"]\n:HL[\"/_next/static/css/a06d7e24bf9a7d93.css\",\"style\"]\n:HL[\"/_next/static/css/7246298b30c42979.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"MYXrWUjg0HELsl6zLYF_6\",\"p\":\"\",\"c\":[\"\",\"blog\",\"how-to-write-c-in-wasm\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"how-to-write-c-in-wasm\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4ac7c0f872b74ee7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a06d7e24bf9a7d93.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_dd5b2f scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/static/favicons/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen\",\"children\":[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$L4\",null,{\"async\":true,\"defer\":true,\"src\":\"https://analytics.umami.is/script.js\"}],\"$undefined\",\"$undefined\"],[\"$\",\"div\",null,{\"className\":\"min-h-screen flex flex-col justify-center py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8\",\"children\":[\"$\",\"$L5\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30\",\"children\":[[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/\",\"aria-label\":\"yunwei37\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mr-3\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":40,\"height\":40,\"fill\":\"none\",\"children\":[[\"$\",\"defs\",null,{\"children\":[[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__a\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#06b6d4\",\"stopOpacity\":1}}]]}],[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__b\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#8b5cf6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}]]}]]}],[\"$\",\"circle\",null,{\"cx\":20,\"cy\":20,\"r\":18,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.1}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__a)\",\"d\":\"m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z\"}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__b)\",\"d\":\"m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z\",\"opacity\":0.8}],[\"$\",\"circle\",null,{\"cx\":32,\"cy\":12,\"r\":2,\"fill\":\"url(#logo_svg__b)\"}],[\"$\",\"circle\",null,{\"cx\":8,\"cy\":12,\"r\":1.5,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.6}]]}]}],[\"$\",\"div\",null,{\"className\":\"hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":\"yunwei37\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"no-scrollbar hidden items-center space-x-2 sm:flex\",\"children\":[[\"$\",\"$L6\",\"Blog\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$L6\",\"Docs\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/docs\",\"children\":\"Docs\"}],[\"$\",\"$L6\",\"Tags\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/tags\",\"children\":\"Tags\"}],[\"$\",\"$L6\",\"About\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/about\",\"children\":\"About\"}]]}],\"$L7\"]}]]}],\"$L8\",\"$L9\"]}]}]}]]}]}]]}]]}],{\"children\":[\"blog\",\"$La\",{\"children\":[[\"slug\",\"how-to-write-c-in-wasm\",\"c\"],\"$Lb\",{\"children\":[\"__PAGE__\",\"$Lc\",{},null,false]},null,false]},null,false]},null,false],\"$Ld\",false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[4159,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"KBarButton\"]\n10:I[1762,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n11:I[7298,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5bb235cd9bfca45d.js\",\"177\",\"static/chunks/app/layout-66df3ac28fcfbced.js\"],\"default\"]\n12:I[7555,[],\"\"]\n13:I[1295,[],\"\"]\n1e:I[9665,[],\"OutletBoundary\"]\n20:I[4911,[],\"AsyncMetadataOutlet\"]\n22:I[9665,[],\"ViewportBoundary\"]\n24:I[9665,[],\"MetadataBoundary\"]\n25:\"$Sreact.suspense\"\n7:[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"className\":\"p-2 rounded-lg transition-all duration-200\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"main\",null,{\"className\":\"py-6\",\"children\":[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pt-6 pb-8 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl leading-9 font-extrabold tracking-tight md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl leading-normal font-bold md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$L6\",null,{\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm leading-5 font-medium text-white shadow-xs transition-colors duration-150 hover:bg-blue-700 focus:outline-hidden dark:hover:bg-blue-500\",\"href\":\"/\",\"children\":\"Back to homepage\"}]]}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"footer\",null,{\"className\":\"border-t border-gray-200/30 dark:border-gray-700/30 pt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center space-y-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap justify-center gap-4\",\"children\":[[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"mailto:yunwei356@gmail.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mail\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 20 20\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Mail\"}],[\"$\",\"path\",null,{\"d\":\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\"}],[\"$\",\"path\",null,{\"d\":\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://facebook.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"facebook\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Facebook\"}],[\"$\",\"path\",null,{\"d\":\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://youtube.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"youtube\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Youtube\"}],[\"$\",\"path\",null,{\"d\":\"M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z\"}]]}]]}],\"$L14\",\"$L15\",\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\"]}],\"$L1b\",\"$L1c\"]}]}]\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nb:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nc:[\"$\",\"$1\",\"c\",{\"children\":[\"$L1d\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7246298b30c42979.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L1e\",null,{\"children\":[\"$L1f\",[\"$\",\"$L20\",null,{\"promise\":\"$@21\"}]]}]]}]\nd:[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L22\",null,{\"children\":\"$L23\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L24\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$25\",null,{\"fallback\":null,\"children\":\"$L26\"}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.linkedin.com/in/yusheng-zheng-611920280\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"linkedin\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Linkedin\"}],[\"$\",\"path\",null,{\"d\":\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"15:null\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://bsky.app/\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"bluesky\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Bluesky\"}],[\"$\",\"path\",null,{\"d\":\"M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://x.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"x\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"X\"}],[\"$\",\"path\",null,{\"d\":\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z\"}]]}]]}]\n27:T69f,"])</script><script>self.__next_f.push([1,"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"])</script><script>self.__next_f.push([1,"18:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.instagram.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"instagram\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Instagram\"}],[\"$\",\"path\",null,{\"d\":\"$27\"}]]}]]}]\n28:T498,"])</script><script>self.__next_f.push([1,"M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"])</script><script>self.__next_f.push([1,"19:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.threads.net\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"threads\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Threads\"}],[\"$\",\"path\",null,{\"d\":\"$28\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1a:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://medium.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"medium\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Medium\"}],[\"$\",\"path\",null,{\"d\":\"M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"div\",null,{\"className\":\"flex space-x-2 text-sm opacity-80\",\"children\":[[\"$\",\"div\",null,{\"children\":\"Yusheng Zheng\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2026\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$L6\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"href\":\"/\",\"children\":\"云微的胡思乱想\"}]]}]\n1c:[\"$\",\"div\",null,{\"className\":\"text-sm opacity-60\",\"children\":[\"$\",\"a\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/timlrx/tailwind-nextjs-starter-blog\",\"children\":\"Tailwind Nextjs Theme\"}]}]\n"])</script><script>self.__next_f.push([1,"29:I[1839,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\n2a:I[3063,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"1d:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf\\\",\\\"datePublished\\\":\\\"2022-02-11T16:00:00.000Z\\\",\\\"dateModified\\\":\\\"2022-02-11T16:00:00.000Z\\\",\\\"image\\\":\\\"/static/images/twitter-card.png\\\",\\\"url\\\":\\\"https://www.yunwei37.com/blog/how-to-write-c-in-wasm\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Yusheng Zheng (云微)\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L29\",null,{}],[\"$\",\"article\",null,{\"className\":\"content-glass p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-4 text-center\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"space-y-4\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base leading-6 font-medium text-gray-600 dark:text-gray-300\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2022-02-11T16:00:00.000Z\",\"children\":\"Friday, February 11, 2022\"}]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Authors\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0\",\"children\":[[\"$\",\"li\",\"Yusheng Zheng (云微)\",{\"className\":\"flex items-center space-x-3 glass p-4 rounded-xl\",\"children\":[[\"$\",\"$L2a\",null,{\"src\":\"/static/images/avatar.png\",\"width\":38,\"height\":38,\"alt\":\"avatar\",\"className\":\"h-10 w-10 rounded-full\"}],[\"$\",\"dl\",null,{\"className\":\"text-sm leading-5 font-medium whitespace-nowrap\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Name\"}],[\"$\",\"dd\",null,{\"className\":\"text-gray-900 dark:text-gray-100\",\"children\":\"Yusheng Zheng (云微)\"}],[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Twitter\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/yunwei37\",\"children\":\"@yunwei37\"}]}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"content-header\",\"id\":\"在-webassembly-中编写-ebpf-程序和使用-libbpf\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#在-webassembly-中编写-ebpf-程序和使用-libbpf\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf\"]}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"Authors: Yu Tong, Zheng Yusheng\"}]}],\"$L2b\",\"$L2c\",\"$L2d\",\"$L2e\",\"$L2f\",\"$L30\",\"$L31\",\"$L32\",\"$L33\",\"$L34\",\"$L35\",\"$L36\",\"$L37\",\"$L38\",\"$L39\",\"$L3a\",\"$L3b\",\"$L3c\",\"$L3d\",\"$L3e\",\"$L3f\",\"$L40\",\"$L41\",\"$L42\",\"$L43\",\"$L44\",\"$L45\",\"$L46\",\"$L47\",\"$L48\",\"$L49\",\"$L4a\",\"$L4b\",\"$L4c\",\"$L4d\",\"$L4e\",\"$L4f\",\"$L50\",\"$L51\",\"$L52\",\"$L53\",\"$L54\",\"$L55\",\"$L56\",\"$L57\",\"$L58\",\"$L59\",\"$L5a\",\"$L5b\",\"$L5c\",\"$L5d\",\"$L5e\",\"$L5f\",\"$L60\",\"$L61\",\"$L62\",\"$L63\",\"$L64\",\"$L65\",\"$L66\",\"$L67\",\"$L68\",\"$L69\",\"$L6a\",\"$L6b\",\"$L6c\",\"$L6d\",\"$L6e\"]}],\"$L6f\",\"$L70\"]}],\"$L71\"]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"72:I[2100,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\ndc:I[1449,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-1ed2702378ba9d6b.js\"],\"default\"]\n2b:[\"$\",\"p\",null,{\"children\":\"eBPF (extended Berkeley Packet Filter) is a high-performance kernel virtual machine that runs in the kernel space and is used to collect system and network information. With the continuous development of computer technology, eBPF has become increasingly powerful and is used to build various efficient online diagnostic and tracing systems, as well as secure networks and service meshes.\"}]\n2c:[\"$\",\"p\",null,{\"children\":\"WebAssembly (Wasm) was initially developed for browser security sandbox purposes. As of now, WebAssembly has evolved into a high-performance, cross-platform, and multi-language software sandbox environment for cloud-native software components. The lightweight nature of Wasm containers makes them suitable for running as the next-generation serverless platform runtime or for efficient execution in resource-constrained scenarios such as edge computing.\"}]\n"])</script><script>self.__next_f.push([1,"2d:[\"$\",\"p\",null,{\"children\":\"Now, with the help of the Wasm-bpf compilation toolchain and runtime, we can use Wasm to write eBPF programs as cross-platform modules, while using C/C++ or Rust to write Wasm programs. By using eBPF programs in WebAssembly, we not only enable Wasm applications to benefit from the high performance and access to system interfaces of eBPF, but also allow eBPF programs to leverage the sandboxing, flexibility, cross-platform nature, and dynamic loading of Wasm. Additionally, we can conveniently and quickly distribute and manage eBPF programs using Wasm OCI images. Combining these two technologies will provide a completely new development experience for the eBPF and Wasm ecosystems!\"}]\n"])</script><script>self.__next_f.push([1,"2e:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"writing-dynamically-loading-and-distributing-ebpf-programs-in-wasm-with-the-wasm-bpf-toolchain\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#writing-dynamically-loading-and-distributing-ebpf-programs-in-wasm-with-the-wasm-bpf-toolchain\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Writing, Dynamically Loading, and Distributing eBPF Programs in Wasm with the Wasm-bpf Toolchain\"]}]\n"])</script><script>self.__next_f.push([1,"2f:[\"$\",\"p\",null,{\"children\":[\"Wasm-bpf is a new open-source project: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/wasm-bpf\",\"children\":\"https://github.com/eunomia-bpf/wasm-bpf\"}],\". It defines an abstraction for the eBPF-related system interfaces and provides a corresponding development toolchain, library, and a general Wasm + eBPF runtime instance. It can provide a similar development experience to libbpf-bootstrap, automatically generating skeleton header files and data structure definitions for unordered communication between Wasm and eBPF. With this toolchain, you can easily build your own Wasm-eBPF runtime in any language on any platform. For more details, please refer to our previous blog post: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew\",\"children\":\"Wasm-bpf: Bridging WebAssembly and eBPF Kernel Programmability\"}],\".\"]}]\n"])</script><script>self.__next_f.push([1,"30:[\"$\",\"p\",null,{\"children\":\"With Wasm, we can build eBPF applications using multiple languages and manage and distribute them in a unified and lightweight manner. As an example, our sample application bootstrap.wasm is only ~90K in size, making it easy to distribute over the network and dynamically deploy, load, and run on another machine in less than 100ms, while retaining the isolation characteristics of lightweight containers. The runtime does not require kernel headers, LLVM, clang, or any resource-consuming heavy compilation work.\"}]\n31:[\"$\",\"p\",null,{\"children\":\"This article will discuss writing and compiling eBPF programs in C/C++ and converting them into Wasm modules. A specific example of writing and compiling eBPF programs in Rust and converting them into Wasm modules will be described in the next article.\"}]\n32:[\"$\",\"p\",null,{\"children\":\"We provide several sample programs in the repository, each corresponding to different scenarios such as observability, networking, and security.\"}]\n"])</script><script>self.__next_f.push([1,"33:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"writing-ebpf-programs-in-cc-and-compiling-into-wasm\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#writing-ebpf-programs-in-cc-and-compiling-into-wasm\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Writing eBPF Programs in C/C++ and Compiling into Wasm\"]}]\n"])</script><script>self.__next_f.push([1,"34:[\"$\",\"p\",null,{\"children\":\"libbpf is a C/C++ user space loading and control library for eBPF and has become the de facto API standard for eBPF user space. libbpf also supports the CO-RE (Compile Once - Run Everywhere) solution, which allows precompiled BPF code to work on different kernel versions without the need to recompile for each specific kernel. We aim to maintain compatibility and minimize migration costs to Wasm (if necessary) by keeping the user space API and behavior consistent with libbpf.\"}]\n35:[\"$\",\"p\",null,{\"children\":\"libbpf-bootstrap provides templates for generating libbpf-based BPF programs, making it easy for developers to generate custom BPF programs. In general, outside the Wasm sandbox, using the libbpf-bootstrap scaffolding, you can quickly and easily build BPF applications using C/C++.\"}]\n36:[\"$\",\"p\",null,{\"children\":\"The compilation, building, and running of eBPF programs (regardless of the programming language) usually involve the following steps:\"}]\n37:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Write the code for the kernel space eBPF program, generally using C/C++ or Rust.\"}],[\"$\",\"li\",null,{\"children\":\"Compile the eBPF program using the clang compiler or related toolchains (including BTF information to achieve cross-kernel version portability).\"}],[\"$\",\"li\",null,{\"children\":\"In the user space development program, write the corresponding logic for loading, controlling, mounting, and processing data.\"}],[\"$\",\"li\",null,{\"children\":\"During runtime, load the eBPF program into the kernel from the user space and execute it.\"}]]}]\n"])</script><script>self.__next_f.push([1,"38:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"bootstrap\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#bootstrap\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"bootstrap\"]}]\n"])</script><script>self.__next_f.push([1,"39:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bootstrap\"}],\" is a simple (but practical) example of a BPF application. It tracks the startup (specifically, the \",[\"$\",\"code\",null,{\"children\":\"exec()\"}],\" series of system calls) and exit of processes, and sends data about the file name, PID, and parent PID, as well as the exit status and duration of the process. With \",[\"$\",\"code\",null,{\"children\":\"-d \u003cmin-duration-ms\u003e\"}],\", you can specify the minimum duration of the processes to be recorded.\"]}]\n3a:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bootstrap\"}],\" is created based on the similar idea of \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/iovisor/bcc/tree/master/libbpf-tools\",\"children\":\"libbpf-tools\"}],\" in the BCC package, but it is designed to be more independent and has a simpler Makefile to simplify user's specific needs. It demonstrates typical BPF features, including cooperation with multiple BPF program segments, maintaining state using BPF maps, sending data to userspace using BPF ring buffer, and parameterizing application behavior using global variables.\"]}]\n3b:[\"$\",\"p\",null,{\"children\":[\"Here is an example output of running \",[\"$\",\"code\",null,{\"children\":\"bootstrap\"}],\" by compiling it with Wasm:\"]}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"$L72\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-console\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ sudo sudo ./wasm-bpf bootstrap.wasm -h\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"BPF bootstrap demo application.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"It traces process start and exits and shows associated\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"information (filename, process duration, PID and PPID, etc).\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"USAGE: ./bootstrap [-d \u003cmin-duration-ms\u003e] -v\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ sudo ./wasm-bpf bootstrap.wasm\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"TIME     EVENT COMM             PID     PPID    FILENAME/EXIT CODE\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:58 EXEC  sed              74911   74910   /usr/bin/sed\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:58 EXIT  sed              74911   74910   [0] (2ms)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:58 EXIT  cat              74912   74910   [0] (0ms)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:58 EXEC  cat              74913   74910   /usr/bin/cat\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXIT  cat              74913   74910   [0] (0ms)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXEC  cat              74914   74910   /usr/bin/cat\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXIT  cat              74914   74910   [0] (0ms)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXEC  cat              74915   74910   /usr/bin/cat\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXIT  cat              74915   74910   [0] (1ms)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"18:57:59 EXEC  sleep            74916   74910   /usr/bin/sleep\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"3d:[\"$\",\"p\",null,{\"children\":[\"We can provide a development experience similar to libbpf-bootstrap. Just run \",[\"$\",\"code\",null,{\"children\":\"make\"}],\" to build the wasm binary:\"]}]\n3e:[\"$\",\"$L72\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-console\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"git clone https://github.com/eunomia-bpf/wasm-bpf --recursive\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"cd examples/bootstrap\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"make\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"3f:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"writing-ebpf-programs-in-kernel-space\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#writing-ebpf-programs-in-kernel-space\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Writing eBPF programs in kernel space\"]}]\n"])</script><script>self.__next_f.push([1,"40:[\"$\",\"p\",null,{\"children\":\"To build a complete eBPF program, you need to first write the BPF code in kernel space. This is typically done using the C language and compiled using clang:\"}]\n"])</script><script>self.__next_f.push([1,"41:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" LICENSE\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"license\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Dual BSD/GPL\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_MAP_TYPE_HASH\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"max_entries\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8192\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"pid_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"value\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" u64\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" exec_start \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".maps\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_MAP_TYPE_RINGBUF\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"max_entries\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"256\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1024\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" rb \",\"$L73\",\"$L74\",\"$L75\",\"$L76\",\"$L77\",\"\\\"\",\"$L78\",\"$L79\",\" \",\"$L7a\",\" \",\"$L7b\",\" \",\"$L7c\",\" \",\"$L7d\",\" min_duration_ns \",\"$L7e\",\" \",\"$L7f\",\"$L80\",\"\\n\"]}],\"$L81\",\"$L82\",\"$L83\",\"$L84\",\"$L85\",\"$L86\",\"$L87\",\"$L88\",\"$L89\",\"$L8a\",\"$L8b\"]}]}]\n"])</script><script>self.__next_f.push([1,"42:[\"$\",\"p\",null,{\"children\":[\"Due to space constraints, the full code is not shown here. The way to write kernel code is exactly the same as other libbpf-based programs. Generally, it includes some global variables, eBPF functions declared with \",[\"$\",\"code\",null,{\"children\":\"SEC\"}],\" for mounting points, and map objects used to store state or communicate between user space and kernel space (we are also doing other work in progress: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/iovisor/bcc/issues/4404\",\"children\":\"bcc to libbpf converter\"}],\", and once it is completed, you will be able to compile BCC-style eBPF kernel code in this way). After writing the eBPF program, running \",[\"$\",\"code\",null,{\"children\":\"make\"}],\" will invoke clang and llvm-strip in the \",[\"$\",\"code\",null,{\"children\":\"Makefile\"}],\" to build the BPF program and remove debug information:\"]}]\n"])</script><script>self.__next_f.push([1,"43:[\"$\",\"$L72\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"clang \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-g\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-O2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-target\"}],\" bpf \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-D__TARGET_ARCH_x86\"}],\" -I\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/third_party/vmlinux/x86/ \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-idirafter\"}],\" /usr/local/include \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-idirafter\"}],\" /usr/include \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c\"}],\" bootstrap.bpf.c \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-o\"}],\" bootstrap.bpf.o\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"llvm-strip \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-g\"}],\" bootstrap.bpf.o \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"# strip useless DWARF info\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"44:[\"$\",\"p\",null,{\"children\":\"Then we provide a specialized bpftool for Wasm, which generates C header files from BPF programs:\"}]\n45:[\"$\",\"$L72\",null,{\"className\":\"language-shell\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-shell\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/third_party/bpftool/src/bpftool gen skeleton \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-j\"}],\" bootstrap.bpf.o \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" bootstrap.skel.h\\n\"]}]}]}]\n46:[\"$\",\"p\",null,{\"children\":\"Since the C memory layout for eBPF itself is the same as the instruction set of the current machine, but Wasm has a specific memory layout (e.g., the current machine is 64-bit, and the Wasm virtual machine is 32-bit, so the C struct layout, pointer width, endianness, etc. may be different), in order to ensure that eBPF programs can communicate correctly with Wasm, we need to customize a specialized bpftool and other tools to generate a user space development framework that can work in Wasm.\"}]\n47:[\"$\",\"p\",null,{\"children\":\"The skeleton contains a skeleton for a BPF program, used to manipulate BPF objects and control the lifecycle of the BPF program, for example:\"}]\n"])</script><script>self.__next_f.push([1,"48:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bootstrap_bpf\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_object_skeleton\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"skeleton\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_object\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"obj\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_map\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"exec_start\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_map\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_map\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"rodata\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" maps\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_program\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"handle_exec\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bpf_program\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"handle_exit\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" progs\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bootstrap_bpf__rodata\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" min_duration_ns\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"rodata\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",\"$L8c\",\" \",\"$L8d\",\" \",\"$L8e\",\"\\n\"]}],\"$L8f\",\"$L90\",\"$L91\"]}]}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"p\",null,{\"children\":[\"We will convert all pointers to integers based on the pointer size of the eBPF program's target instruction set, for example, \",[\"$\",\"code\",null,{\"children\":\"name_ptr\"}],\". In addition, padding bytes will be explicitly added to the structure to ensure that the structure layout matches the target, for example using \",[\"$\",\"code\",null,{\"children\":\"char __pad0[4];\"}],\". We will also use \",[\"$\",\"code\",null,{\"children\":\"static_assert\"}],\" to ensure that the size of the structure matches the type length in the original BTF (BPF Type Format) information.### Building User-Space Wasm Code and Accessing Kernel-Space Data\"]}]\n4a:[\"$\",\"p\",null,{\"children\":\"We assume the use of wasi-sdk to build the wasm binary from C/C++ code. You can also use the emcc toolchain to build the wasm binary, and the commands should be similar. You can run the following command to install wasi-sdk:\"}]\n"])</script><script>self.__next_f.push([1,"4b:[\"$\",\"$L72\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-sh\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"wget\"}],\" https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-17/wasi-sdk-17.0-linux.tar.gz\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"tar\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-zxf\"}],\" wasi-sdk-17.0-linux.tar.gz\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sudo\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mkdir\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-p\"}],\" /opt/wasi-sdk/ \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sudo\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"mv\"}],\" wasi-sdk-17.0/* /opt/wasi-sdk/\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4c:[\"$\",\"p\",null,{\"children\":[\"Then running \",[\"$\",\"code\",null,{\"children\":\"make\"}],\" will compile the C code to generate the Wasm bytecode in the \",[\"$\",\"code\",null,{\"children\":\"Makefile\"}],\" using wasi-clang:\"]}]\n4d:[\"$\",\"$L72\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-sh\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"/opt/wasi-sdk/bin/clang \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-O2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--sysroot\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"/opt/wasi-sdk/share/wasi-sysroot -Wl,--allow-undefined \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-o\"}],\" bootstrap.wasm bootstrap.c\\n\"]}]}]}]\n4e:[\"$\",\"p\",null,{\"children\":\"Since the C structure layout on the host (or eBPF side) might be different from the target (Wasm side), you can use ecc and our wasm-bpftool to generate the C header file for the user-space code:\"}]\n"])</script><script>self.__next_f.push([1,"4f:[\"$\",\"$L72\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-sh\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"ecc bootstrap.h --header-only\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"..\"}],\"/third_party/bpftool/src/bpftool btf dump \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"file\"}],\" bootstrap.bpf.o \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"format\"}],\" c \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-j\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" bootstrap.wasm.h\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"50:[\"$\",\"p\",null,{\"children\":\"For example, the original kernel-side header file contains the following structure definition:\"}]\n"])</script><script>self.__next_f.push([1,"51:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" ppid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" exit_code\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" duration_ns\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"TASK_COMM_LEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" filename\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"MAX_FILENAME_LEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" exit_event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"52:[\"$\",\"p\",null,{\"children\":\"Our tool will transform it to:\"}]\n"])</script><script>self.__next_f.push([1,"53:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" ppid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" exit_code\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" __pad0\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" duration_ns\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" filename\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"127\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" exit_event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"__attribute__\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"packed\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"static_assert\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"168\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Size of event is not 168\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"54:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Note: This process and tool are not always necessary. For simple applications, you can do it manually.\"}],\" For cases where both kernel-side and Wasm applications use C/C++ languages, you can manually write all event structure definitions, use \",[\"$\",\"code\",null,{\"children\":\"__attribute__((packed))\"}],\" to avoid padding bytes, and convert all pointers between the host and Wasm side to the correct integers. All types must have the same size and layout as the host on the Wasm side.\"]}]\n55:[\"$\",\"p\",null,{\"children\":[\"For complex programs, manually confirming the correct memory layout is difficult. Therefore, we have created a Wasm-specific \",[\"$\",\"code\",null,{\"children\":\"bpftool\"}],\" that generates a C header file containing all type definitions and the correct structure layout from \",[\"$\",\"code\",null,{\"children\":\"BTF\"}],\" information for user-space code. By using a similar approach, you can convert all structure definitions in the eBPF program to the memory layout on the Wasm side at once, ensuring endianness consistency to access correctly.\"]}]\n56:[\"$\",\"p\",null,{\"children\":\"For cases where Wasm is not developed using the C language, with the help of Wasm's component model, we can also output these BTF information structure definitions as wit type declarations, and then use the wit-bindgen tool in user-space code to generate type definitions for multiple languages (such as C/C++/Rust/Go) at once. This will be described in detail in the section on how to write eBPF programs in Rust in Wasm, and we will continue to improve these steps and toolchains to enhance the programming experience of Wasm-bpf programs.\"}]\n57:[\"$\",\"p\",null,{\"children\":\"We provide a libbpf API library for Wasm programs that includes only header files. You can find it in libbpf-wasm.h (wasm-include/libbpf-wasm.h), which contains some commonly used user-space libbpf APIs and type definitions. Wasm programs can use the libbpf API to manipulate BPF objects, for example:\"}]\n"])</script><script>self.__next_f.push([1,"58:[\"$\",\"$L72\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-c\\\"./*\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"skel = bootstrap_bpf__open();\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"/* Parameterize BPF code with minimum duration parameter */\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"skel-\u003erodata-\u003emin_duration_ns = env.min_duration_ms * 1000000ULL;\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"/* Load \u0026 verify BPF programs */\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"err = bootstrap_bpf__load(skel);\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"/* Attach tracepoints */\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"err = bootstrap_bpf__attach(skel);\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"The rodata section is used to store constants in the BPF program, and these values will be mapped to the correct offsets in the object file generated by bpftool gen skeleton. After opening, the values can be modified through memory mapping, so there is no need to compile the libelf library in Wasm. The BPF object can still be dynamically loaded and manipulated at runtime.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"The C code on the Wasm side is slightly different from the local libbpf code, but it can provide most of the functionalities from the eBPF side. For example, polling from a ring buffer or perf buffer, accessing maps from both the Wasm and eBPF sides, loading, attaching, and detaching BPF programs, etc. It can support a wide range of eBPF program types and maps, covering most use cases of eBPF programs in domains such as tracing, networking, and security.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Due to the lack of certain functionalities on the Wasm side, such as signal handler support (as of February 2023), the original C code may not be directly compilable to wasm. You may need to make slight modifications to the code to make it work. We will make best efforts to make the libbpf API on the wasm side as similar as possible to the libbpf API typically used in user space so that user space code can be directly compiled to wasm in the future. We will also provide more language bindings (e.g., Go) for wasm-based eBPF program development libraries as soon as possible.\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"You can use the polling API in user space programs to retrieve data uploaded from kernel space. It is a wrapper for the ring buffer and perf buffer, allowing user space code to use the same API to poll events from either a ring buffer or a perf buffer, depending on the type specified in the BPF program. For example, ring buffer polling is defined as `BPF_MAP_TYPE_RINGBUF`:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"```c\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"struct {\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    __uint(type, BPF_MAP_TYPE_RINGBUF);\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    __uint(max_entries, 256 * 1024);\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"} rb SEC(\\\".maps\\\");\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"59:[\"$\",\"p\",null,{\"children\":\"You can use the following code in user space to poll events from the ring buffer:\"}]\n"])</script><script>self.__next_f.push([1,"5a:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"rb \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_buffer__open\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skel\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"maps\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" handle_event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"NULL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* Process events */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%-8s %-5s %-16s %-7s %-7s %s\\\\n\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"TIME\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"EVENT\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"COMM\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"PID\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"       \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"PPID\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"FILENAME/EXIT CODE\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"exiting\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// poll buffer\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    err \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_buffer__poll\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"100\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* timeout, ms */\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"5b:[\"$\",\"p\",null,{\"children\":\"Ring buffer polling does not require serialization overhead. The bpf_buffer__poll API will call the handle_event callback function to process event data from the ring buffer:\"}]\n"])</script><script>self.__next_f.push([1,"5c:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_event\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"data\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"size_t\"}],\" data_sz\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" data\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"exit_event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%-8s %-5s %-16s %-7d %-7d [%u]\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"EXIT\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"               e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ppid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"exit_code\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"duration_ns\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\" (%llums)\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"duration_ns \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1000000\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",\"$L92\",\"$L93\",\"$L94\",\"$L95\",\"$L96\",\"\\n\"]}],\"$L97\",\"$L98\",\"$L99\",\"$L9a\",\"$L9b\",\"$L9c\",\"$L9d\",\"$L9e\",\"$L9f\",\"$La0\",\"$La1\",\"$La2\",\"$La3\",\"$La4\",\"$La5\",\"$La6\",\"$La7\",\"$La8\",\"$La9\",\"$Laa\",\"$Lab\",\"$Lac\",\"$Lad\",\"$Lae\",\"$Laf\",\"$Lb0\",\"$Lb1\",\"$Lb2\",\"$Lb3\",\"$Lb4\",\"$Lb5\",\"$Lb6\",\"$Lb7\",\"$Lb8\",\"$Lb9\",\"$Lba\",\"$Lbb\",\"$Lbc\"]}]}]\n"])</script><script>self.__next_f.push([1,"5d:[\"$\",\"p\",null,{\"children\":[\"In runqlat, the \",[\"$\",\"code\",null,{\"children\":\"map\"}],\" API is used to access and directly read data from a \",[\"$\",\"code\",null,{\"children\":\"map\"}],\" in the kernel from user-space, for example:\"]}]\n"])</script><script>self.__next_f.push([1,"5e:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_get_next_key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"lookup_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        err \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_lookup_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"hist\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        lookup_key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    lookup_key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_get_next_key\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"lookup_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        err \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_delete_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        lookup_key \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" next_key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"5f:[\"$\",\"p\",null,{\"children\":\"When running wasm code, shared memory will be used to access the kernel map. The kernel space can directly copy data to the stack of the Wasm virtual machine in user space, without the additional copy overhead between the user space host program and the Wasm runtime. Similarly, for type definitions shared between the Wasm virtual machine and the kernel space, careful checking is required to ensure that they have consistent types in both Wasm and kernel space.\"}]\n60:[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"bpf_map_update_elem\"}],\" function can be used to update the eBPF map in user space programs to update the kernel's eBPF map, for example:\"]}]\n"])</script><script>self.__next_f.push([1,"61:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        cg_map_fd \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map__fd\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"obj\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"maps\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cgroup_map\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        cgfd \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"open\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"env\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"cgroupspath\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" O_RDONLY\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"cgfd \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_update_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"cg_map_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"idx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"cgfd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_ANY\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"62:[\"$\",\"p\",null,{\"children\":\"Therefore, the eBPF program in the kernel can obtain configurations from the Wasm program side, or receive messages during runtime.\"}]\n"])</script><script>self.__next_f.push([1,"63:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"more-examples-socket-filter-and-lsm\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#more-examples-socket-filter-and-lsm\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"More examples: socket filter and LSM\"]}]\n"])</script><script>self.__next_f.push([1,"64:[\"$\",\"p\",null,{\"children\":\"In the repository, we also provide more examples, such as using socket filters to monitor and filter packets:\"}]\n"])</script><script>self.__next_f.push([1,"65:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"socket\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"socket_handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__sk_buff\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"so_event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u8 verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u16 proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ETH_HLEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"verlen \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0xF\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"$Lbd\",\" \",\"$Lbe\",\"$Lbf\",\"e\",\"$Lc0\",\"ports\",\"$Lc1\",\"$Lc2\",\" \",\"$Lc3\",\"$Lc4\",\"$Lc5\",\"\\n\"]}],\"$Lc6\",\"$Lc7\",\"$Lc8\",\"$Lc9\",\"$Lca\",\"$Lcb\"]}]}]\n"])</script><script>self.__next_f.push([1,"66:[\"$\",\"p\",null,{\"children\":\"Linux Security Modules (LSM) is a hook-based framework for implementing security policies and mandatory access control in the Linux kernel. Until now, there have been two choices for enforcing security policy goals: configuring existing LSM modules (such as AppArmor and SELinux) or writing custom kernel modules.\"}]\n67:[\"$\",\"p\",null,{\"children\":\"Linux Kernel 5.7 introduces a third option: LSM eBPF. LSM BPF allows developers to write custom policies without configuring or loading kernel modules. LSM BPF programs are verified at load time and then executed when reaching the LSM hook in the call path. For example, we can use LSM in a Wasm lightweight container to restrict file system operations:\"}]\n"])</script><script>self.__next_f.push([1,"68:[\"$\",\"$L72\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// all lsm the hook point refer https://www.kernel.org/doc/html/v5.2/security/LSM.html\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"lsm/path_rmdir\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"path_rmdir\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"path\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"dir\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"dentry\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"dentry\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_get_current_comm\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" dir_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"can_not_rm\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" d_iname\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"32\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_probe_read_kernel\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"d_iname\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"d_iname\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"dir\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"dentry\",\"$Lcc\",\"d_iname\",\"$Lcd\",\"$Lce\",\"$Lcf\",\"$Ld0\",\"$Ld1\",\"$Ld2\",\"\\n\"]}],\"$Ld3\",\"$Ld4\",\"$Ld5\",\"$Ld6\",\"$Ld7\",\"$Ld8\",\"$Ld9\",\"$Lda\",\"$Ldb\"]}]}]\n"])</script><script>self.__next_f.push([1,"69:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"summary\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#summary\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Summary\"]}]\n"])</script><script>self.__next_f.push([1,"6a:[\"$\",\"p\",null,{\"children\":[\"In this example, we discuss how to use C/C++ language to write eBPF programs and compile them into Wasm modules. For more complete code, please refer to our GitHub repository: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/wasm-bpf\",\"children\":\"https://github.com/eunomia-bpf/wasm-bpf\"}],\".\"]}]\n6b:[\"$\",\"p\",null,{\"children\":\"In the next article, we will discuss how to write eBPF programs using Rust and compile them into Wasm modules. We will also cover using OCI images to publish, deploy, and manage eBPF programs, similar to the experience with Docker.\"}]\n6c:[\"$\",\"p\",null,{\"children\":\"Next, we will continue to improve the experience of developing and running eBPF programs in multiple languages within Wasm. We will provide more comprehensive examples, user-level development libraries/toolchains, and more specific use cases.\"}]\n"])</script><script>self.__next_f.push([1,"6d:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"reference\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#reference\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Reference\"]}]\n"])</script><script>self.__next_f.push([1,"6e:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"wasm-bpf GitHub repository: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/wasm-bpf\",\"children\":\"https://github.com/eunomia-bpf/wasm-bpf\"}]]}],[\"$\",\"li\",null,{\"children\":[\"What is eBPF: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://ebpf.io/what-is-ebpf\",\"children\":\"https://ebpf.io/what-is-ebpf\"}]]}],[\"$\",\"li\",null,{\"children\":[\"WASI-eBPF: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/WebAssembly/WASI/issues/513\",\"children\":\"https://github.com/WebAssembly/WASI/issues/513\"}]]}],[\"$\",\"li\",null,{\"children\":[\"Anolis Community eBPF Technology Exploration SIG: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://openanolis.cn/sig/ebpfresearch\",\"children\":\"https://openanolis.cn/sig/ebpfresearch\"}]]}],[\"$\",\"li\",null,{\"children\":[\"eunomia-bpf project: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/eunomia-bpf\",\"children\":\"https://github.com/eunomia-bpf/eunomia-bpf\"}]]}],[\"$\",\"li\",null,{\"children\":[\"eunomia-bpf project Anolis Gitee mirror: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://gitee.com/anolis/eunomia\",\"children\":\"https://gitee.com/anolis/eunomia\"}]]}],[\"$\",\"li\",null,{\"children\":[\"Wasm-bpf: Bridging the gap between WebAssembly and eBPF kernel programming: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew\",\"children\":\"https://mp.weixin.qq.com/s/2InV7z1wcWic5ifmAXSiew\"}]]}],[\"$\",\"li\",null,{\"children\":[\"When WASM meets eBPF: Writing, distributing, loading, and running eBPF programs using WebAssembly: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://zhuanlan.zhihu.com/p/573941739\",\"children\":\"https://zhuanlan.zhihu.com/p/573941739\"}]]}],[\"$\",\"li\",null,{\"children\":[\"Teaching you how to use eBPF LSM to hotfix Linux kernel vulnerabilities: \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.bilibili.com/read/cv19597563\",\"children\":\"https://www.bilibili.com/read/cv19597563\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"6f:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl\",\"children\":[[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2Fhow-to-write-c-in-wasm\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37/yunwei37-blog/blob/main/data/blog/how-to-write-c-in-wasm.mdx\",\"children\":\"View on GitHub\"}]]}]\n70:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl\",\"id\":\"comment\",\"children\":[\"$\",\"$Ldc\",null,{\"slug\":\"how-to-write-c-in-wasm\"}]}]\n"])</script><script>self.__next_f.push([1,"71:[\"$\",\"footer\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"py-4 xl:py-8\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4\",\"children\":\"Tags\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"$L6\",\"ebpf\",{\"href\":\"/tags/ebpf\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"ebpf\"}],[\"$\",\"$L6\",\"systems\",{\"href\":\"/tags/systems\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"systems\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-between py-4 xl:block xl:space-y-6 xl:py-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Previous Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/how-to-write-rust-in-wasm\",\"children\":\"在 WebAssembly 中使用 Rust 编写 eBPF 程序并发布 OCI 镜像\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Next Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/2022\",\"children\":\"2022 一个新的开始\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105\",\"href\":\"/blog\",\"aria-label\":\"Back to the blog\",\"children\":\"← Back to the blog\"}]}]]}]\n"])</script><script>self.__next_f.push([1,"73:[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}]\n74:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n75:[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".maps\\\"\"}]\n76:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n77:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n78:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}]\n79:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}]\n7a:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"volatile\"}]\n7b:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}]\n7c:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}]\n7d:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}]\n7e:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}]\n7f:[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}]\n80:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n81:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"volatile\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"name_ptr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n82:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n83:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"tp/sched/sched_process_exec\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n84:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"handle_exec\"}],[\"$\",\"span\",null,{\"className\""])</script><script>self.__next_f.push([1,":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sched_process_exec\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n85:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n86:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"task_struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"task\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n87:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"unsigned\"}],\" fname_off\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n88:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n89:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"pid_t\"}],\" pid\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n8a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    u64 ts\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n8b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\""])</script><script>self.__next_f.push([1,"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]\n8c:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}]\n8d:[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"bootstrap_bpf__bss\"}]\n8e:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}]\n8f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"uint64_t\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* pointer */\"}],\" name_ptr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n90:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"bss\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n91:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n92:[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"printf\"}]\n93:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n94:[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\\n\\\"\"}]\n95:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n96:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n97:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n98:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]\n99:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\""])</script><script>self.__next_f.push([1,"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n9a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n9b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"```The Markdown content has been translated to English \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"while\"}],\" preserving the original formatting\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\n9c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n"])</script><script>self.__next_f.push([1,"9d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"\\\"Runtime is based on the libbpf CO\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"RE\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"Compile Once\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Run Everywhere\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" API\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" which is used to load BPF objects into the kernel\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" Therefore\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" wasm\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"bpf programs are not affected by the kernel version they are compiled with and can run on any kernel version that supports BPF CO\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"RE\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"9e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n9f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"### Accessing and updating map data of eBPF programs from user\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"space programs\\n\"]}]\na0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"runqlat is a more complex example that shows the scheduler run queue latency through a histogram\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" displaying how \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"long\"}],\" a task has waited to run\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]\na2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"```console\\n\"}]\na4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$$ sudo \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"wasm\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"bpf runqlat\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"wasm \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"h\\n\"]}]\na5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Summarize run \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"queue\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"scheduler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" latency as a histogram\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]\na6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"USAGE\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" runqlat \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"--\"}],\"help\""])</script><script>self.__next_f.push([1,",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"interval\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"\\n\"]}]\na8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"EXAMPLES\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\"\\n\"]}]\naa:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    runqlat         # summarize run queue latency as a histogram\\n\"}]\nab:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    runqlat \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],\"    # print \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" second summaries\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],\" times\\n\"]}]\nac:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$$ sudo \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"wasm\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"bpf runqlat\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"wasm \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"\\n\"]}]\nad:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nae:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Tracing run queue latency\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\" Hit Ctrl\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"C to end\",[\"$\",\"span\",null,{\"className\":\"token"])</script><script>self.__next_f.push([1," punctuation\",\"children\":\".\"}],\"\\n\"]}]\naf:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nb0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"     usecs               \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" count    distribution\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"         \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"          \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"72\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"           \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"         \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\"          \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"93\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"   \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"         \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\"          \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"98\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"         \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"15\"}],\"         \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"96\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"31\"}],\"         \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"38\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"                         \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"32\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"63\"}],\"         \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"                                       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"64\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"127\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"                                      \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"       \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"128\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"255\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"                                      \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"       \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"256\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"511\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"                                        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\nba:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"       \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"512\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1023\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"                                        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\nbb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1024\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2047\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"                                        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\nbc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2048\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"c"])</script><script>self.__next_f.push([1,"hildren\":\"4095\"}],\"       \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\"        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"                                        \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\"\\n\"]}]\nbd:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\nbe:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}]\nbf:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\nc0:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}]\nc1:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nc2:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\nc3:[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}]\nc4:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nc5:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\nc6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nc7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nc8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_ringbuf_submit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\","])</script><script>self.__next_f.push([1,"\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nc9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nca:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ncb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\ncc:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}]\ncd:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}]\nce:[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}]\ncf:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}]\nd0:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nd1:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nd2:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\nd3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nd4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_printk\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"comm %s try to rmdir %s\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" comm\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" d_iname\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" i \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"dir_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"++\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"d_iname\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\"dir_name\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"i\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nd8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nd9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nda:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ndb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"23:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n1f:null\n"])</script><script>self.__next_f.push([1,"21:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf | 云微的胡思乱想\"}],[\"$\",\"meta\",\"1\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"2\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://www.yunwei37.com/blog/how-to-write-c-in-wasm\"}],[\"$\",\"link\",\"4\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://www.yunwei37.com/feed.xml\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://www.yunwei37.com/blog/how-to-write-c-in-wasm\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"云微的胡思乱想\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:published_time\",\"content\":\"2022-02-11T16:00:00.000Z\"}],[\"$\",\"meta\",\"12\",{\"property\":\"article:modified_time\",\"content\":\"2022-02-11T16:00:00.000Z\"}],[\"$\",\"meta\",\"13\",{\"property\":\"article:author\",\"content\":\"Yusheng Zheng (云微)\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:title\",\"content\":\"在 WebAssembly 中编写 eBPF 程序和使用 libbpf\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"26:\"$21:metadata\"\n"])</script></body></html>